---
title: "Trade Winds Blow South: The new China-centric trade regime’s distributional effects on Broad Economic Categories (BEC) and commodities output in Brazil"
author: "Ethan Kallett"
date: "April 27, 2022"
output:
  bookdown::pdf_document2:
    number_sections: yes
    toc: yes
    toc_depth: '4'
urlcolor: blue
bibliography: references.bib

---

```{r setup, include=FALSE, cache=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(kableExtra)
library(ggplot2)
library(readxl)
library(plm)
#library(stargazer)
library(cowplot)
library(treemap)

```
```{r conversion-tables, include=FALSE, cache=TRUE,warning=FALSE}
# conversion tables
HS2017BEC <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/HS2017toBECConversionAndCorrelationTables.xlsx")
HS2017HS2012 <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/HS2017toHS2012ConversionAndCorrelationTables.xlsx")
HS2017HS2007 <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/HS2017toHS2007ConversionAndCorrelationTables.xlsx")
HS2017HS2002 <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/HS2017toHS2002ConversionAndCorrelationTables.xlsx")
HS2017HS1996 <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/HS2017toHS1996ConversionAndCorrelationTables.xlsx")
manualLeftoverHStoBEC <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/ManualLeftoverBECtoHS.xlsx")
# PIMtoBEC <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/ConversionPIMtoBEC.xlsx")
# PIMtoBEC <- PIMtoBEC %>%
#   pivot_longer(cols=colnames(PIMtoBEC),names_to="PIM_PF", values_to = "BEC")
PIMtoBEC <- read_excel("/Users/ethan/Documents/R/ECON300/ConversionTables/PIMtoBEC.xlsx",col_names = TRUE)

CPIseries <- read_csv("/Users/ethan/Documents/R/ECON300/data/consumerpriceindexFRED.csv") %>% 
  separate(col=DATE, into=c("year", "month", "day"), sep="-") %>%
  transmute(fYear = as.factor(year), fMonth = as.factor(as.double(month)), 
            CPI = MEDCPIM094SFRBCLE/100)
BrazilGDP <- read_csv("/Users/ethan/Documents/R/ECON300/data/GDP per capita, PPP (constant 2017 international $) - Brazil.csv", skip=4) %>% filter(`Country Name` == "Brazil") %>%
  select(-`Country Name`, -`Country Code`,-`Indicator Name`,-`Indicator Code`) %>%
  pivot_longer(cols = where(is.numeric), names_to = "year", values_to = "BrazilGDP_PPP") %>%
  transmute(fYear = as.factor(year), BrazilGDP_PPP = BrazilGDP_PPP)

vendasVarejo <- read_csv("/Users/ethan/Documents/R/ECON300/data/vendasVarejoReais.csv",
                         col_names = c("Data", "varejoTotal", "artigosFarmacêuticos","livrosJornaisRevistasPapeleria","escritórioInformáticaComunicação", "outrosUsoPessoalEDomésticos",
                                       "combustíveisLubrificantes", "hipermercadosProdutosAlimentíciosBebidasFumo", "hipermercadosSupermercados",
                                       "tecidosVestuárioECalçados", "móveisElectrodomésticos", "veículosMotosPartesPeças", "delete1", "delete2","delete3","delete4","delete5","delete6"
                                       ),skip=1) %>% select(-delete1,-delete2,-delete3,-delete4,-delete5,-delete6,-X19) %>%
  mutate(Data = as.character(Data)) %>% 
  mutate(fYear = as.factor(substr(Data,1,4)),
         monthOld = as.factor(substr(Data,6,8))) %>%
  mutate(monthIntermediate = case_when(monthOld == "1" ~ as.character("10"),
                            TRUE ~ as.character(as.double(monthOld)))) %>%
  mutate(fMonth = as.factor(monthIntermediate)) %>% select(-monthOld,-monthIntermediate)
  
varejoAnnual <- vendasVarejo %>%
  mutate(year = as.double(as.character(fYear))) %>%
  group_by(year) %>%
  summarise(varejoTotal = mean(varejoTotal),
            artigosFarmacêuticos = mean(artigosFarmacêuticos),
            livrosJornaisRevistasPapeleria = mean(livrosJornaisRevistasPapeleria),
            escritórioInformáticaComunicação = mean(escritórioInformáticaComunicação),
            outrosUsoPessoalEDomésticos = mean(outrosUsoPessoalEDomésticos),
            combustíveisLubrificantes = mean(combustíveisLubrificantes),
            hipermercadosProdutosAlimentíciosBebidasFumo = mean(hipermercadosProdutosAlimentíciosBebidasFumo),
            hipermercadosSupermercados = mean(hipermercadosSupermercados),
            tecidosVestuárioECalçados = mean(tecidosVestuárioECalçados),
            móveisElectrodomésticos = mean(móveisElectrodomésticos),
            veículosMotosPartesPeças = mean(veículosMotosPartesPeças)) %>%
  ungroup()

HS4DigitToWords <- tribble(~HS4Digit, ~Description,
                           1201, "Soybeans",
                           2601, "Iron Ore",
                           8517, "Telephones",
                           4703, "Sulfate Chemical Woodpulp",
                           8529, "Broadcasting Accessories",
                           8473, "Office Machine Parts",
                           8542, "Integrated Circuits",
                           8471, "Computers",
                           0202, "Frozen Bovine Meat",
                           2709, "Crude Petroleum",
                           2710, "Refined Petroleum",
                           1005, "Corn",
                           0901, "Coffee",
                           7108, "Gold",
                           1701, "Raw Sugar",
                           2304, "Soybean Meal",
                           0207, "Poultry Meat",
                           0203, "Pig Meat",
                           8703, "Cars",
                           5201, "Raw Cotton",
                           7202, "Ferroalloys",
                           7207, "Semi-Finished Iron",
                           8708, "Vehicle Parts",
                           8905, "Special Purpose Ships",
                           2711, "Petroleum Gas",
                           3004, "Packaged Medicaments",
                           3002, "Blood, antisera, vaccines, toxins and cultures",
                           3102, "Nitrogenous Fertilizers",
                           3104, "Potassic Fertilizers",
                           3105, "Mixed Mineral or Chemical Fertilizers",
                           2933, "Nitrogen Heterocyclic Compounds",
                           8411, "Gas Turbines",
                           8525, "Broadcasting Equipment",
                           8541, "Semiconductor Devices",
                           8483, "Transmissions",
                           8704, "Delivery Trucks",
                           3808, "Pesticides",
                           9013, "LCDs",
                           8701, "Tractors",
                           4011, "Rubber Tires",
                           8433, "Harvesting Machinery",
                           2818, "Aluminum Oxide",
                           8481, "Valves",
                           8504, "Electrical Transformers",
                           7110, "Platinum",
                           8802, "Planes, Helicopters, Spacecraft",
                           8429, "Large Construction Vehicles",
                           8501, "Electric Motors",
                           8414, "Air Pumps",
                           2603, "Copper Ores",
                           7201, "Pig Iron",
                           7601, "Raw Aluminum",
                           2401, "Raw Tobacco",
                           2009,"Raw Aluminum",
                           2207, "Fruit Juice",
                           1602, "Alcohol >80% ABV",
                           2931, "Other Organo-Inorganic Compounds",
                           9503, "Models and Stuffed Animals",
                           9405, "Light Fixtures",
                           9018, "Medical Instruments",
                           8409,"Engine Parts",
                           2701, "Coal Briquettes",
                           9032, "Thermostats",
                           8443, "Industrial Printers",
                           8415, "Air Conditioners",
                           8516, "Electric Heaters",
                           8536, "Low-Voltage Protection Equipment",
                           8539, "Electric Filament",
                           8534, "Printed Circuit Boards",
                           8507, "Electric Accumulators",
                           8518, "Microphones",
                           7210, "Flat-Rolled Iron",
                           8714, "Motorcycle Parts",
                           5407, "Synthetic Woven Fabrics",
                           5402, "Synthetic Filament Yarn",
                           6006, "Other Knitted or Crocheted Fabrics",
                           8479, "Other Machines & Mechanical Appliances",
                           2716, "Electricity",
                           8803, "Aircraft or Spacecraft Parts",
                           3901, "Ethylene Polymers",
                           3907, "Polyacetyls",
                           8421, "Centrifuges",
                           8431, "Excavation Machinery",
                           8482, "Ball/Roller Bearings",
                           8544, "Insulated Wire",
                           8502, "Electric Generators",
                           2905, "Acyclic Alcohols",
                           3103, "Phosphatic Fertilizers",
                           7403, "Refined Copper",
                           7318, "Screws & Bolts"
                           ) 


```
```{r eda-trade-data, include=FALSE, cache=TRUE,warning=FALSE}
eda_trade_data <- rbind(
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS41997-1998.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS41999-2001.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS42002-2004.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS42005-2007.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS42008-2010.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS42011-2013.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS42014-2016.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS42017-2019.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/4DigitAllPartners/BrazilTradeHS42020-2021.csv")
) %>% transmute(period = Period, 
            HS4Digit = as.numeric(`Commodity Code`),
            value = `Trade Value (US$)`,
            flow = as.factor(`Trade Flow`),
            partner = as.factor(Partner), 
            year = Year) %>% left_join(CPIseries %>% mutate(year = as.double(as.character(fYear)))
                                       %>% group_by(year) %>% summarise(yearlyCPI = mean(CPI)),
                                       by = c("year"="year")) %>%
  filter(!(partner == "World")) %>%
  mutate(normalizedValue = value/yearlyCPI,
         HS2Digit = trunc(HS4Digit/100))  %>%
  mutate(HSSection = as.factor(case_when(
    HS2Digit < 6 ~ "Animal Products",
    HS2Digit < 15 ~ "Vegetable Products",
    HS2Digit == 15 ~ "Animal/Vegetable Biproducts",
    HS2Digit < 25 ~ "Prepared Foodstuffs",
    HS2Digit < 28 ~ "Mineral Products",
    HS2Digit < 39 ~ "Chemical Products",
    HS2Digit < 41 ~ "Plastics and Rubbers",
    HS2Digit < 44 ~ "Animal Hides",
    HS2Digit < 47 ~ "Wood Products",
    HS2Digit < 50 ~ "Paper Goods",
    HS2Digit < 64 ~ "Textiles",
    HS2Digit < 68 ~ "Footwear and Headwear",
    HS2Digit < 71 ~ "Stone and Glass",
    HS2Digit < 72 ~ "Precious Metals",
    HS2Digit < 84 ~ "Metals",
    HS2Digit < 86 ~ "Machines",
    HS2Digit < 90 ~ "Transportation",
    HS2Digit < 93 ~ "Instruments",
    HS2Digit < 94 ~ "Weapons",
    HS2Digit < 97 ~ "Paper Goods",
    HS2Digit < 98 ~ "Art & Antiques",
    TRUE ~ "-1"
  ))) %>% filter(!(partner=="World"))
yearlyExportsConstant1982 <- eda_trade_data %>% group_by(year) %>%
  filter(flow=="Export") %>%
  summarise(yearlyExports = sum(normalizedValue))
yearlyExportsCurrent <- eda_trade_data %>% group_by(year) %>%
  filter(flow=="Export") %>%
  summarise(yearlyExports = sum(value))
yearlyImportsConstant1982 <- eda_trade_data %>% group_by(year) %>%
  filter(flow=="Import") %>%
  summarise(yearlyImports = sum(normalizedValue))
yearlyImportsCurrent <- eda_trade_data %>% group_by(year) %>%
  filter(flow=="Import") %>%
  summarise(yearlyImports = sum(value))
totalTrade2020 <- (yearlyExportsCurrent %>% filter(year==2020) %>% pull(yearlyExports)) + (yearlyImportsCurrent %>% filter(year==2020) %>% pull(yearlyImports))
# eda_trade_data <- eda_trade_data %>% left_join(yearlyExports, by =c("year"="year")) %>% left_join(yearlyImports, by = c("year"="year"))
eda_trade_data <- eda_trade_data %>% left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  mutate(HS4DigitDescription = case_when(
    is.na(Description) ~ as.character(HS4Digit),
    TRUE ~ Description
  ))

# Top Export Partners
eda_trade_data %>% filter(flow == "Export") %>%
  filter(year > 2001) %>%
  group_by(partner) %>% summarise(exports = signif(sum(normalizedValue),digits=4)) %>%
  arrange(desc(exports))

# Top Import Partners
eda_trade_data %>% filter(flow == "Import") %>%
  group_by(partner) %>% summarise(imports = signif(sum(normalizedValue),digits=4)) %>%
  arrange(desc(imports))

# Top Trade Partners
eda_trade_data %>% 
  group_by(partner) %>% summarise(trade = signif(sum(normalizedValue),digits=4)) %>%
  arrange(desc(trade))

# Export Partners over Time
countriesforgraph = c("China","USA","Argentina","Germany","Netherlands","Japan")
eda_trade_data %>% filter(partner %in% countriesforgraph) %>%
  filter(flow == "Export") %>%
  group_by(partner,year) %>% summarise(annual_trade = sum(normalizedValue)) %>%
  mutate(partner = as.factor(partner)) %>%
  ggplot(aes(x=year,y=annual_trade,colour=partner)) +
  geom_smooth(se=FALSE) +
  geom_point(aes(shape=partner))

# Import Partners over Time
countriesforgraph = c("China","USA","Argentina","Germany","Netherlands","Japan")
eda_trade_data %>% filter(partner %in% countriesforgraph) %>%
  filter(flow == "Import") %>%
  group_by(partner,year) %>% summarise(annual_trade = sum(normalizedValue)) %>%
  mutate(partner = as.factor(partner)) %>%
  ggplot(aes(x=year,y=annual_trade,colour=partner)) +
  geom_smooth(se=FALSE) +
  geom_point(aes(shape=partner))

# Top Imports 2000
importsfromChina2000 <- eda_trade_data %>% filter(year==2000) %>% filter(partner=="China") %>% 
  filter(flow == "Import") %>%
  summarise(sum = sum(value)) %>% pull(sum)
imports2000 <- eda_trade_data %>% filter(year==2000) %>% 
  filter(flow == "Import") %>%
  summarise(sum = sum(value)) %>% pull(sum)
shareImportsFromChina2000 <- importsfromChina2000/imports2000 # 2.2% !!

# Top Imports 2020
importsfromChina2020 <- eda_trade_data %>% filter(year==2020) %>% filter(partner=="China") %>% 
  filter(flow == "Import") %>%
  summarise(sum = sum(value)) %>% pull(sum)
imports2020 <- eda_trade_data %>% filter(year==2020) %>% 
  filter(flow == "Import") %>%
  summarise(sum = sum(value)) %>% pull(sum)
shareImportsFromChina2020 <- importsfromChina2020/imports2020 # 22.1% !!


# Top Exports 2000
exportsChina2000 <- eda_trade_data %>% filter(year==2000) %>% filter(partner=="China") %>% 
  filter(flow == "Export") %>%
  summarise(sum = sum(value)) %>% pull(sum)
exports2000 <- eda_trade_data %>% filter(year==2000) %>% 
  filter(flow == "Export") %>%
  summarise(sum = sum(value)) %>% pull(sum)
shareExportsToChina2000 <- exportsChina2000/exports2000 # 1.9% !!

# Top Exports 2020
exportsChina2020 <- eda_trade_data %>% filter(year==2020) %>% filter(partner=="China") %>% 
  filter(flow == "Export") %>%
  summarise(sum = sum(value)) %>% pull(sum)
exports2020 <- eda_trade_data %>% filter(year==2020) %>% 
  filter(flow == "Export") %>%
  summarise(sum = sum(value)) %>% pull(sum)
shareExportsToChina2020 <- exportsChina2020/exports2020 # 32.1% !!
(eda_trade_data %>% filter(year==2019) %>% filter(partner=="China") %>% 
  filter(flow == "Export") %>%
  summarise(sum = sum(value)) %>% pull(sum)/eda_trade_data %>% filter(year==2019) %>% 
  filter(flow == "Export") %>%
  summarise(sum = sum(value)) %>% pull(sum)) # 28.3% in 2019

# Top Brazilian Exports in 2020 and Share to China
eda_trade_data %>% filter(flow == "Export") %>% filter(year==2020) %>%
  group_by(HS4Digit) %>% summarise(exports2020byHS4 = sum(value)) %>%
  inner_join((eda_trade_data %>% filter(flow == "Export") %>% filter(year==2020) %>%
                filter(partner=="China") %>%
                group_by(HS4Digit) %>% summarise(exports2020CHINAbyHS4 = sum(value))),
             by=c("HS4Digit"="HS4Digit")) %>% 
  mutate(shareOfTotalExports = exports2020byHS4/(yearlyExportsCurrent %>% filter(year==2020) %>% pull(yearlyExports)), 
         shareOfExportsToChina = exports2020CHINAbyHS4/exports2020byHS4) %>%
  left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  arrange(desc(exports2020byHS4)) %>% select(-exports2020byHS4,-exports2020CHINAbyHS4) %>%
  mutate(rank = row_number())


# Top Brazilian Imports in 2020 and Share from China
eda_trade_data %>% filter(flow == "Import") %>% filter(year==2020) %>%
  group_by(HSSection) %>% summarise(imports2020byHSSection = sum(value)) %>%
  inner_join((eda_trade_data %>% filter(flow == "Import") %>% filter(year==2020) %>%
                filter(partner=="China") %>%
                group_by(HSSection) %>% summarise(imports2020CHINAbyHSSection = sum(value))),
             by=c("HSSection"="HSSection")) %>% 
  mutate(shareOfTotalImports2020 = imports2020byHSSection/(yearlyImportsCurrent %>% filter(year==2020) %>% pull(yearlyImports)), 
         shareOfImportsFromChina2020 = imports2020CHINAbyHSSection/imports2020byHSSection) %>%
  # left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  arrange(desc(imports2020byHSSection)) %>% select(-imports2020byHSSection,-imports2020CHINAbyHSSection) %>%
  mutate(rank = row_number())  %>% # ***** this block to join the two tables ****
  left_join(eda_trade_data %>% filter(flow == "Import") %>% filter(year==2000) %>%
  group_by(HSSection) %>% summarise(imports2000byHSSection = sum(value)) %>%
  inner_join((eda_trade_data %>% filter(flow == "Import") %>% filter(year==2000) %>%
                filter(partner=="China") %>%
                group_by(HSSection) %>% summarise(imports2000CHINAbyHSSection = sum(value))),
             by=c("HSSection"="HSSection")) %>% 
  mutate(shareOfTotalImports2000 = imports2000byHSSection/(yearlyImportsCurrent %>% filter(year==2000) %>% pull(yearlyImports)), 
         shareOfImportsFromChina2000 = imports2000CHINAbyHSSection/imports2000byHSSection) %>%
  # left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  arrange(desc(imports2000byHSSection)) %>% select(-imports2000byHSSection,-imports2000CHINAbyHSSection) %>%
  mutate(rank = row_number())  
,
by=c("HSSection"="HSSection"))

# Top Brazilian Imports in 2000 and Share from China
eda_trade_data %>% filter(flow == "Import") %>% filter(year==2000) %>%
  group_by(HSSection) %>% summarise(imports2000byHSSection = sum(value)) %>%
  inner_join((eda_trade_data %>% filter(flow == "Import") %>% filter(year==2000) %>%
                filter(partner=="China") %>%
                group_by(HSSection) %>% summarise(imports2000CHINAbyHSSection = sum(value))),
             by=c("HSSection"="HSSection")) %>% 
  mutate(shareOfTotalImports2000 = imports2000byHSSection/(yearlyImportsCurrent %>% filter(year==2000) %>% pull(yearlyImports)), 
         shareOfImportsFromChina2000 = imports2000CHINAbyHSSection/imports2000byHSSection) %>%
  # left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  arrange(desc(imports2000byHSSection)) %>% select(-imports2000byHSSection,-imports2000CHINAbyHSSection) %>%
  mutate(rank = row_number())  


# Treemaps
# Brazil top exports to China
treemap_topexportstoChinaDTF <- eda_trade_data %>% filter(partner == "China") %>%
  filter(flow == "Export") %>%
  filter(!(HSSection == "-1")) %>%
  filter(year==2020) %>%
  group_by(HS4DigitDescription, HSSection) %>%
  summarise(trade_value = sum(value)) %>%
  arrange(desc(trade_value))
          
treemap_topexportstoChina <- 
  treemap(
    treemap_topexportstoChinaDTF,
    index = c("HSSection", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazil Exports to China"
  )


79923202840/(treemap_topexportstoChinaDTF %>% filter(HSSection == "Vegetable Products") %>%
               ungroup() %>%
  summarise(sum = sum(trade_value)) %>% pull(sum))
# soybeans represent 99.7% of the Vegetable Products exports to China ...

sum(treemap_topexportstoChinaDTF %>% filter(HS4DigitDescription %in% c("Iron Ore", "Crude Petroleum", "Soybeans", "Frozen Bovine Meat", "Sulfate Chemical Woodpulp")) %>% pull(trade_value))/sum(treemap_topexportstoChinaDTF$trade_value)

(eda_trade_data %>% filter(partner == "China") %>%
    filter(year ==2020) %>%
  filter(flow == "Export") %>%
  filter(HSSection %in% c("Machines","Instruments", "Chemical Products", "Transportation")) %>% 
  summarise(s = sum(value)) %>% pull(s))/sum(treemap_topexportstoChinaDTF$trade_value)

# Brazil top exports to world ex China
topexportstoWorldexChinaDTF <- 
  eda_trade_data %>% 
  filter(!(partner == "China")) %>%
  filter(flow == "Export") %>%
  filter(!(HSSection == "-1")) %>%
  filter(year==2020) %>%
  group_by(HS4DigitDescription, HSSection) %>%
  summarise(trade_value = sum(value)) %>%
  arrange(desc(trade_value))

treemap_topexportstoWorldexChina <- 
  treemap(
    topexportstoWorldexChinaDTF,
    index = c("HSSection", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazil Exports to Rest of World"
  )


sum(topexportstoWorldexChinaDTF %>% filter(HS4DigitDescription %in% c("Iron Ore", "Crude Petroleum", "Soybeans", "Frozen Bovine Meat", "Sulfate Chemical Woodpulp")) %>% pull(trade_value))/sum(topexportstoWorldexChinaDTF$trade_value)

(eda_trade_data %>% filter(!(partner == "China")) %>%
    filter(year == 2020) %>% 
  filter(flow == "Export") %>%
  filter(HSSection %in% c("Machines","Instruments", "Chemical Products", "Transportation")) %>% 
  summarise(s = sum(value)) %>% pull(s))/sum(topexportstoWorldexChinaDTF$trade_value)

# Brazil top imports from China
treemap_topimportsfromChinaDTF <- eda_trade_data %>% 
  filter(partner == "China") %>%
  filter(flow == "Import") %>%
  filter(!(HSSection == "-1")) %>%
  group_by(HS4DigitDescription, HSSection) %>%
  summarise(trade_value = sum(normalizedValue)) %>%
  arrange(desc(trade_value))
          
treemap_topimportsChina <- 
  treemap(
    treemap_topimportsfromChinaDTF,
    index = c("HSSection", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazil Imports from China"
  )
treemap_topimportsChina

# Brazil top imports from world ex China
treemap_topimportsfromChinaDTF <- eda_trade_data %>% 
  filter(!(partner == "China")) %>%
  filter(flow == "Import") %>%
  filter(!(HSSection == "-1")) %>%
  group_by(HS4DigitDescription, HSSection) %>%
  summarise(trade_value = sum(normalizedValue)) %>%
  arrange(desc(trade_value))
          
treemap_topimportsChina <- 
  treemap(
    treemap_topimportsfromChinaDTF,
    index = c("HSSection", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazil Imports from Rest of World"
  )
treemap_topimportsChina


```
```{r trade-data, include=FALSE, cache=TRUE,warning=FALSE}
sixDigit2000to2001 <- rbind(
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ArgentinaChinaMonthlySixDigitHS2000-2001.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/FranceJapanSixDigitHS2000-2001.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/KoreaNigeriaSixDigitHS2000-2001.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/UKSpainSixDigitHS2000-2001.csv")
) %>% 
  transmute(period = Period, 
            reportedCode = as.numeric(`Commodity Code`),
            value = `Trade Value (US$)`,
            flow = as.factor(`Trade Flow`),
            partner = as.factor(Partner), 
            year = trunc(period/100),
            month = period %% 100)

sixDigit2002to2006 <- rbind(
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ArgentinaChinaMonthlySixDigitHS2002-2006.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/FranceIndiaMonthlySixDigitHS2002-2006.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ItalyMexicoMonthlySixDigitHS2002-2006.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/NetherlandsKoreaMonthlySixDigitHS2002-2006.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/SpainUSAMonthlySixDigitHS2002-2006.csv")
) %>% 
  transmute(period = Period, 
            reportedCode = as.numeric(`Commodity Code`),
            value = `Trade Value (US$)`,
            flow = as.factor(`Trade Flow`),
            partner = as.factor(Partner), 
            year = trunc(period/100),
            month = period %% 100)

sixDigit2007to2011 <- rbind(
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ArgentinaChinaMonthlySixDigitHS2007-2011.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/FranceIndiaMonthlySixDigitHS2007-2011.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ItalyMexicoMonthlySixDigitHS2007-2011.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/NetherlandsKoreaMonthlySixDigitHS2007-2011.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/SpainUSAMonthlySixDigitHS2007-2011.csv")
) %>% 
  transmute(period = Period, 
            reportedCode = as.numeric(`Commodity Code`),
            value = `Trade Value (US$)`,
            flow = as.factor(`Trade Flow`),
            partner = as.factor(Partner), 
            year = trunc(period/100),
            month = period %% 100)

sixDigit2012to2016 <- rbind(
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ArgentinaChinaMonthlySixDigitHS2012-2016.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/FranceIndiaMonthlySixDigitHS2012-2016.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ItalyMexicoMonthlySixDigitHS2012-2016.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/NetherlandsKoreaMonthlySixDigitHS2012-2016.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/SpainUSAMonthlySixDigitHS2012-2016.csv")
) %>% 
  transmute(period = Period, 
            reportedCode = as.numeric(`Commodity Code`),
            value = `Trade Value (US$)`,
            flow = as.factor(`Trade Flow`),
            partner = as.factor(Partner), 
            year = trunc(period/100),
            month = period %% 100)

sixDigit2017to2021 <- rbind(
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ArgentinaChinaMonthlySixDigitHS2017-2021.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/FranceIndiaMonthlySixDigitHS2017-2021.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/ItalyMexicoMonthlySixDigitHS2017-2021.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/NetherlandsKoreaMonthlySixDigitHS2017-2021.csv"),
  read_csv("/Users/ethan/Documents/R/ECON300/SixDigitHSCode/SpainUSAMonthlySixDigitHS2017-2021.csv")
) %>% 
  transmute(period = Period, 
            reportedCode = as.numeric(`Commodity Code`),
            value = `Trade Value (US$)`,
            flow = as.factor(`Trade Flow`),
            partner = as.factor(Partner), 
            year = trunc(period/100),
            month = period %% 100)

sixDigit2000to2001 <- sixDigit2000to2001 %>% 
  left_join(HS2017HS1996 %>% transmute(HS2017 = as.numeric(`From HS 2017`),
                                       HS1996 = as.numeric(`To HS 1996`)),
            by = c("reportedCode" = "HS1996"))

sixDigit2002to2006 <- sixDigit2002to2006 %>% 
  left_join(HS2017HS2002 %>% transmute(HS2017 = as.numeric(`From HS 2017`),
                                       HS2002 = as.numeric(`To HS 2002`)),
            by = c("reportedCode" = "HS2002"))

sixDigit2007to2011 <- sixDigit2007to2011 %>% 
  left_join(HS2017HS2007 %>% transmute(HS2017 = as.numeric(`From HS 2017`),
                                       HS2007 = as.numeric(`To HS 2007`)),
            by = c("reportedCode" = "HS2007"))
sixDigit2012to2016 <- sixDigit2012to2016 %>% 
  left_join(HS2017HS2012 %>% transmute(HS2017 = as.numeric(`From HS 2017`),
                                       HS2012 = as.numeric(`To HS 2012`)),
            by = c("reportedCode" = "HS2012"))
sixDigit2017to2021 <- sixDigit2017to2021 %>% 
  mutate(HS2017 = reportedCode)

# sixDigit2002to2006 %>% filter(is.na(HS2017)) %>%
#   group_by(reportedCode) %>% summarise(n())
# sixDigit2007to2011 %>% filter(is.na(HS2017)) %>%
#   group_by(reportedCode) %>% summarise(n())
# sixDigit2012to2016 %>% filter(is.na(HS2017)) %>%
#   group_by(reportedCode) %>% summarise(n())

combinedUpdated <- rbind(sixDigit2002to2006,sixDigit2007to2011,
                         sixDigit2012to2016,sixDigit2017to2021,sixDigit2000to2001)
whereNull <- combinedUpdated %>% filter(is.na(HS2017)) %>%
  select(-HS2017) %>% mutate(HS2017 = reportedCode,
                             reportedCarriedOver = TRUE)
combinedUpdated <- rbind(combinedUpdated %>% drop_na() %>%
  mutate(reportedCarriedOver = FALSE), whereNull) %>% 
  mutate(fourDigitHS2017 = trunc(HS2017/100),
         twoDigitHS2017 = trunc(HS2017/10000))

# Match BEC by six digits
combinedUpdatedWithBEC <- combinedUpdated %>%
  left_join(HS2017BEC %>% transmute(HS2017 = as.numeric(`From HS 2017`),
                                    BEC = as.numeric(`To BEC`)), 
            by = c("HS2017"="HS2017"))
# Match BEC with four digits
combinedUpdatedWithBECnull <- combinedUpdatedWithBEC %>% filter(is.na(BEC)) %>%
  mutate(BECwFourDigitHS = TRUE) %>% select(-BEC) %>%
  left_join(HS2017BEC %>% transmute(HS2017 = trunc(as.numeric(`From HS 2017`)/100),
                                    BEC = as.numeric(`To BEC`)),
            by=c("fourDigitHS2017"="HS2017")) %>%
  group_by(period, reportedCode,value,flow,partner,year,month,HS2017,reportedCarriedOver,
           fourDigitHS2017,twoDigitHS2017,BECwFourDigitHS,BEC) %>%
  summarise(count=n()) %>% ungroup() %>% select(-count)
# Manually match remaining 27 4 digit HS codes
stillNullBEC <- combinedUpdatedWithBECnull %>% filter(is.na(BEC)) %>%
  mutate(BECwFourDigitHS = TRUE) %>% select(-BEC) %>% 
  left_join(manualLeftoverHStoBEC %>% select(-Sum), by=c("fourDigitHS2017" = "fourDigitHS2017"))

tradeDataLong <- rbind(combinedUpdatedWithBEC %>% 
                                  mutate(BECwFourDigitHS = FALSE),
                                combinedUpdatedWithBECnull,
                                stillNullBEC) %>% drop_na() %>%
  mutate(fYear=as.factor(year),
         fMonth=as.factor(month))
tradeDataLong <- tradeDataLong %>%
  mutate(oneDigitBEC = as.numeric(substr(as.character(BEC),1,1)),
         twoDigitBEC = as.numeric(substr(as.character(BEC),1,2)),
         threeDigitBEC = as.numeric(substr(as.character(BEC),1,3))) %>% 
  left_join(CPIseries, by=c("fYear"="fYear", "fMonth"="fMonth")) %>%
  mutate(valueNormalized = value/CPI) %>%
  left_join(BrazilGDP, by=c("fYear"="fYear"))

```
```{r importing-wrangling-Brazil-data, include=FALSE, cache=TRUE,warning=FALSE}

# PIM-PF as BEC data
PIM_PF_BEC <- read_excel("/Users/ethan/Documents/R/ECON300/Data/PIM-PF_ALL.xlsx",
                         skip=3) %>%
  mutate(`323 Alimentos e bebidas básicos, destinados principalmente ao consumo doméstico` = 
           as.numeric(`323 Alimentos e bebidas básicos, destinados principalmente ao consumo doméstico`),
         `9 Bens não especificados anteriormente` = as.numeric(`9 Bens não especificados anteriormente`),
         keep = "unused") %>% select(-keep, -`...1`, -`...2`) %>%
   pivot_longer(cols=c(PIMtoBEC %>% pull(PIM)), names_to = "PIM_PF_BEC", 
              values_to="PIM_PF_BECindexValue") %>%
  separate(`...3`, into=c("monthWord", "fYear"), sep=" ") %>% 
  mutate(fMonth = as.factor(case_when(
    substr(monthWord,1,3) == "jan" ~ 1,
    substr(monthWord,1,3) == "fev" ~ 2,
    substr(monthWord,1,3) == "mar" ~ 3,
    substr(monthWord,1,3) == "abr" ~ 4,
    substr(monthWord,1,3) == "mai" ~ 5,
    substr(monthWord,1,3) == "jun" ~ 6,
    substr(monthWord,1,3) == "jul" ~ 7,
    substr(monthWord,1,3) == "ago" ~ 8,
    substr(monthWord,1,3) == "set" ~ 9,
    substr(monthWord,1,3) == "out" ~ 10,
    substr(monthWord,1,3) == "nov" ~ 11,
    substr(monthWord,1,3) == "dez" ~ 12,
    TRUE ~ -1
  )),
  fYear=as.factor(fYear),
  keep="unused") %>%
  select(-keep, -monthWord) %>%
  left_join(PIMtoBEC, by=c("PIM_PF_BEC"="PIM"))


# HYDROCARBONS
# monthly values of average barrels produced per day
hydrocarbonsMonthly <- 
  read_csv("/Users/ethan/Documents/R/ECON300/data/mineralFuelsANPMonthly.csv",
           col_names = 
             c("Data", "álcool (k brl/day)", 
               "gás natural (m^3/day)", 
               "petróleo (k brl/day)"), skip=1) %>% 
  select(-X5, -`álcool (k brl/day)`) %>%
  mutate(Data = as.character(Data)) %>% 
  mutate(fYear = as.factor(substr(Data,1,4)),
         monthOld = as.factor(substr(Data,6,8))) %>%
  mutate(monthIntermediate = case_when(monthOld == "1" ~ as.character("10"),
                            TRUE ~ as.character(as.double(monthOld)))) %>%
  mutate(fMonth = as.factor(monthIntermediate)) %>% select(-monthOld,-monthIntermediate)


# METALS
metalsMonthly <- 
  read_csv("/Users/ethan/Documents/R/ECON300/data/CimentoSNICMensal.csv",
           col_names = 
             c("Data", "aço bruto (tons)", 
               "ferro-gusa (tons)", "laminados (tons)",
               "cimento (tons)"), skip=1) %>% select(-X6) %>%
  mutate(Data = as.character(Data)) %>% 
  mutate(fYear = as.factor(substr(Data,1,4)),
         monthOld = as.factor(substr(Data,6,8))) %>%
  mutate(monthIntermediate = case_when(monthOld == "1" ~ as.character("10"),
                            TRUE ~ as.character(as.double(monthOld)))) %>%
  mutate(fMonth = as.factor(monthIntermediate)) %>% select(-monthOld,-monthIntermediate)


# CAPACITY USAGE 
capacityUsageMonthly <- read_csv("/Users/ethan/Documents/R/ECON300/data/UtilizacaoCapacidadeCNI.csv",
                                 col_names = c("Data", "utilizacao da capacidade (avg 2006 100%)", "bovinos (tons)", 
               "frangos (tons)", "suínos (tons)",
               "vacas (tons)", "novilhos (tons)"), skip = 1) %>% 
  select(Data, `utilizacao da capacidade (avg 2006 100%)`)

# LIVESTOCK
meatMonthly <- read_csv("/Users/ethan/Documents/R/ECON300/data/CoagroAbateAnimais.csv",
           col_names = 
             c("Data", "bovinos (tons)", 
               "frangos (tons)", "suínos (tons)",
               "vacas (tons)", "novilhos (tons)"), skip=1) %>% select(-X7) %>%
  mutate(Data = as.character(Data)) %>% 
  mutate(fYear = as.factor(substr(Data,1,4)),
         monthOld = as.factor(substr(Data,6,8))) %>%
  mutate(monthIntermediate = case_when(monthOld == "1" ~ as.character("10"),
                            TRUE ~ as.character(as.double(monthOld)))) %>%
  mutate(fMonth = as.factor(monthIntermediate)) %>% select(`bovinos (tons)`, 
               `frangos (tons)`, `suínos (tons)`, fYear,fMonth)

  
  # AGRICULTURE
agricultureQtde <- read_csv("/Users/ethan/Documents/R/ECON300/data/agriculturaQtde.csv",
                            col_names = c(
                              "Data",
                              "cacau (tons)", "café (tons)", "cana-de-açúcar (tons)",
                              "fumo (tons)", "milho (tons)", "soja (tons)", "trigo (tons)",
                              "algodão (tons)"
                            ), skip=1) %>%
  select(-`algodão (tons)`,-X10)
agricultureAnnual <- 
  read_csv("/Users/ethan/Documents/R/ECON300/data/AgriculturePAMPlusAnnual.csv",
           col_names = 
             c("Data", "utilizacao da capacidade (avg 2006 100%)", "bovinos (tons)", 
               "frangos (tons)", "suínos (tons)",
               "vacas (tons)", "algodão (tons)", "novilhos (tons)",
               "algodão (hect)", "café área colhida (hect)", "cana-de-açúcar área colhida (hect)",
               "milho área colhida (hect)", "soja área colhida (hect)", 
               "cacau valor (R$)", "café valor (R$)", "cana-de-açúcar valor (R$)",
               "fumo valor (R$)", "milho valor (R$)", "soja valor (R$)", "trigo valor (R$)", 
               "utilizacao"),
           skip = 1) %>%
  select(`Data`, `algodão (tons)`, `algodão (hect)`, `café área colhida (hect)`, `cana-de-açúcar área colhida (hect)`,
         `milho área colhida (hect)`, `soja área colhida (hect)`, `cacau valor (R$)`, `café valor (R$)`,
         `cana-de-açúcar valor (R$)`, `fumo valor (R$)`, `milho valor (R$)`, `soja valor (R$)`,
         `trigo valor (R$)`) %>% 
  left_join(agricultureQtde, by=c("Data"="Data"))

agricultureAnnualReduced <- agricultureAnnual %>% mutate(fYear = as.factor(Data)) %>% select(`algodão (tons)`, `algodão (hect)`, `café área colhida (hect)`,  `cana-de-açúcar área colhida (hect)`, `milho área colhida (hect)`, `soja área colhida (hect)`, `cacau (tons)`, `café (tons)`, `cana-de-açúcar (tons)`, `fumo (tons)`, `milho (tons)`, `soja (tons)`, `trigo (tons)`,fYear)

# VEHICLES ANNUAL
vehiclesAnnual <- 
  read_csv("/Users/ethan/Documents/R/ECON300/data/producaoVehiculosAnnuais.csv",
           col_names = c("Data", "automóveis (units)"), skip=1) %>%
  select(-X3)

# PIM SECOES ATIVIDADES INDUSTRIAIS
PIM_SecoesAtividadesIndustriais <- read_excel("/Users/ethan/Documents/R/ECON300/Data/PIM_SecoesEAtividadesIndustriais.xlsx",
                         skip=3)

# manual 3-year time dummies
# plot(y=HS2DigitAnnual$`soja (tons)`,x=HS2DigitAnnual$year)
# abline(lm(`cana-de-açúcar (tons)` ~ poly(year,6), HS2DigitAnnual))
# plot(as.numeric(resid(lm(`milho (tons)` ~ poly(year,6), HS4DigitAnnual))))

threeYearTimeDummies <-
  tibble(year = c(1:19)) %>%
  mutate(threeYearDummy = as.factor(case_when(
    year > 18 ~ "7",
    year > 15 ~ "6",
    year > 12 ~ "5",
    year > 9 ~ "4",
    year > 6 ~ "3",
    year > 3 ~ "2",
    year > 0 ~ "1",
    TRUE ~ "-1"
  )))
brl_to_usd <- read_csv("/Users/ethan/Documents/R/ECON300/data/DEXBZUS.csv") %>%
  transmute(year=as.double(substr(as.character(DATE),1,4)),month=as.double(substr(as.character(DATE),6,7)),USD2BRL = DEXBZUS) 

valordaproducao <- read_csv("/Users/ethan/Documents/R/ECON300/data/valordaproducao.csv",
                            col_names = c("year", "algodão (R$)", "cacau (R$)", "café (R$)", "cana-de-açúcar (R$)", "fumo (R$)", "milho (R$)", "soja (R$)", "delete"),skip=1) %>% select(-delete)

valordaproducao <- valordaproducao %>% inner_join(brl_to_usd %>% group_by(year) %>% transmute(year=year,USD2BRL = as.double(USD2BRL)) %>% drop_na() %>% summarise(USD2BRL = mean(USD2BRL,na.omit=TRUE)), by=c("year"="year")) %>% 
  mutate(`algodão (Current USD$)` = `algodão (R$)`/USD2BRL, `cacau (Current USD$)` = `cacau (R$)`/USD2BRL, `café (Current USD$)` = `café (R$)`/USD2BRL, `cana-de-açúcar (Current USD$)` = `cana-de-açúcar (R$)`/USD2BRL, `fumo (Current USD$)` = `fumo (R$)`/USD2BRL, `milho (Current USD$)` = `milho (R$)`/USD2BRL, `soja (Current USD$)` = `soja (R$)`/USD2BRL) %>% 
  left_join(CPIseries %>% mutate(year=as.double(as.character(fYear))) %>% group_by(year) %>% summarise(CPI = mean(CPI)), by=c("year"="year")) %>%
  mutate(`algodão (Constant 1982 USD$)` = `algodão (Current USD$)`/CPI, `cacau (Constant 1982 USD$)` = `cacau (Current USD$)`/CPI, `café (Constant 1982 USD$)` = `café (Current USD$)`/CPI, `cana-de-açúcar (Constant 1982 USD$)` = `cana-de-açúcar (Current USD$)`/CPI, `fumo (Constant 1982 USD$)` = `fumo (Current USD$)`/CPI, `milho (Constant 1982 USD$)` = `milho (Current USD$)`/CPI, `soja (Constant 1982 USD$)` = `soja (Current USD$)`/CPI) %>%
  mutate(fYear=as.factor(year))

# # UNIDO - Competitive Industrial Performance Index
# BrazilCompetitiveIndustrialPerformanceIndex <- 
#   read_csv("/Users/ethan/Documents/R/ECON300/Data/UNIDOCompetitiveIndustrialPerformance.csv") %>% 
#   filter(`Country Name` == "Brazil")
# 
# BrazilCompetitiveIndustrialPerformanceIndex %>% 
#   filter(Indicator %in% c("Competitive Industrial Performance Score","Share of world MVA index","MVA per capita index", "Manufacturing Value Added share in total GDP")) %>%
#   pivot_longer(cols = `1995`:`2018`, names_to = "year", values_to="value") %>%
#   select(year, Indicator, value) %>%
#   mutate(time_index = as.double(year) - 1994) %>%
#   ggplot(aes(colour=Indicator,fill=Indicator)) + 
#   geom_point(aes(x=year,y=value)) + geom_smooth(aes(x=time_index,y=value), se=FALSE)

```
```{r create-BEC-tibbles, include=FALSE, cache=TRUE,warning=FALSE}
# The regressions fucking finally
BECtibble1Digit <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,oneDigitBEC) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpBEC = case_when(
    flow == "Imports" ~ paste("ImpBEC",as.character(oneDigitBEC),sep=""),
    flow == "Exports" ~ paste("ExpBEC",as.character(oneDigitBEC),sep=""),
    TRUE ~ as.character(-1)
  )) %>%
  inner_join(PIM_PF_BEC, by=c("oneDigitBEC"="BEC", "fYear"="fYear", "fMonth"="fMonth")) %>%
  pivot_wider(names_from=ImpExpBEC, values_from = value) %>%
  pivot_wider(names_from = PIM_PF_BEC, values_from = PIM_PF_BECindexValue) %>%
  group_by(partner,fYear,fMonth,BrazilGDP_PPP) %>%
  summarise(across(ExpBEC2:`9 Bens não especificados anteriormente`,
                   ~sum(.x,na.rm = TRUE))) %>%
  ungroup() %>%
  left_join(vendasVarejo, by=c("fYear"="fYear","fMonth"="fMonth"))
  
BECtibble2Digit <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,twoDigitBEC) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpBEC = case_when(
    flow == "Imports" ~ paste("ImpBEC",as.character(twoDigitBEC),sep=""),
    flow == "Exports" ~ paste("ExpBEC",as.character(twoDigitBEC),sep=""),
    TRUE ~ as.character(-1)
  )) %>%
  inner_join(PIM_PF_BEC, by=c("twoDigitBEC"="BEC", "fYear"="fYear", "fMonth"="fMonth")) %>%
  pivot_wider(names_from=ImpExpBEC, values_from = value) %>%
  pivot_wider(names_from = PIM_PF_BEC, values_from = PIM_PF_BECindexValue) %>%
  group_by(partner,fYear,fMonth,BrazilGDP_PPP) %>%
  summarise(across(ExpBEC7:`322 Bens de consumo não duráveis`,
                   ~sum(.x,na.rm = TRUE))) %>%
  ungroup() %>%
  left_join(vendasVarejo, by=c("fYear"="fYear","fMonth"="fMonth"))

BECtibble3Digit <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,threeDigitBEC) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpBEC = case_when(
    flow == "Imports" ~ paste("ImpBEC",as.character(threeDigitBEC),sep=""),
    flow == "Exports" ~ paste("ExpBEC",as.character(threeDigitBEC),sep=""),
    TRUE ~ as.character(-1)
  )) %>%
  inner_join(PIM_PF_BEC, by=c("threeDigitBEC"="BEC", "fYear"="fYear", "fMonth"="fMonth")) %>%
  pivot_wider(names_from=ImpExpBEC, values_from = value) %>%
  pivot_wider(names_from = PIM_PF_BEC, values_from = PIM_PF_BECindexValue) %>%
  group_by(partner,fYear,fMonth,BrazilGDP_PPP) %>%
  summarise(across(ExpBEC7:`313 Equipamentos de transporte não industrial`,
                   ~sum(.x,na.rm = TRUE))) %>%
  ungroup() %>%
  left_join(vendasVarejo, by=c("fYear"="fYear","fMonth"="fMonth"))

```
```{r agriculture-regressions, include=FALSE, cache=TRUE,warning=FALSE}
HS4DigitMonthly <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,fourDigitHS2017) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpHS4 = case_when(
    flow == "Imports" ~ paste("Imp",as.character(fourDigitHS2017),sep=""),
    flow == "Exports" ~ paste("Exp",as.character(fourDigitHS2017),sep=""),
    TRUE ~ as.character(-1)
  )) %>%
  select(-fourDigitHS2017,-flow) %>%
  pivot_wider(names_from=ImpExpHS4,values_from=value) %>%
  left_join(meatMonthly, by=c("fYear"="fYear", "fMonth"="fMonth")) %>%
  left_join(vendasVarejo %>% select(-Data), by=c("fYear"="fYear","fMonth"="fMonth")) %>%
  replace(is.na(.), 0) 


HS4DigitAnnual <- tradeDataLong %>% 
  group_by(flow,partner,fYear,BrazilGDP_PPP,fourDigitHS2017) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpHS4 = case_when(
    flow == "Imports" ~ paste("Imp",as.character(fourDigitHS2017),sep=""),
    flow == "Exports" ~ paste("Exp",as.character(fourDigitHS2017),sep=""),
    TRUE ~ as.character(-1)
  )) %>%
  select(-fourDigitHS2017,-flow) %>%
  filter(fYear != "2021") %>%
  pivot_wider(names_from=ImpExpHS4,values_from=value) %>%
  left_join(agricultureAnnualReduced, by=c("fYear"="fYear")) %>%
  left_join(valordaproducao, by=c("fYear"="fYear")) %>%
  left_join(vendasVarejo %>% select(-Data, -fMonth) %>% group_by(fYear) %>% summarise_all(mean), by=c("fYear"="fYear")) %>%
  replace(is.na(.), 0) %>%
  mutate(year = as.integer(fYear))

HS2DigitAnnual <- tradeDataLong %>% 
  group_by(flow,partner,fYear,BrazilGDP_PPP,twoDigitHS2017) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpHS2 = case_when(
    flow == "Imports" ~ paste("Imp",as.character(twoDigitHS2017),sep=""),
    flow == "Exports" ~ paste("Exp",as.character(twoDigitHS2017),sep=""),
    TRUE ~ as.character(-1)
  )) %>%
  select(-twoDigitHS2017,-flow) %>%
  filter(fYear != "2021") %>%
  pivot_wider(names_from=ImpExpHS2,values_from=value) %>%
  left_join(agricultureAnnualReduced, by=c("fYear"="fYear")) %>%
  left_join(valordaproducao, by=c("fYear"="fYear")) %>%
  left_join(vendasVarejo %>% select(-Data, -fMonth) %>% group_by(fYear) %>% summarise_all(mean), by=c("fYear"="fYear")) %>%
  replace(is.na(.), 0) %>%
  mutate(year = as.integer(fYear))

# BOVINOS
bovinosHS <- c(0102, 0202, 0201) # TO EDIT
bovinosLMtons <- # TO EDIT
  lm(`bovinos (tons)` ~ Imp102 + Imp202 + Exp202 + Imp201 + Exp201 + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*Imp102 + (partner=="China")*Imp202 +  (partner=="China")*Exp202 + (partner=="China")*Imp201 + (partner=="China")*Exp201+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
# summary(bovinosLMtons) # TO EDIT

HS4DigitMonthly$detrended <- resid(lm(`bovinos (tons)` ~ fYear + fMonth, HS4DigitMonthly))
# bovinosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner + hipermercadosSupermercados,data = HS4DigitMonthly, effect = "individual",
#                model = "within",
#                index = "partner")
bovinosPLMdisggregate <- plm(detrended ~ (Imp201 + Imp202 + Imp201)*(partner=="China") + (Exp202 + Exp201)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
# summary(bovinosPLMaggregate)
# summary(bovinosPLMdisggregate)

# FRANGOS
frangosHS <- c(105,207) # TO EDIT
frangosLMtons <- # TO EDIT
  lm(`frangos (tons)` ~ Imp105 + Exp105 + Imp207 + Exp207  + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*Imp105 + (partner=="China")*Exp105 + (partner=="China")*Imp207 +  (partner=="China")*Exp207+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
summary(frangosLMtons) # TO EDIT

HS4DigitMonthly$detrended <- resid(lm(`frangos (tons)` ~ fYear + fMonth, HS4DigitMonthly))
# frangosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = frangosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
frangosPLMdisggregate <- plm(detrended ~ (Imp105 + Imp207)*(partner=="China") + (Exp105 + Exp207)*(partner=="China")+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
# summary(frangosPLMaggregate)
# summary(frangosPLMdisggregate)

# SUINOS
suinosHS <- c(103,203) # TO EDIT
suinosLMtons <- # TO EDIT
  lm(`suínos (tons)` ~ Imp103 + Exp103 + Imp203 + Exp203  + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*Imp103 + (partner=="China")*Exp103 + (partner=="China")*Imp203 +  (partner=="China")*Exp203+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
summary(suinosLMtons) # TO EDIT

HS4DigitMonthly$detrended <- resid(lm(`suínos (tons)` ~ fYear + fMonth, HS4DigitMonthly))
# suinosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = suinosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
suinosPLMdisggregate <- plm(detrended ~ (Imp103 + Imp203)*(partner=="China") + (Exp103 + Exp203)*(partner=="China")+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
# summary(suinosPLMaggregate)
# summary(suinosPLMdisggregate)

# ALGODAO
algodaoHS <- c(52) # TO EDIT
algodaoLMtons <- # TO EDIT
  lm(`algodão (tons)` ~ Imp52 + Exp52  + # TO EDIT
                       poly(year,6) + 
       #+ threeYearDummy +
                      (partner=="China") + 
                      (partner=="China")*Imp52 + (partner=="China")*Exp52+tecidosVestuárioECalçados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT
#summary(algodaoLMtons) # TO EDIT
algodaoLMhect <- # TO EDIT
  lm(`algodão (hect)` ~ Imp52 + Exp52  + # TO EDIT
                      + poly(year,6) + 
                      (partner=="China") + 
                      (partner=="China")*Imp52 + (partner=="China")*Exp52+tecidosVestuárioECalçados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT
# summary(algodaoLMhect) # TO EDIT
algodaoLMvalue <- # TO EDIT
  lm(`algodão (Constant 1982 USD$)` ~ Imp52 + Exp52  + # TO EDIT
                       + poly(year,6) + 
                      (partner=="China") + 
                      (partner=="China")*Imp52 + (partner=="China")*Exp52+tecidosVestuárioECalçados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT

HS2DigitAnnual$detrendedTons <- resid(lm(`algodão (tons)` ~ poly(year,6), HS2DigitAnnual))
algodaoPLMtons <- plm(detrendedTons ~ Imp52*(partner=="China") + Exp52*(partner=="China")+tecidosVestuárioECalçados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
HS2DigitAnnual$detrendedHect <- resid(lm(`algodão (hect)` ~ poly(year,6), HS2DigitAnnual))
algodaoPLMhect <- plm(detrendedHect ~ Imp52*(partner=="China") + Exp52*(partner=="China")+tecidosVestuárioECalçados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
# summary(algodaoPLMtons)
# summary(algodaoPLMhect)
HS2DigitAnnual$detrendedValue <- resid(lm(`algodão (Constant 1982 USD$)` ~ poly(year,6), HS2DigitAnnual))
algodaoPLMvalue <- plm(detrendedValue ~ Imp52*(partner=="China") + Exp52*(partner=="China")+tecidosVestuárioECalçados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")

# CAFE
coffeeHS <- c(0901, 2101) # TO EDIT
coffeeLMQtde <- lm(`café (tons)` ~ Imp901 + Exp901 + Imp2101 + Exp2101 + 
                      poly(year,6) + 
                      (partner=="China") + 
                      (partner=="China")*Imp901 + (partner=="China")*Exp901 + (partner=="China")*Imp2101 + (partner=="China")*Exp2101+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,
                    data = as.data.frame(HS4DigitAnnual))
# summary(coffeeLMQtde)
coffeeLMhect <- lm(`café área colhida (hect)` ~ Imp901 + Exp901 + Imp2101 + Exp2101 + 
                      poly(year,6) + 
                      (partner=="China") + 
                      (partner=="China")*Imp901 + (partner=="China")*Exp901 + (partner=="China")*Imp2101 + (partner=="China")*Exp2101+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,
                    data = as.data.frame(HS4DigitAnnual))
# summary(coffeeLMhect)
coffeeLMvalue <- lm(`café (Constant 1982 USD$)` ~ Imp901 + Exp901 + Imp2101 + Exp2101 + 
                      poly(year,6) + 
                      (partner=="China") + 
                      (partner=="China")*Imp901 + (partner=="China")*Exp901 + (partner=="China")*Imp2101 + (partner=="China")*Exp2101+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,
                    data = as.data.frame(HS4DigitAnnual))

HS4DigitAnnual$detrendedQtde <- resid(lm(`café (tons)` ~ poly(year,6), HS4DigitAnnual))
coffeePLMQtde <- plm(detrendedQtde ~ (Imp901 + Imp2101)*(partner=="China") + (Exp901 + Exp2101)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
HS4DigitAnnual$detrendedHect <- resid(lm(`café área colhida (hect)` ~ poly(year,6), HS4DigitAnnual))
coffeePLMhect <- plm(detrendedHect ~ (Imp901 + Imp2101)*(partner=="China") + (Exp901 + Exp2101)*(partner=="China") +  hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
HS4DigitAnnual$detrendedValue <- resid(lm(`café (Constant 1982 USD$)` ~ poly(year,6), HS4DigitAnnual))
coffeePLMvalue <- plm(detrendedValue ~ (Imp901 + Imp2101)*(partner=="China") + (Exp901 + Exp2101)*(partner=="China") +  hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
# summary(coffeePLMQtde)
# summary(coffeePLMhect)


# CANA DE ACUCAR
canadeacucarHS <- c(17) # TO EDIT
canadeacucarLMQtde <- # TO EDIT
  lm(`cana-de-açúcar (tons)` ~ Imp17 + Exp17  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp17 + (partner=="China")*Exp17+  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT
# summary(canadeacucarLMQtde) # TO EDIT
canadeacucarLMhect <- # TO EDIT
  lm(`cana-de-açúcar área colhida (hect)` ~ Imp17 + Exp17  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp17 + (partner=="China")*Exp17+  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT
# summary(canadeacucarLMhect) # TO EDIT
canadeacucarLMvalue <- # TO EDIT
  lm(`cana-de-açúcar (Constant 1982 USD$)` ~ Imp17 + Exp17  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp17 + (partner=="China")*Exp17 +  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT

HS2DigitAnnual$detrendedQtde <- resid(lm(`cana-de-açúcar (tons)` ~ poly(year,6), HS2DigitAnnual))
canadeacucarPLMQtde <- plm(detrendedQtde ~ Imp17*(partner=="China") + Exp17*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
HS2DigitAnnual$detrendedHect <- resid(lm(`cana-de-açúcar área colhida (hect)` ~ poly(year,6), HS2DigitAnnual))
canadeacucarPLMhect <- plm(detrendedHect ~ Imp17*(partner=="China") + Exp17*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
# summary(canadeacucarPLMQtde)
# summary(canadeacucarPLMhect)
HS2DigitAnnual$detrendedValue <- resid(lm(`cana-de-açúcar (Constant 1982 USD$)` ~ poly(year,6), HS2DigitAnnual))
canadeacucarPLMvalue <- plm(detrendedValue ~ Imp17*(partner=="China") + Exp17*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")


# MILHO
milhoHS <- c(1005, 1702, 110313) # TO EDIT
milhoLMQtde <- # TO EDIT
  lm(`milho (tons)` ~ Imp1005 + Exp1005 + Imp1702 + Exp1702 + Imp1103 + Exp1103  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (Imp1005+Imp1702+Imp1103)*(partner=="China") + (Exp1005+Exp1702+Exp1103)*(partner=="China")+  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnual)) # TO EDIT
# summary(milhoLMQtde) # TO EDIT
milhoLMhect <- # TO EDIT
  lm(`milho área colhida (hect)` ~ Imp1005 + Exp1005 + Imp1702 + Exp1702 + Imp1103 + Exp1103  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp1005 + (partner=="China")*Exp1005 + (partner=="China")*Imp1702 + (partner=="China")*Exp1702 + (partner=="China")*Imp1103 + (partner=="China")*Exp1103+  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnual)) # TO EDIT
# summary(milhoLMhect) # TO EDIT
milhoLMvalue <- # TO EDIT
  lm(`milho (Constant 1982 USD$)` ~ Imp1005 + Exp1005 + Imp1702 + Exp1702 + Imp1103 + Exp1103  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (Imp1005+Imp1702+Imp1103)*(partner=="China") + (Exp1005+Exp1702+Exp1103)*(partner=="China")+  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnual)) # TO EDIT

HS4DigitAnnual$detrendedQtde <- resid(lm(`milho (tons)` ~ poly(year,6), HS4DigitAnnual))
milhoPLMQtde <- plm(detrendedQtde ~ (Imp1005+Imp1702+Imp1103)*(partner=="China") + (Exp1005+Exp1702+Exp1103)+ hipermercadosSupermercados,data = HS4DigitAnnual, 
               model = "within",
               index = "partner")
summary(milhoPLMQtde)
milhoPLMQtdeExp <- plm(detrendedQtde ~ (Exp1005+Exp1702+Exp1103)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnual, 
               model = "within",
               index = "partner")
summary(milhoPLMQtdeExp)
HS4DigitAnnual$detrendedHect <- resid(lm(`milho área colhida (hect)` ~ poly(year,6), HS4DigitAnnual))
milhoPLMhect <- plm(detrendedHect ~ (Imp1005+Imp1702+Imp1103)*(partner=="China") + (Exp1005+Exp1702+Exp1103) + hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
summary(milhoPLMhect)
milhoPLMhectExp <- plm(detrendedHect ~ (Exp1005+Exp1702+Exp1103)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
summary(milhoPLMhectExp)
HS4DigitAnnual$detrendedValue <- resid(lm(`milho (Constant 1982 USD$)` ~ poly(year,6), HS4DigitAnnual))
milhoPLMvalue <- plm(detrendedValue ~ (Imp1005+Imp1702+Imp1103)*(partner=="China") + (Exp1005+Exp1702+Exp1103)+ hipermercadosSupermercados,data = HS4DigitAnnual, 
               model = "within",
               index = "partner")

# summary(milhoPLMQtde)
# summary(milhoPLMhect)

# SOJA
sojaHS <- c(1201, 2304, 1507) # TO EDIT
sojaLMQtde <- # TO EDIT
  lm(`soja (tons)` ~ Imp2304 + Exp2304 + Imp1201 + Exp1201 + Imp1507 + Exp1507  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp2304 + (partner=="China")*Exp2304 + (partner=="China")*Imp1201 + (partner=="China")*Exp1201 + (partner=="China")*Imp1507 + (partner=="China")*Exp1507+  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnual)) # TO EDIT
# summary(sojaLMQtde) # TO EDIT
sojaLMhect <- # TO EDIT
  lm(`soja área colhida (hect)` ~ Imp2304 + Exp2304 + Imp1201 + Exp1201 + Imp1507 + Exp1507  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp2304 + (partner=="China")*Exp2304 + (partner=="China")*Imp1201 + (partner=="China")*Exp1201 + (partner=="China")*Imp1507 + (partner=="China")*Exp1507+ hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnual)) # TO EDIT
# summary(sojaLMhect) # TO EDIT
sojaLMvalue <- # TO EDIT
  lm(`soja (Constant 1982 USD$)` ~ Imp2304 + Exp2304 + Imp1201 + Exp1201 + Imp1507 + Exp1507  + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp2304 + (partner=="China")*Exp2304 + (partner=="China")*Imp1201 + (partner=="China")*Exp1201 + (partner=="China")*Imp1507 + (partner=="China")*Exp1507+  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnual)) # TO EDIT

HS4DigitAnnual$detrendedQtde <- resid(lm(`soja (tons)` ~ poly(year,6), HS4DigitAnnual))
sojaPLMQtde <- plm(detrendedQtde ~ (Imp2304 + Imp1201 + Imp1507)*(partner=="China") + (Exp2304 + Exp1201 + Exp1507)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
HS4DigitAnnual$detrendedHect <- resid(lm(`soja área colhida (hect)` ~ poly(year,6), HS4DigitAnnual))
sojaPLMhect <- plm(detrendedHect ~ (Imp2304 + Imp1201 + Imp1507)*(partner=="China") + (Exp2304 + Exp1201 + Exp1507)*(partner=="China") +  hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
HS4DigitAnnual$detrendedValue <- resid(lm(`soja (Constant 1982 USD$)` ~ poly(year,6), HS4DigitAnnual))
sojaPLMvalue <- plm(detrendedValue ~ (Imp2304 + Imp1201 + Imp1507)*(partner=="China") + (Exp2304 + Exp1201 + Exp1507)*(partner=="China") +  hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
# summary(sojaPLMvalor)
# summary(sojaPLMhect)

sojaPLMQtdeImp <- plm(detrendedQtde ~ (Imp2304 + Imp1201 + Imp1507)*(partner=="China") + 
                     #(Exp2304 + Exp1201 + Exp1507) +  
                     hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
sojaPLMhectImp <- plm(detrendedHect ~ (Imp2304 + Imp1201 + Imp1507)*(partner=="China") + 
                     #(Exp2304 + Exp1201 + Exp1507) +  
                     hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
summary(sojaPLMhectImp)
sojaPLMQtdeExp <- plm(detrendedQtde ~  
                     (Exp2304 + Exp1201 + Exp1507) +  
                     hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
summary(sojaPLMQtdeExp)
sojaPLMhectExp <- plm(detrendedHect ~  
                     (Exp2304 + Exp1201 + Exp1507) +  
                     hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
summary(sojaPLMhectExp)

# HS4DigitAnnual %>% filter(partner=="China") %>% mutate(soyExp = scale(Exp2304 + Exp1201 + Exp1507),
#                                                        normalSoyQtde = scale(detrendedQtde)) %>% ggplot() +
#   geom_line(aes(x = year, y = soyExp), color = "blue") +
#   geom_line(aes(x = year, y = normalSoyQtde), color = "red")

# print(sojaPLMvalor)
# print(sojaPLMhect)
# fixef(sojaPLMvalor)
# fixef(sojaPLMhect)
# summary(sojaPLMvalorNoExp)
# summary(sojaPLMhectNoExp)
#vcovHC(sojaPLMvalor)

# CACAU 
cacauHS <- c(18) # TO EDIT
cacauLMQtde <- # TO EDIT
  lm(`cacau (tons)` ~ Imp18 + Exp18 + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp18 + (partner=="China")*Exp18+ hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT
# summary(cacauLMQtde) # TO EDIT
cacauLMvalue <- # TO EDIT
  lm(`cacau (Constant 1982 USD$)` ~ Imp18 + Exp18 + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp18 + (partner=="China")*Exp18+ hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT

HS2DigitAnnual$detrendedQtde <- resid(lm(`cacau (tons)` ~ poly(year,6), HS2DigitAnnual))
cacauPLMQtde <- plm(detrendedQtde ~ Imp18*(partner=="China") + Exp18*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
# summary(cacauPLMQtde)
HS2DigitAnnual$detrendedValue <- resid(lm(`cacau (Constant 1982 USD$)` ~ poly(year,6), HS2DigitAnnual))
cacauPLMvalue <- plm(detrendedValue ~ Imp18*(partner=="China") + Exp18*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")


# FUMO
fumoHS <- c(24) # TO EDIT
fumoLMQtde <- # TO EDIT
  lm(`fumo (tons)` ~ Imp24 + Exp24 + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp24 + (partner=="China")*Exp24 +  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT
summary(fumoLMQtde) # TO EDIT
fumoLMvalue <- # TO EDIT
  lm(`fumo (Constant 1982 USD$)` ~ Imp24 + Exp24 + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + 
       (partner=="China")*Imp24 + (partner=="China")*Exp24 +  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnual)) # TO EDIT

HS2DigitAnnual$detrendedQtde <- resid(lm(`fumo (tons)` ~ poly(year,6), HS2DigitAnnual))
fumoPLMQtde <- plm(detrendedQtde ~ Imp24*(partner=="China") + Exp24*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
summary(fumoPLMQtde)
HS2DigitAnnual$detrendedValue <- resid(lm(`fumo (Constant 1982 USD$)` ~ poly(year,6), HS2DigitAnnual))
fumoPLMvalue <- plm(detrendedValue ~ Imp24*(partner=="China") + Exp24*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")

# TRIGO
trigoHS <- c(11,1001) # TO EDIT
#1101 1108 1107 1104 1109 1102 1103
trigoLMQtde <- # TO EDIT
  lm(`trigo (tons)` ~ (Imp1101 + Imp1108 + Imp1107 +Imp1104 +Imp1109 +Imp1102 +Imp1103 +Imp1001)*(partner=="China") + (Exp1101 + Exp1108 + Exp1107 +Exp1104 +Exp1109 +Exp1102 +Exp1103 +Exp1001)*(partner=="China") + # TO EDIT
                      poly(year,6) + 
                      (partner=="China") + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnual)) # TO EDIT
# summary(trigoLMQtde) # TO EDIT

HS4DigitAnnual$detrendedQtde <- resid(lm(`trigo (tons)` ~ poly(year,6), HS4DigitAnnual))
trigoPLMQtde <- plm(detrendedQtde ~ (Imp1101 + Imp1108 + Imp1107 +Imp1104 +Imp1109 +Imp1102 +Imp1103 +Imp1001)*((partner=="China")) + (Exp1101 + Exp1108 + Exp1107 +Exp1104 +Exp1109 +Exp1102 +Exp1103 +Exp1001)*((partner=="China"))+  hipermercadosSupermercados,data = HS4DigitAnnual, effect = "individual",
               model = "within",
               index = "partner")
# summary(trigoPLMQtde)

```
```{r fuels-and-metals-regressions, include=FALSE, cache=TRUE,warning=FALSE}
HS4DigitMonthly <- HS4DigitMonthly %>% left_join(hydrocarbonsMonthly, by=c("fYear"="fYear","fMonth"="fMonth"))

petroleoHS <- c(2709, 2710, 2713) # TO EDIT
petroleoLM <- # TO EDIT
  lm(`petróleo (k brl/day)` ~ Imp2709 + Exp2709 + Exp2710 + Imp2710 + Exp2713 + Imp2713 + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*Imp2709 +  (partner=="China")*Exp2709 + (partner=="China")*Imp2710 +  (partner=="China")*Exp2710 + (partner=="China")*Imp2713 + (partner=="China")*Exp2713+combustíveisLubrificantes, # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
#summary(petroleoLM) # TO EDIT

HS4DigitMonthly$detrendedVolume <- resid(lm(`petróleo (k brl/day)` ~ fYear + fMonth, HS4DigitMonthly))
petroleoPLMvolume <- plm(detrendedVolume ~ (Imp2709+Imp2710+Imp2713)*(partner=="China") + (Exp2709+Exp2710+Exp2713)*(partner=="China")+combustíveisLubrificantes,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
#summary(petroleoPLMvolume)


gasHS <- c(2711) # TO EDIT
gasLM <- # TO EDIT
  lm(`gás natural (m^3/day)` ~ Imp2711 + Exp2711 + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*Imp2711 +  (partner=="China")*Exp2711+combustíveisLubrificantes, # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
# summary(gasLM) # TO EDIT

HS4DigitMonthly$detrendedVolume <- resid(lm(`gás natural (m^3/day)` ~ fYear + fMonth, HS4DigitMonthly))
gasPLMvolume <- plm(detrendedVolume ~ Imp2711*(partner=="China") + Exp2711*(partner=="China")+combustíveisLubrificantes,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
# summary(gasPLMvolume)

HS4DigitMonthly <- HS4DigitMonthly %>% 
  left_join(metalsMonthly, by=c("fYear"="fYear","fMonth"="fMonth"))

# PIG IRON
ferroGusaHS <- c(7201) # TO EDIT
ferroGusaLMtons <- # TO EDIT
  lm(`ferro-gusa (tons)` ~ Imp7201 + Exp7201 + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*Imp7201 + (partner=="China")*Exp7201 +
       BrazilGDP_PPP , # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
# summary(bovinosLMtons) # TO EDIT

HS4DigitMonthly$detrended <- resid(lm(`ferro-gusa (tons)` ~ fYear + fMonth, HS4DigitMonthly))
ferroGusaPLMaggregate <- plm(detrended ~ Imp7201*(partner=="China") + Exp7201*(partner=="China") + BrazilGDP_PPP,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
# summary(ferroGusaPLMaggregate)
# bovinosPLMdisggregate <- plm(detrended ~ (Imp201 + Imp202 + Imp201)*partner + (Exp202 + Exp201)*partner + hipermercadosSupermercados,data = bovinosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
# summary(bovinosPLMaggregate)
#summary(bovinosPLMdisggregate)


# CRUDE STEEL
acoBrutoHS <- c(7227, 7218) # TO EDIT
acoBrutoLMtons <- # TO EDIT
  lm(`aço bruto (tons)` ~ Imp7227 + Imp7218 +Exp7227+Exp7218 + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*(Imp7227+Imp7218) + (partner=="China")*(Exp7227+Exp7218) +
       BrazilGDP_PPP , # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
# summary(acoBrutoLMtons) # TO EDIT

HS4DigitMonthly$detrended <- resid(lm(`aço bruto (tons)` ~ fYear + fMonth, HS4DigitMonthly))
# acoBrutoPLMaggregate <- plm(detrended ~ imports*partner + exports*partner + BrazilGDP_PPP,data = HS4DigitMonthly, effect = "individual",
#                model = "within",
#                index = "partner")
acoBrutoPLMdisggregate <- plm(detrended ~ (Imp7227+Imp7218)*(partner=="China") + (Exp7227+Exp7218)*(partner=="China") + BrazilGDP_PPP,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
# summary(acoBrutoPLMaggregate)
# summary(acoBrutoPLMdisggregate)





# Laminates
laminadosHS <- c(7225, 7220, 7221, 7219, 7227, 7208, 7210, 7213, 7211, 7212, 7226) # TO EDIT
laminadosLMtons <- # TO EDIT
  lm(`laminados (tons)` ~  # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      (partner=="China")*(Imp7225 + Imp7220 + Imp7221 + Imp7219 + Imp7227 + Imp7208 + Imp7210 + Imp7213 + Imp7211 + Imp7212 + Imp7226) + (partner=="China")*(Exp7225 + Exp7220 + Exp7221 + Exp7219 + Exp7227 + Exp7208 + Exp7210 + Exp7213 + Exp7211 + Exp7212 + Exp7226) +
       BrazilGDP_PPP , # TO EDIT
                    data = as.data.frame(HS4DigitMonthly)) # TO EDIT
# summary(laminadosLMtons) # TO EDIT

HS4DigitMonthly$detrended <- resid(lm(`laminados (tons)` ~ fYear + fMonth, HS4DigitMonthly))
# laminadosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner + BrazilGDP_PPP,data = laminadosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
laminadosPLMdisggregate <- plm(detrended ~ (Imp7225 + Imp7220 + Imp7221 + Imp7219 + Imp7227 + Imp7208 + Imp7210 + Imp7213 + Imp7211 + Imp7212 + Imp7226)*(partner=="China") + (Exp7225 + Exp7220 + Exp7221 + Exp7219 + Exp7227 + Exp7208 + Exp7210 + Exp7213 + Exp7211 + Exp7212 + Exp7226)*(partner=="China") + BrazilGDP_PPP,data = HS4DigitMonthly, effect = "individual",
               model = "within",
               index = "partner")
# summary(laminadosPLMdisggregate)
# summary(laminadosPLMdisggregate)$coefficients[c("Imp7225:partnerChina","Imp7213:partnerChina","Imp7226:partnerChina"),]
# summary(acoBrutoPLMaggregate)
# summary(acoBrutoPLMdisggregate)

```
```{r country-significance-counting, include=FALSE, cache=TRUE,warning=FALSE}
partners <- c("United States of America", "China", "Argentina", "Germany", "Japan", "Netherlands", "Italy", "Rep. of Korea", "France", "Mexico", "Chile", "United Kingdom", "Spain", "India", "Nigeria")

positiveAndSignificant <- function(row) {
  return(row[4] < 0.05 & row[1] > 0)
}

negativeAndSignificant <- function(row) {
  return(row[4] < 0.05 & row[1] < 0)
}

# significant positive country coef col1
# significant positive imports interaction col2
# significant positive exports interaction col3
# significant negative country coef col4
# significant negative imports interaction col5
# significant negative exports interaction col6

partnersCountingMatrix <- matrix(0,nrow=10,ncol=6)

for (i in c(1:10)) {
  print("*****ROUND****")
  print(i)
  print("*****COUNTRY****")
  print(partners[i])
  
  BECtibble1Digit <- BECtibble1Digit %>% mutate(countryDummy = (partner==partners[i]))
  BECtibble2Digit <- BECtibble2Digit %>% mutate(countryDummy = (partner==partners[i]))
  BECtibble3Digit <- BECtibble3Digit %>% mutate(countryDummy = (partner==partners[i]))

# BEC 4
BEC4 <- lm(`1 Bens de capital` ~
              ImpBEC4 + ExpBEC4 + fYear + fMonth + countryDummy + countryDummy*ImpBEC4 +
              countryDummy*ExpBEC4 + BrazilGDP_PPP
              + escritórioInformáticaComunicação+veículosMotosPartesPeças,data =
              as.data.frame(BECtibble1Digit))
BECtibble1Digit$detrended <- resid(lm(`1 Bens de capital` ~ fYear + fMonth, BECtibble1Digit))
BEC4plm <- plm(detrended ~ ImpBEC4*countryDummy + ExpBEC4*countryDummy + BrazilGDP_PPP+escritórioInformáticaComunicação+veículosMotosPartesPeças,data = BECtibble1Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 41
BEC41 <- lm(`110 Bens de capital, exceto equipamentos de transporte industrial` ~ 
              ImpBEC41 + ExpBEC41 + fYear + fMonth + countryDummy + countryDummy*ImpBEC41 +
              countryDummy*ExpBEC41 + BrazilGDP_PPP
              + escritórioInformáticaComunicação,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`110 Bens de capital, exceto equipamentos de transporte industrial` ~ fYear + fMonth, BECtibble2Digit))
BEC41plm <- plm(detrended ~ countryDummy*ImpBEC41 + countryDummy*ExpBEC41 + BrazilGDP_PPP + escritórioInformáticaComunicação, data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 5
BEC521 <- lm(`120 Equipamentos de transporte industrial` ~
              ImpBEC521 + ExpBEC521 + fYear + fMonth + countryDummy + countryDummy*ImpBEC521 +
              countryDummy*ExpBEC521
               + BrazilGDP_PPP +veículosMotosPartesPeças,data =
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`120 Equipamentos de transporte industrial` ~ fYear + fMonth, BECtibble3Digit))
BEC215plm <- plm(detrended ~ countryDummy*ImpBEC521 + countryDummy*ExpBEC521 + BrazilGDP_PPP +veículosMotosPartesPeças,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 111
BEC111 <- lm(`210 Alimentos e bebidas básicos, destinados principalmente à indústria` ~ 
              ImpBEC111 + ExpBEC111 + fYear + fMonth + countryDummy + countryDummy*ImpBEC111 +
              countryDummy*ExpBEC111 + BrazilGDP_PPP +hipermercadosProdutosAlimentíciosBebidasFumo
              ,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`210 Alimentos e bebidas básicos, destinados principalmente à indústria` ~ fYear + fMonth, BECtibble3Digit))
BEC111plm <- plm(detrended ~ countryDummy*ImpBEC111 + countryDummy*ExpBEC111 + BrazilGDP_PPP +hipermercadosProdutosAlimentíciosBebidasFumo,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 121
BEC121 <- lm(`220 Alimentos e bebidas elaborados, destinados principalmente à indústria` ~ 
              ImpBEC121 + ExpBEC121 + fYear + fMonth + countryDummy + countryDummy*ImpBEC121 +
              countryDummy*ExpBEC121
               + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`220 Alimentos e bebidas elaborados, destinados principalmente à indústria` ~ fYear + fMonth, BECtibble3Digit))
BEC121plm <- plm(detrended ~ countryDummy*ImpBEC121 + countryDummy*ExpBEC121  + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 21
BEC21 <- lm(`230 Insumos industriais básicos` ~ 
              ImpBEC21 + ExpBEC21 + fYear + fMonth + countryDummy + countryDummy*ImpBEC21 +
              countryDummy*ExpBEC21
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`230 Insumos industriais básicos` ~ fYear + fMonth, BECtibble2Digit))
BEC21plm <- plm(detrended ~ countryDummy*ImpBEC21 + countryDummy*ExpBEC21  + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 22
BEC22 <- lm(`240 Insumos industriais elaborados` ~ 
              ImpBEC22 + ExpBEC22 + fYear + fMonth + countryDummy + countryDummy*ImpBEC22 +
              countryDummy*ExpBEC22
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`240 Insumos industriais elaborados` ~ fYear + fMonth, BECtibble2Digit))
BEC22plm <- plm(detrended ~ countryDummy*ImpBEC22 + countryDummy*ExpBEC22 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 31
BEC31 <- lm(`250 Combustíveis e lubrificantes básicos` ~ 
              ImpBEC31 + ExpBEC31 + fYear + fMonth + countryDummy + countryDummy*ImpBEC31 +
              countryDummy*ExpBEC31
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`250 Combustíveis e lubrificantes básicos` ~ fYear + fMonth, BECtibble2Digit))
BEC31plm <- plm(detrended ~ countryDummy*ImpBEC31 + countryDummy*ExpBEC31 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 322
BEC322 <- lm(`260 Combustíveis e lubrificantes elaborados - exceto gasolinas para automóvel` ~ 
              ImpBEC322 + ExpBEC322 + fYear + fMonth + countryDummy + countryDummy*ImpBEC322 +
              countryDummy*ExpBEC322
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`260 Combustíveis e lubrificantes elaborados - exceto gasolinas para automóvel` ~ fYear + fMonth, BECtibble3Digit))
BEC322plm <- plm(detrended ~ countryDummy*ImpBEC322 + countryDummy*ExpBEC322 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 42
BEC42 <- lm(`270 Peças e acessórios para bens de capital` ~ 
              ImpBEC42 + ExpBEC42 + fYear + fMonth + countryDummy + countryDummy*ImpBEC42 +
              countryDummy*ExpBEC42
               + BrazilGDP_PPP+veículosMotosPartesPeças+escritórioInformáticaComunicação,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`270 Peças e acessórios para bens de capital` ~ fYear + fMonth, BECtibble2Digit))
BEC42plm <- plm(detrended ~ countryDummy*ImpBEC42 + countryDummy*ExpBEC42 + BrazilGDP_PPP+veículosMotosPartesPeças+escritórioInformáticaComunicação,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 53
BEC53 <- lm(`280 Peças e acessórios para equipamentos de transporte` ~ 
              ImpBEC53 + ExpBEC53 + fYear + fMonth + countryDummy + countryDummy*ImpBEC53 +
              countryDummy*ExpBEC53
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`280 Peças e acessórios para equipamentos de transporte` ~ fYear + fMonth, BECtibble2Digit))
BEC53plm <- plm(detrended ~ countryDummy*ImpBEC53 + countryDummy*ExpBEC53 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 6
BEC6 <- lm(`3 Bens de consumo` ~
              ImpBEC6 + ExpBEC6 + fYear + fMonth + countryDummy + countryDummy*ImpBEC6 +
              countryDummy*ExpBEC6
               + BrazilGDP_PPP+varejoTotal,data =
              as.data.frame(BECtibble1Digit))
BECtibble1Digit$detrended <- resid(lm(`3 Bens de consumo` ~ fYear + fMonth, BECtibble1Digit))
BEC6plm <- plm(detrended ~ countryDummy*ImpBEC6 + countryDummy*ExpBEC6 + BrazilGDP_PPP+varejoTotal,data = BECtibble1Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 61
BEC61 <- lm(`31 Bens de consumo duráveis` ~ 
              ImpBEC61 + ExpBEC61 + fYear + fMonth + countryDummy + countryDummy*ImpBEC61 +
              countryDummy*ExpBEC61
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`31 Bens de consumo duráveis` ~ fYear + fMonth, BECtibble2Digit))
BEC61plm <- plm(detrended ~ countryDummy*ImpBEC61 + countryDummy*ExpBEC61 + BrazilGDP_PPP+varejoTotal,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 51
BEC51 <- lm(`312 Automóveis para passageiros` ~ 
              ImpBEC51 + ExpBEC51 + fYear + fMonth + countryDummy + countryDummy*ImpBEC51 +
              countryDummy*ExpBEC51
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`312 Automóveis para passageiros` ~ fYear + fMonth, BECtibble2Digit))
BEC51plm <- plm(detrended ~ countryDummy*ImpBEC51 + countryDummy*ExpBEC51 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 522
BEC522 <- lm(`313 Equipamentos de transporte não industrial` ~ 
              ImpBEC522 + ExpBEC522 + fYear + fMonth + countryDummy + countryDummy*ImpBEC522 +
              countryDummy*ExpBEC522
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`313 Equipamentos de transporte não industrial` ~ fYear + fMonth, BECtibble3Digit))
BEC522plm <- plm(detrended ~ countryDummy*ImpBEC522 + countryDummy*ExpBEC522 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 62
BEC62 <- lm(`321 Bens de consumo semiduráveis` ~ 
              ImpBEC62 + ExpBEC62 + fYear + fMonth + countryDummy + countryDummy*ImpBEC62 +
              countryDummy*ExpBEC62
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`321 Bens de consumo semiduráveis` ~ fYear + fMonth, BECtibble2Digit))
BEC62plm <- plm(detrended ~ countryDummy*ImpBEC62 + countryDummy*ExpBEC62 + BrazilGDP_PPP+varejoTotal,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 63
BEC63 <- lm(`322 Bens de consumo não duráveis` ~ 
              ImpBEC63 + ExpBEC63 + fYear + fMonth + countryDummy + countryDummy*ImpBEC63 +
              countryDummy*ExpBEC63
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`322 Bens de consumo não duráveis` ~ fYear + fMonth, BECtibble2Digit))
BEC63plm <- plm(detrended ~ countryDummy*ImpBEC63 + countryDummy*ExpBEC63 + BrazilGDP_PPP+varejoTotal,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 122
BEC122 <- lm(`324 Alimentos e bebidas elaborados, destinados principalmente ao consumo doméstico` ~ 
              ImpBEC122 + ExpBEC122 + fYear + fMonth + countryDummy + countryDummy*ImpBEC122 +
              countryDummy*ExpBEC122
               + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`324 Alimentos e bebidas elaborados, destinados principalmente ao consumo doméstico` ~ fYear + fMonth, BECtibble3Digit))
BEC122plm <- plm(detrended ~ countryDummy*ImpBEC122 + countryDummy*ExpBEC122 + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo
                 ,
                 data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")
summary(BEC122plm)

# BEC 7
BEC7 <- lm(`9 Bens não especificados anteriormente` ~ 
              ImpBEC7 + ExpBEC7 + fYear + fMonth + 
             # partner*ImpBEC7 + partner*ExpBEC7  + 
             BrazilGDP_PPP +
              + countryDummy + 
            
             countryDummy*ImpBEC7 +
              countryDummy*ExpBEC7
              +varejoTotal,data = 
              as.data.frame(BECtibble1Digit))
BECtibble1Digit$detrended <- resid(lm(`9 Bens não especificados anteriormente` ~ fYear + fMonth, BECtibble1Digit))
BEC7plm <- plm(detrended ~ countryDummy*ImpBEC7 + countryDummy*ExpBEC7 + BrazilGDP_PPP+varejoTotal,data = BECtibble1Digit, effect = "individual",
               model = "within",
               index = "partner")
  
positiveCountryCoef <- positiveAndSignificant(summary(BEC111)$coefficients[c("countryDummyTRUE"),]) + positiveAndSignificant(summary(BEC121)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC122)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC21)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC22)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC31)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC322)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC41)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC42)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC51)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC522)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC53)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC61)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC62)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC63)$coefficients[c("countryDummyTRUE"),]) +
  positiveAndSignificant(summary(BEC7)$coefficients[c("countryDummyTRUE"),]) + 
  positiveAndSignificant(summary(fixef(BEC111plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC121plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC122plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC21plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC22plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC31plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC322plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC41plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC42plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC51plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC522plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC53plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC61plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC62plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC63plm))[partners[i],])+
  positiveAndSignificant(summary(fixef(BEC7plm))[partners[i],])
  
 negativeCountryCoef <- negativeAndSignificant(summary(BEC111)$coefficients[c("countryDummyTRUE"),]) + negativeAndSignificant(summary(BEC121)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC122)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC21)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC22)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC31)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC322)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC41)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC42)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC51)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC522)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC53)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC61)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC62)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC63)$coefficients[c("countryDummyTRUE"),]) +
  negativeAndSignificant(summary(BEC7)$coefficients[c("countryDummyTRUE"),]) + 
  negativeAndSignificant(summary(fixef(BEC111plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC121plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC122plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC21plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC22plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC31plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC322plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC41plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC42plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC51plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC522plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC53plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC61plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC62plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC63plm))[partners[i],])+
  negativeAndSignificant(summary(fixef(BEC7plm))[partners[i],]) 


positiveImportCoef <- sum(
  positiveAndSignificant(summary(BEC111)$coefficients[c("ImpBEC111:countryDummyTRUE"),]),
  #positiveAndSignificant(summary(BEC111)$coefficients[c("ExpBEC111:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC111plm)$coefficients[c("countryDummyTRUE:ImpBEC111"),]),
#positiveAndSignificant(summary(BEC111plm)$coefficients[c("countryDummyTRUE:ExpBEC111"),]),
positiveAndSignificant(summary(BEC121)$coefficients[c("ImpBEC121:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC121)$coefficients[c("ExpBEC121:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC121plm)$coefficients[c("countryDummyTRUE:ImpBEC121"),]),
#positiveAndSignificant(summary(BEC121plm)$coefficients[c("countryDummyTRUE:ExpBEC121"),]),
positiveAndSignificant(summary(BEC122)$coefficients[c("ImpBEC122:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC122)$coefficients[c("ExpBEC122:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC122plm)$coefficients[c("countryDummyTRUE:ImpBEC122"),]),
#positiveAndSignificant(summary(BEC122plm)$coefficients[c("countryDummyTRUE:ExpBEC122"),]),
positiveAndSignificant(summary(BEC21)$coefficients[c("ImpBEC21:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC21)$coefficients[c("ExpBEC21:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC21plm)$coefficients[c("countryDummyTRUE:ImpBEC21"),]),
#positiveAndSignificant(summary(BEC21plm)$coefficients[c("countryDummyTRUE:ExpBEC21"),]),
positiveAndSignificant(summary(BEC22)$coefficients[c("ImpBEC22:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC22)$coefficients[c("ExpBEC22:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC22plm)$coefficients[c("countryDummyTRUE:ImpBEC22"),]),
#positiveAndSignificant(summary(BEC22plm)$coefficients[c("countryDummyTRUE:ExpBEC22"),]),
positiveAndSignificant(summary(BEC31)$coefficients[c("ImpBEC31:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC31)$coefficients[c("ExpBEC31:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC31plm)$coefficients[c("countryDummyTRUE:ImpBEC31"),]),
#positiveAndSignificant(summary(BEC31plm)$coefficients[c("countryDummyTRUE:ExpBEC31"),]),
positiveAndSignificant(summary(BEC322)$coefficients[c("ImpBEC322:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC322)$coefficients[c("ExpBEC322:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC322plm)$coefficients[c("countryDummyTRUE:ImpBEC322"),]),
#positiveAndSignificant(summary(BEC322plm)$coefficients[c("countryDummyTRUE:ExpBEC322"),]),
positiveAndSignificant(summary(BEC41)$coefficients[c("ImpBEC41:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC41)$coefficients[c("ExpBEC41:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC41plm)$coefficients[c("countryDummyTRUE:ImpBEC41"),]),
#positiveAndSignificant(summary(BEC41plm)$coefficients[c("countryDummyTRUE:ExpBEC41"),]),
positiveAndSignificant(summary(BEC42)$coefficients[c("ImpBEC42:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC42)$coefficients[c("ExpBEC42:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC42plm)$coefficients[c("countryDummyTRUE:ImpBEC42"),]),
#positiveAndSignificant(summary(BEC42plm)$coefficients[c("countryDummyTRUE:ExpBEC42"),]),
positiveAndSignificant(summary(BEC51)$coefficients[c("ImpBEC51:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC51)$coefficients[c("ExpBEC51:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC51plm)$coefficients[c("countryDummyTRUE:ImpBEC51"),]),
#positiveAndSignificant(summary(BEC51plm)$coefficients[c("countryDummyTRUE:ExpBEC51"),]),
positiveAndSignificant(summary(BEC522)$coefficients[c("ImpBEC522:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC522)$coefficients[c("ExpBEC522:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC522plm)$coefficients[c("countryDummyTRUE:ImpBEC522"),]),
#positiveAndSignificant(summary(BEC522plm)$coefficients[c("countryDummyTRUE:ExpBEC522"),]),
positiveAndSignificant(summary(BEC53)$coefficients[c("ImpBEC53:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC53)$coefficients[c("ExpBEC53:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC53plm)$coefficients[c("countryDummyTRUE:ImpBEC53"),]),
#positiveAndSignificant(summary(BEC53plm)$coefficients[c("countryDummyTRUE:ExpBEC53"),]),
positiveAndSignificant(summary(BEC61)$coefficients[c("ImpBEC61:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC61)$coefficients[c("ExpBEC61:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC61plm)$coefficients[c("countryDummyTRUE:ImpBEC61"),]),
#positiveAndSignificant(summary(BEC61plm)$coefficients[c("countryDummyTRUE:ExpBEC61"),]),
positiveAndSignificant(summary(BEC62)$coefficients[c("ImpBEC62:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC62)$coefficients[c("ExpBEC62:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC62plm)$coefficients[c("countryDummyTRUE:ImpBEC62"),]),
#positiveAndSignificant(summary(BEC62plm)$coefficients[c("countryDummyTRUE:ExpBEC62"),]),
positiveAndSignificant(summary(BEC63)$coefficients[c("ImpBEC63:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC63)$coefficients[c("ExpBEC63:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC63plm)$coefficients[c("countryDummyTRUE:ImpBEC63"),]),
#positiveAndSignificant(summary(BEC63plm)$coefficients[c("countryDummyTRUE:ImpBEC63"),]),
positiveAndSignificant(summary(BEC7)$coefficients[c("ImpBEC7:countryDummyTRUE"),]),
#positiveAndSignificant(summary(BEC7)$coefficients[c("ExpBEC7:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC7plm)$coefficients[c("countryDummyTRUE:ImpBEC7"),])
#positiveAndSignificant(summary(BEC7plm)$coefficients[c("countryDummyTRUE:ExpBEC7"),])
)
  
 negativeImportCoef <- sum(
  negativeAndSignificant(summary(BEC111)$coefficients[c("ImpBEC111:countryDummyTRUE"),]),
  #negativeAndSignificant(summary(BEC111)$coefficients[c("ExpBEC111:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC111plm)$coefficients[c("countryDummyTRUE:ImpBEC111"),]),
#negativeAndSignificant(summary(BEC111plm)$coefficients[c("countryDummyTRUE:ExpBEC111"),]),
negativeAndSignificant(summary(BEC121)$coefficients[c("ImpBEC121:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC121)$coefficients[c("ExpBEC121:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC121plm)$coefficients[c("countryDummyTRUE:ImpBEC121"),]),
#negativeAndSignificant(summary(BEC121plm)$coefficients[c("countryDummyTRUE:ExpBEC121"),]),
negativeAndSignificant(summary(BEC122)$coefficients[c("ImpBEC122:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC122)$coefficients[c("ExpBEC122:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC122plm)$coefficients[c("countryDummyTRUE:ImpBEC122"),]),
#negativeAndSignificant(summary(BEC122plm)$coefficients[c("countryDummyTRUE:ExpBEC122"),]),
negativeAndSignificant(summary(BEC21)$coefficients[c("ImpBEC21:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC21)$coefficients[c("ExpBEC21:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC21plm)$coefficients[c("countryDummyTRUE:ImpBEC21"),]),
#negativeAndSignificant(summary(BEC21plm)$coefficients[c("countryDummyTRUE:ExpBEC21"),]),
negativeAndSignificant(summary(BEC22)$coefficients[c("ImpBEC22:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC22)$coefficients[c("ExpBEC22:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC22plm)$coefficients[c("countryDummyTRUE:ImpBEC22"),]),
#negativeAndSignificant(summary(BEC22plm)$coefficients[c("countryDummyTRUE:ExpBEC22"),]),
negativeAndSignificant(summary(BEC31)$coefficients[c("ImpBEC31:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC31)$coefficients[c("ExpBEC31:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC31plm)$coefficients[c("countryDummyTRUE:ImpBEC31"),]),
#negativeAndSignificant(summary(BEC31plm)$coefficients[c("countryDummyTRUE:ExpBEC31"),]),
negativeAndSignificant(summary(BEC322)$coefficients[c("ImpBEC322:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC322)$coefficients[c("ExpBEC322:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC322plm)$coefficients[c("countryDummyTRUE:ImpBEC322"),]),
#negativeAndSignificant(summary(BEC322plm)$coefficients[c("countryDummyTRUE:ExpBEC322"),]),
negativeAndSignificant(summary(BEC41)$coefficients[c("ImpBEC41:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC41)$coefficients[c("ExpBEC41:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC41plm)$coefficients[c("countryDummyTRUE:ImpBEC41"),]),
#negativeAndSignificant(summary(BEC41plm)$coefficients[c("countryDummyTRUE:ExpBEC41"),]),
negativeAndSignificant(summary(BEC42)$coefficients[c("ImpBEC42:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC42)$coefficients[c("ExpBEC42:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC42plm)$coefficients[c("countryDummyTRUE:ImpBEC42"),]),
#negativeAndSignificant(summary(BEC42plm)$coefficients[c("countryDummyTRUE:ExpBEC42"),]),
negativeAndSignificant(summary(BEC51)$coefficients[c("ImpBEC51:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC51)$coefficients[c("ExpBEC51:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC51plm)$coefficients[c("countryDummyTRUE:ImpBEC51"),]),
#negativeAndSignificant(summary(BEC51plm)$coefficients[c("countryDummyTRUE:ExpBEC51"),]),
negativeAndSignificant(summary(BEC522)$coefficients[c("ImpBEC522:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC522)$coefficients[c("ExpBEC522:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC522plm)$coefficients[c("countryDummyTRUE:ImpBEC522"),]),
#negativeAndSignificant(summary(BEC522plm)$coefficients[c("countryDummyTRUE:ExpBEC522"),]),
negativeAndSignificant(summary(BEC53)$coefficients[c("ImpBEC53:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC53)$coefficients[c("ExpBEC53:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC53plm)$coefficients[c("countryDummyTRUE:ImpBEC53"),]),
#negativeAndSignificant(summary(BEC53plm)$coefficients[c("countryDummyTRUE:ExpBEC53"),]),
negativeAndSignificant(summary(BEC61)$coefficients[c("ImpBEC61:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC61)$coefficients[c("ExpBEC61:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC61plm)$coefficients[c("countryDummyTRUE:ImpBEC61"),]),
#negativeAndSignificant(summary(BEC61plm)$coefficients[c("countryDummyTRUE:ExpBEC61"),]),
negativeAndSignificant(summary(BEC62)$coefficients[c("ImpBEC62:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC62)$coefficients[c("ExpBEC62:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC62plm)$coefficients[c("countryDummyTRUE:ImpBEC62"),]),
#negativeAndSignificant(summary(BEC62plm)$coefficients[c("countryDummyTRUE:ExpBEC62"),]),
negativeAndSignificant(summary(BEC63)$coefficients[c("ImpBEC63:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC63)$coefficients[c("ExpBEC63:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC63plm)$coefficients[c("countryDummyTRUE:ImpBEC63"),]),
#negativeAndSignificant(summary(BEC63plm)$coefficients[c("countryDummyTRUE:ImpBEC63"),]),
negativeAndSignificant(summary(BEC7)$coefficients[c("ImpBEC7:countryDummyTRUE"),]),
#negativeAndSignificant(summary(BEC7)$coefficients[c("ExpBEC7:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC7plm)$coefficients[c("countryDummyTRUE:ImpBEC7"),])
#negativeAndSignificant(summary(BEC7plm)$coefficients[c("countryDummyTRUE:ExpBEC7"),])
)
   
positiveExportCoef <- sum(
  positiveAndSignificant(summary(BEC111)$coefficients[c("ExpBEC111:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC111plm)$coefficients[c("countryDummyTRUE:ExpBEC111"),]),
positiveAndSignificant(summary(BEC121)$coefficients[c("ExpBEC121:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC121plm)$coefficients[c("countryDummyTRUE:ExpBEC121"),]),
positiveAndSignificant(summary(BEC122)$coefficients[c("ExpBEC122:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC122plm)$coefficients[c("countryDummyTRUE:ExpBEC122"),]),
positiveAndSignificant(summary(BEC21)$coefficients[c("ExpBEC21:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC21plm)$coefficients[c("countryDummyTRUE:ExpBEC21"),]),
positiveAndSignificant(summary(BEC22)$coefficients[c("ExpBEC22:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC22plm)$coefficients[c("countryDummyTRUE:ExpBEC22"),]),
positiveAndSignificant(summary(BEC31)$coefficients[c("ExpBEC31:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC31plm)$coefficients[c("countryDummyTRUE:ExpBEC31"),]),
positiveAndSignificant(summary(BEC322)$coefficients[c("ExpBEC322:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC322plm)$coefficients[c("countryDummyTRUE:ExpBEC322"),]),
positiveAndSignificant(summary(BEC41)$coefficients[c("ExpBEC41:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC41plm)$coefficients[c("countryDummyTRUE:ExpBEC41"),]),
positiveAndSignificant(summary(BEC42)$coefficients[c("ExpBEC42:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC42plm)$coefficients[c("countryDummyTRUE:ExpBEC42"),]),
positiveAndSignificant(summary(BEC51)$coefficients[c("ExpBEC51:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC51plm)$coefficients[c("countryDummyTRUE:ExpBEC51"),]),
positiveAndSignificant(summary(BEC522)$coefficients[c("ExpBEC522:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC522plm)$coefficients[c("countryDummyTRUE:ExpBEC522"),]),
positiveAndSignificant(summary(BEC53)$coefficients[c("ExpBEC53:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC53plm)$coefficients[c("countryDummyTRUE:ExpBEC53"),]),
positiveAndSignificant(summary(BEC61)$coefficients[c("ExpBEC61:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC61plm)$coefficients[c("countryDummyTRUE:ExpBEC61"),]),
positiveAndSignificant(summary(BEC62)$coefficients[c("ExpBEC62:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC62plm)$coefficients[c("countryDummyTRUE:ExpBEC62"),]),
positiveAndSignificant(summary(BEC63)$coefficients[c("ExpBEC63:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC63plm)$coefficients[c("countryDummyTRUE:ImpBEC63"),]),
positiveAndSignificant(summary(BEC7)$coefficients[c("ExpBEC7:countryDummyTRUE"),]),
positiveAndSignificant(summary(BEC7plm)$coefficients[c("countryDummyTRUE:ExpBEC7"),])
)


negativeExportCoef <- sum(
  negativeAndSignificant(summary(BEC111)$coefficients[c("ExpBEC111:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC111plm)$coefficients[c("countryDummyTRUE:ExpBEC111"),]),
negativeAndSignificant(summary(BEC121)$coefficients[c("ExpBEC121:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC121plm)$coefficients[c("countryDummyTRUE:ExpBEC121"),]),
negativeAndSignificant(summary(BEC122)$coefficients[c("ExpBEC122:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC122plm)$coefficients[c("countryDummyTRUE:ExpBEC122"),]),
negativeAndSignificant(summary(BEC21)$coefficients[c("ExpBEC21:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC21plm)$coefficients[c("countryDummyTRUE:ExpBEC21"),]),
negativeAndSignificant(summary(BEC22)$coefficients[c("ExpBEC22:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC22plm)$coefficients[c("countryDummyTRUE:ExpBEC22"),]),
negativeAndSignificant(summary(BEC31)$coefficients[c("ExpBEC31:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC31plm)$coefficients[c("countryDummyTRUE:ExpBEC31"),]),
negativeAndSignificant(summary(BEC322)$coefficients[c("ExpBEC322:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC322plm)$coefficients[c("countryDummyTRUE:ExpBEC322"),]),
negativeAndSignificant(summary(BEC41)$coefficients[c("ExpBEC41:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC41plm)$coefficients[c("countryDummyTRUE:ExpBEC41"),]),
negativeAndSignificant(summary(BEC42)$coefficients[c("ExpBEC42:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC42plm)$coefficients[c("countryDummyTRUE:ExpBEC42"),]),
negativeAndSignificant(summary(BEC51)$coefficients[c("ExpBEC51:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC51plm)$coefficients[c("countryDummyTRUE:ExpBEC51"),]),
negativeAndSignificant(summary(BEC522)$coefficients[c("ExpBEC522:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC522plm)$coefficients[c("countryDummyTRUE:ExpBEC522"),]),
negativeAndSignificant(summary(BEC53)$coefficients[c("ExpBEC53:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC53plm)$coefficients[c("countryDummyTRUE:ExpBEC53"),]),
negativeAndSignificant(summary(BEC61)$coefficients[c("ExpBEC61:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC61plm)$coefficients[c("countryDummyTRUE:ExpBEC61"),]),
negativeAndSignificant(summary(BEC62)$coefficients[c("ExpBEC62:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC62plm)$coefficients[c("countryDummyTRUE:ExpBEC62"),]),
negativeAndSignificant(summary(BEC63)$coefficients[c("ExpBEC63:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC63plm)$coefficients[c("countryDummyTRUE:ImpBEC63"),]),
negativeAndSignificant(summary(BEC7)$coefficients[c("ExpBEC7:countryDummyTRUE"),]),
negativeAndSignificant(summary(BEC7plm)$coefficients[c("countryDummyTRUE:ExpBEC7"),])
)

# significant positive country coef col1
# significant positive imports interaction col2
# significant positive exports interaction col3
# significant negative country coef col4
# significant negative imports interaction col5
# significant negative exports interaction col6

partnersCountingMatrix[i,1] <- positiveCountryCoef
partnersCountingMatrix[i,2] <- positiveImportCoef
partnersCountingMatrix[i,3] <- positiveExportCoef
partnersCountingMatrix[i,4] <- negativeCountryCoef
partnersCountingMatrix[i,5] <- negativeImportCoef
partnersCountingMatrix[i,6] <- negativeExportCoef


}

```
```{r BEC-regressions, include=FALSE, cache=TRUE,warning=FALSE}
# BEC 4
BEC4 <- lm(`1 Bens de capital` ~
              ImpBEC4 + ExpBEC4 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC4 +
              (partner=="China")*ExpBEC4 + BrazilGDP_PPP
              + escritórioInformáticaComunicação+veículosMotosPartesPeças,data =
              as.data.frame(BECtibble1Digit))
BECtibble1Digit$detrended <- resid(lm(`1 Bens de capital` ~ fYear + fMonth, BECtibble1Digit))
BEC4plm <- plm(detrended ~ ImpBEC4*(partner=="China") + ExpBEC4*(partner=="China") + BrazilGDP_PPP+escritórioInformáticaComunicação+veículosMotosPartesPeças,data = BECtibble1Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 41
BEC41 <- lm(`110 Bens de capital, exceto equipamentos de transporte industrial` ~ 
              ImpBEC41 + ExpBEC41 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC41 +
              (partner=="China")*ExpBEC41 + BrazilGDP_PPP
              + escritórioInformáticaComunicação,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`110 Bens de capital, exceto equipamentos de transporte industrial` ~ fYear + fMonth, BECtibble2Digit))
BEC41plm <- plm(detrended ~ (partner=="China")*ImpBEC41 + (partner=="China")*ExpBEC41 + BrazilGDP_PPP + escritórioInformáticaComunicação, data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 5
BEC521 <- lm(`120 Equipamentos de transporte industrial` ~
              ImpBEC521 + ExpBEC521 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC521 +
              (partner=="China")*ExpBEC521
               + BrazilGDP_PPP +veículosMotosPartesPeças,data =
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`120 Equipamentos de transporte industrial` ~ fYear + fMonth, BECtibble3Digit))
BEC215plm <- plm(detrended ~ (partner=="China")*ImpBEC521 + (partner=="China")*ExpBEC521 + BrazilGDP_PPP +veículosMotosPartesPeças,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 111
BEC111 <- lm(`210 Alimentos e bebidas básicos, destinados principalmente à indústria` ~ 
              ImpBEC111 + ExpBEC111 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC111 +
              (partner=="China")*ExpBEC111 + BrazilGDP_PPP +hipermercadosProdutosAlimentíciosBebidasFumo
              ,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`210 Alimentos e bebidas básicos, destinados principalmente à indústria` ~ fYear + fMonth, BECtibble3Digit))
BEC111plm <- plm(detrended ~ (partner=="China")*ImpBEC111 + (partner=="China")*ExpBEC111 + BrazilGDP_PPP +hipermercadosProdutosAlimentíciosBebidasFumo,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 121
BEC121 <- lm(`220 Alimentos e bebidas elaborados, destinados principalmente à indústria` ~ 
              ImpBEC121 + ExpBEC121 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC121 +
              (partner=="China")*ExpBEC121
               + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`220 Alimentos e bebidas elaborados, destinados principalmente à indústria` ~ fYear + fMonth, BECtibble3Digit))
BEC121plm <- plm(detrended ~ (partner=="China")*ImpBEC121 + (partner=="China")*ExpBEC121  + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 21
BEC21 <- lm(`230 Insumos industriais básicos` ~ 
              ImpBEC21 + ExpBEC21 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC21 +
              (partner=="China")*ExpBEC21
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`230 Insumos industriais básicos` ~ fYear + fMonth, BECtibble2Digit))
BEC21plm <- plm(detrended ~ (partner=="China")*ImpBEC21 + (partner=="China")*ExpBEC21  + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 22
BEC22 <- lm(`240 Insumos industriais elaborados` ~ 
              ImpBEC22 + ExpBEC22 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC22 +
              (partner=="China")*ExpBEC22
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`240 Insumos industriais elaborados` ~ fYear + fMonth, BECtibble2Digit))
BEC22plm <- plm(detrended ~ (partner=="China")*ImpBEC22 + (partner=="China")*ExpBEC22 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 31
BEC31 <- lm(`250 Combustíveis e lubrificantes básicos` ~ 
              ImpBEC31 + ExpBEC31 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC31 +
              (partner=="China")*ExpBEC31
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`250 Combustíveis e lubrificantes básicos` ~ fYear + fMonth, BECtibble2Digit))
BEC31plm <- plm(detrended ~ (partner=="China")*ImpBEC31 + (partner=="China")*ExpBEC31 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 322
BEC322 <- lm(`260 Combustíveis e lubrificantes elaborados - exceto gasolinas para automóvel` ~ 
              ImpBEC322 + ExpBEC322 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC322 +
              (partner=="China")*ExpBEC322
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`260 Combustíveis e lubrificantes elaborados - exceto gasolinas para automóvel` ~ fYear + fMonth, BECtibble3Digit))
BEC322plm <- plm(detrended ~ (partner=="China")*ImpBEC322 + (partner=="China")*ExpBEC322 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 42
BEC42 <- lm(`270 Peças e acessórios para bens de capital` ~ 
              ImpBEC42 + ExpBEC42 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC42 +
              (partner=="China")*ExpBEC42
               + BrazilGDP_PPP+veículosMotosPartesPeças+escritórioInformáticaComunicação,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`270 Peças e acessórios para bens de capital` ~ fYear + fMonth, BECtibble2Digit))
BEC42plm <- plm(detrended ~ (partner=="China")*ImpBEC42 + (partner=="China")*ExpBEC42 + BrazilGDP_PPP+veículosMotosPartesPeças+escritórioInformáticaComunicação,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 53
BEC53 <- lm(`280 Peças e acessórios para equipamentos de transporte` ~ 
              ImpBEC53 + ExpBEC53 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC53 +
              (partner=="China")*ExpBEC53
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`280 Peças e acessórios para equipamentos de transporte` ~ fYear + fMonth, BECtibble2Digit))
BEC53plm <- plm(detrended ~ (partner=="China")*ImpBEC53 + (partner=="China")*ExpBEC53 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 6
BEC6 <- lm(`3 Bens de consumo` ~
              ImpBEC6 + ExpBEC6 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC6 +
              (partner=="China")*ExpBEC6
               + BrazilGDP_PPP+varejoTotal,data =
              as.data.frame(BECtibble1Digit))
BECtibble1Digit$detrended <- resid(lm(`3 Bens de consumo` ~ fYear + fMonth, BECtibble1Digit))
BEC6plm <- plm(detrended ~ (partner=="China")*ImpBEC6 + (partner=="China")*ExpBEC6 + BrazilGDP_PPP+varejoTotal,data = BECtibble1Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 61
BEC61 <- lm(`31 Bens de consumo duráveis` ~ 
              ImpBEC61 + ExpBEC61 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC61 +
              (partner=="China")*ExpBEC61
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`31 Bens de consumo duráveis` ~ fYear + fMonth, BECtibble2Digit))
BEC61plm <- plm(detrended ~ (partner=="China")*ImpBEC61 + (partner=="China")*ExpBEC61 + BrazilGDP_PPP+varejoTotal,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 51
BEC51 <- lm(`312 Automóveis para passageiros` ~ 
              ImpBEC51 + ExpBEC51 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC51 +
              (partner=="China")*ExpBEC51
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`312 Automóveis para passageiros` ~ fYear + fMonth, BECtibble2Digit))
BEC51plm <- plm(detrended ~ (partner=="China")*ImpBEC51 + (partner=="China")*ExpBEC51 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

BEC51Exp <- lm(`312 Automóveis para passageiros` ~ 
               ExpBEC51 + fYear + fMonth + (partner=="China") +
              (partner=="China")*ExpBEC51
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`312 Automóveis para passageiros` ~ fYear + fMonth, BECtibble2Digit))
BEC51plmExp <- plm(detrended ~ (partner=="China")*ExpBEC51 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")



# BEC 522
BEC522 <- lm(`313 Equipamentos de transporte não industrial` ~ 
              ImpBEC522 + ExpBEC522 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC522 +
              (partner=="China")*ExpBEC522
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`313 Equipamentos de transporte não industrial` ~ fYear + fMonth, BECtibble3Digit))
BEC522plm <- plm(detrended ~ (partner=="China")*ImpBEC522 + (partner=="China")*ExpBEC522 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 62
BEC62 <- lm(`321 Bens de consumo semiduráveis` ~ 
              ImpBEC62 + ExpBEC62 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC62 +
              (partner=="China")*ExpBEC62
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`321 Bens de consumo semiduráveis` ~ fYear + fMonth, BECtibble2Digit))
BEC62plm <- plm(detrended ~ (partner=="China")*ImpBEC62 + (partner=="China")*ExpBEC62 + BrazilGDP_PPP+varejoTotal,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")


# BEC 63
BEC63 <- lm(`322 Bens de consumo não duráveis` ~ 
              ImpBEC63 + ExpBEC63 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC63 +
              (partner=="China")*ExpBEC63
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2Digit))
BECtibble2Digit$detrended <- resid(lm(`322 Bens de consumo não duráveis` ~ fYear + fMonth, BECtibble2Digit))
BEC63plm <- plm(detrended ~ (partner=="China")*ImpBEC63 + (partner=="China")*ExpBEC63 + BrazilGDP_PPP+varejoTotal,data = BECtibble2Digit, effect = "individual",
               model = "within",
               index = "partner")

# BEC 112 ALL NULL and IDK WHYYYYYY AHHH

# BEC112tibble <- tradeDataLong %>% group_by(flow,partner,fYear,fMonth,BEC) %>% summarise(value=sum(value)) %>%
#   ungroup() %>% left_join(PIM_PF_BEC, by=c("fYear"="year","fMonth"="month")) %>%
#   filter(PIM_PF_BEC=="323 Alimentos e bebidas básicos, destinados principalmente ao consumo doméstico") %>% # TO EDIT
#   mutate(row = row_number()) %>%
#   pivot_wider(names_from = PIM_PF_BEC, values_from=PIM_PF_BECindexValue) %>%
#   mutate(row=row_number()) %>%
#   filter(BEC == 112) %>% # TO EDIT
#   filter(flow=="Imports") %>%
#   pivot_wider(names_from=BEC,
#               names_prefix = "ImpBEC",
#               values_from=value) %>%
#   select(-row) %>%
#   left_join(tradeDataLong %>% group_by(flow,partner,fYear,fMonth,BEC) %>% summarise(value=sum(value)) %>%
#   ungroup() %>% left_join(PIM_PF_BEC, by=c("fYear"="year","fMonth"="month")) %>%
#   filter(PIM_PF_BEC=="323 Alimentos e bebidas básicos, destinados principalmente ao consumo doméstico") %>% # TO EDIT
#   mutate(row = row_number()) %>%
#   pivot_wider(names_from = PIM_PF_BEC, values_from=PIM_PF_BECindexValue) %>%
#   mutate(row=row_number()) %>%
#   filter(BEC == 112) %>% # TO EDIT
#   filter(flow=="Exports") %>%
#   pivot_wider(names_from=BEC,
#               names_prefix = "ExpBEC",
#               values_from=value) %>%
#     select(-row,-flow),
#   
#   by=c("partner"="partner",
#        "fYear"="fYear",
#        "fMonth"="fMonth",
#        "323 Alimentos e bebidas básicos, destinados principalmente ao consumo doméstico"= # TO EDIT
#          "323 Alimentos e bebidas básicos, destinados principalmente ao consumo doméstico")) # TO EDIT
# 
# BEC112 <- lm(`323 Alimentos e bebidas básicos, destinados principalmente ao consumo doméstico` ~ 
#               ImpBEC112 + ExpBEC112 + fYear + fMonth + partner + (partner=="China")*ImpBEC112 +
#               (partner=="China")*ExpBEC112
#               ,data = 
#               as.data.frame(BEC112tibble))
# summary(BEC112)

# BEC 122
BEC122 <- lm(`324 Alimentos e bebidas elaborados, destinados principalmente ao consumo doméstico` ~ 
              ImpBEC122 + ExpBEC122 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC122 +
              (partner=="China")*ExpBEC122
               + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = 
              as.data.frame(BECtibble3Digit))
BECtibble3Digit$detrended <- resid(lm(`324 Alimentos e bebidas elaborados, destinados principalmente ao consumo doméstico` ~ fYear + fMonth, BECtibble3Digit))
BEC122plm <- plm(detrended ~ (partner=="China")*ImpBEC122 + (partner=="China")*ExpBEC122 + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo
                 ,
                 data = BECtibble3Digit, effect = "individual",
               model = "within",
               index = "partner")
summary(BEC122plm)

# BEC 321 NOT FOUND IN HS BEC CONVERSION TABLE
# BEC321tibble <- tradeDataLong %>% group_by(flow,partner,fYear,fMonth,threeDigitBEC) %>% summarise(value=sum(value)) %>%
#   ungroup() %>% left_join(PIM_PF_BEC, by=c("fYear"="year","fMonth"="month")) %>%
#   filter(PIM_PF_BEC=="325 Gasolinas para automóvel (motor spirit)") %>% # TO EDIT
#   mutate(row = row_number()) %>%
#   pivot_wider(names_from = PIM_PF_BEC, values_from=PIM_PF_BECindexValue) %>%
#   mutate(row=row_number()) %>%
#   filter(threeDigitBEC == 321) %>% # TO EDIT
#   filter(flow=="Imports") %>%
#   pivot_wider(names_from=threeDigitBEC,
#               names_prefix = "ImpBEC",
#               values_from=value) %>%
#   select(-row) %>%
#   left_join(tradeDataLong %>% group_by(flow,partner,fYear,fMonth,threeDigitBEC) %>% summarise(value=sum(value)) %>%
#   ungroup() %>% left_join(PIM_PF_BEC, by=c("fYear"="year","fMonth"="month")) %>%
#   filter(PIM_PF_BEC=="325 Gasolinas para automóvel (motor spirit)") %>% # TO EDIT
#   mutate(row = row_number()) %>%
#   pivot_wider(names_from = PIM_PF_BEC, values_from=PIM_PF_BECindexValue) %>%
#   mutate(row=row_number()) %>%
#   filter(threeDigitBEC == 321) %>% # TO EDIT
#   filter(flow=="Exports") %>%
#   pivot_wider(names_from=threeDigitBEC,
#               names_prefix = "ExpBEC",
#               values_from=value) %>%
#     select(-row,-flow),
#   
#   by=c("partner"="partner",
#        "fYear"="fYear",
#        "fMonth"="fMonth",
#        "325 Gasolinas para automóvel (motor spirit)"= # TO EDIT
#          "325 Gasolinas para automóvel (motor spirit)")) # TO EDIT
# 
# BEC321 <- lm(`325 Gasolinas para automóvel (motor spirit)` ~ 
#               ImpBEC321 + ExpBEC321 + fYear + fMonth + partner + (partner=="China")*ImpBEC321 +
#               (partner=="China")*ExpBEC321
#               ,data = 
#               as.data.frame(BEC321tibble))
# summary(BEC321)

# BEC 7
BEC7 <- lm(`9 Bens não especificados anteriormente` ~ 
              ImpBEC7 + ExpBEC7 + fYear + fMonth + 
             # partner*ImpBEC7 + partner*ExpBEC7  + 
             BrazilGDP_PPP +
              + (partner=="China") + 
            
             (partner=="China")*ImpBEC7 +
              (partner=="China")*ExpBEC7
              +varejoTotal,data = 
              as.data.frame(BECtibble1Digit))
BECtibble1Digit$detrended <- resid(lm(`9 Bens não especificados anteriormente` ~ fYear + fMonth, BECtibble1Digit))
BEC7plm <- plm(detrended ~ (partner=="China")*ImpBEC7 + (partner=="China")*ExpBEC7 + BrazilGDP_PPP+varejoTotal,data = BECtibble1Digit, effect = "individual",
               model = "within",
               index = "partner")
```
```{r create-lagged-BEC-tibbles, include=FALSE, cache=TRUE,warning=FALSE}
# The regressions fucking finally
BECtibble1DigitLAGS <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,oneDigitBEC) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpBEC = case_when(
    flow == "Imports" ~ paste("ImpBEC",as.character(oneDigitBEC),sep=""),
    flow == "Exports" ~ paste("ExpBEC",as.character(oneDigitBEC),sep=""),
    TRUE ~ as.character(-1)
  ), year = as.double(as.character(fYear)),
  month = as.double(as.character(fMonth))) %>% 
  mutate(years = year + (month/12))
BECtibble1DigitLAGS <- BECtibble1DigitLAGS %>% left_join(BECtibble1DigitLAGS %>% mutate(yearLESS0.5 = years-0.5) %>% mutate(lag0.5 = value) %>% select(yearLESS0.5,partner,ImpExpBEC,lag0.5), by=c("years"="yearLESS0.5","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble1DigitLAGS %>% mutate(yearLESS1 = years-1) %>% mutate(lag1 = value) %>% select(yearLESS1,partner,ImpExpBEC,lag1), by=c("years"="yearLESS1","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble1DigitLAGS %>% mutate(yearLESS1.5 = years-1.5) %>% mutate(lag1.5 = value) %>% select(yearLESS1.5,partner,ImpExpBEC,lag1.5), by=c("years"="yearLESS1.5","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble1DigitLAGS %>% mutate(yearLESS2 = years-2) %>% mutate(lag2 = value) %>% select(yearLESS2,partner,ImpExpBEC,lag2), by=c("years"="yearLESS2","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>% mutate(lag0 = value,.keep="unused") %>%
  pivot_longer(cols=c("lag0","lag0.5","lag1","lag1.5","lag2"),names_to = "lags_column",values_to = "dollar_value") %>% mutate(new_col_names = paste(ImpExpBEC, lags_column, sep=""),.keep="unused") %>%
  left_join(PIM_PF_BEC, by=c("oneDigitBEC"="BEC", "fYear"="fYear", "fMonth"="fMonth")) %>%
  pivot_wider(names_from="new_col_names", values_from="dollar_value") %>%
  pivot_wider(names_from="PIM_PF_BEC", values_from="PIM_PF_BECindexValue") %>%
  select(-`NA`) %>%
  group_by(partner,fYear,fMonth,BrazilGDP_PPP) %>%
  summarise(across(ExpBEC1lag0:`9 Bens não especificados anteriormente`,
                   ~sum(.x,na.rm = TRUE))) %>%
  ungroup() %>%
  filter(as.double(as.character(fYear)) > 2001) %>%
  left_join(vendasVarejo, by=c("fYear"="fYear","fMonth"="fMonth"))




BECtibble2DigitLAGS <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,twoDigitBEC) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpBEC = case_when(
    flow == "Imports" ~ paste("ImpBEC",as.character(twoDigitBEC),sep=""),
    flow == "Exports" ~ paste("ExpBEC",as.character(twoDigitBEC),sep=""),
    TRUE ~ as.character(-1)
  ), year = as.double(as.character(fYear)),
  month = as.double(as.character(fMonth))) %>% 
  mutate(years = year + (month/12))
BECtibble2DigitLAGS <- BECtibble2DigitLAGS %>% left_join(BECtibble2DigitLAGS %>% mutate(yearLESS0.5 = years-0.5) %>% mutate(lag0.5 = value) %>% select(yearLESS0.5,partner,ImpExpBEC,lag0.5), by=c("years"="yearLESS0.5","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble2DigitLAGS %>% mutate(yearLESS1 = years-1) %>% mutate(lag1 = value) %>% select(yearLESS1,partner,ImpExpBEC,lag1), by=c("years"="yearLESS1","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble2DigitLAGS %>% mutate(yearLESS1.5 = years-1.5) %>% mutate(lag1.5 = value) %>% select(yearLESS1.5,partner,ImpExpBEC,lag1.5), by=c("years"="yearLESS1.5","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble2DigitLAGS %>% mutate(yearLESS2 = years-2) %>% mutate(lag2 = value) %>% select(yearLESS2,partner,ImpExpBEC,lag2), by=c("years"="yearLESS2","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>% mutate(lag0 = value,.keep="unused") %>%
  pivot_longer(cols=c("lag0","lag0.5","lag1","lag1.5","lag2"),names_to = "lags_column",values_to = "dollar_value") %>% mutate(new_col_names = paste(ImpExpBEC, lags_column, sep=""),.keep="unused") %>%
  left_join(PIM_PF_BEC, by=c("twoDigitBEC"="BEC", "fYear"="fYear", "fMonth"="fMonth")) %>%
  pivot_wider(names_from="new_col_names", values_from="dollar_value") %>%
  pivot_wider(names_from="PIM_PF_BEC", values_from="PIM_PF_BECindexValue") %>%
  select(-`NA`) %>%
  group_by(partner,fYear,fMonth,BrazilGDP_PPP) %>%
  summarise(across(ExpBEC7lag0:`322 Bens de consumo não duráveis`,
                   ~sum(.x,na.rm = TRUE))) %>%
  ungroup() %>%
  filter(as.double(as.character(fYear)) > 2001) %>%
  left_join(vendasVarejo, by=c("fYear"="fYear","fMonth"="fMonth"))



BECtibble3DigitLAGS <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,threeDigitBEC) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpBEC = case_when(
    flow == "Imports" ~ paste("ImpBEC",as.character(threeDigitBEC),sep=""),
    flow == "Exports" ~ paste("ExpBEC",as.character(threeDigitBEC),sep=""),
    TRUE ~ as.character(-1)
  ), year = as.double(as.character(fYear)),
  month = as.double(as.character(fMonth))) %>% 
  mutate(years = year + (month/12))
BECtibble3DigitLAGS <- BECtibble3DigitLAGS %>% left_join(BECtibble3DigitLAGS %>% mutate(yearLESS0.5 = years-0.5) %>% mutate(lag0.5 = value) %>% select(yearLESS0.5,partner,ImpExpBEC,lag0.5), by=c("years"="yearLESS0.5","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble3DigitLAGS %>% mutate(yearLESS1 = years-1) %>% mutate(lag1 = value) %>% select(yearLESS1,partner,ImpExpBEC,lag1), by=c("years"="yearLESS1","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble3DigitLAGS %>% mutate(yearLESS1.5 = years-1.5) %>% mutate(lag1.5 = value) %>% select(yearLESS1.5,partner,ImpExpBEC,lag1.5), by=c("years"="yearLESS1.5","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>%
  left_join(BECtibble3DigitLAGS %>% mutate(yearLESS2 = years-2) %>% mutate(lag2 = value) %>% select(yearLESS2,partner,ImpExpBEC,lag2), by=c("years"="yearLESS2","partner"="partner","ImpExpBEC"="ImpExpBEC")) %>% mutate(lag0 = value,.keep="unused") %>%
  pivot_longer(cols=c("lag0","lag0.5","lag1","lag1.5","lag2"),names_to = "lags_column",values_to = "dollar_value") %>% mutate(new_col_names = paste(ImpExpBEC, lags_column, sep=""),.keep="unused") %>%
  left_join(PIM_PF_BEC, by=c("threeDigitBEC"="BEC", "fYear"="fYear", "fMonth"="fMonth")) %>%
  pivot_wider(names_from="new_col_names", values_from="dollar_value") %>%
  pivot_wider(names_from="PIM_PF_BEC", values_from="PIM_PF_BECindexValue") %>%
  select(-`NA`) %>%
  group_by(partner,fYear,fMonth,BrazilGDP_PPP) %>%
  summarise(across(ExpBEC7lag0:`313 Equipamentos de transporte não industrial`,
                   ~sum(.x,na.rm = TRUE))) %>%
  ungroup() %>%
  filter(as.double(as.character(fYear)) > 2001) %>%
  left_join(vendasVarejo, by=c("fYear"="fYear","fMonth"="fMonth"))


```
```{r lagged-BEC-regressions, include=FALSE, cache=TRUE,warning=FALSE}
# BEC 4
BEC4LAGS <- lm(`1 Bens de capital` ~
              ImpBEC4lag0 + ExpBEC4lag0 + ImpBEC4lag0.5 + ExpBEC4lag0.5 + ImpBEC4lag1 + ExpBEC4lag1 + ImpBEC4lag1.5 + ExpBEC4lag1.5 + ImpBEC4lag2 + ExpBEC4lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC4lag0 +
              (partner=="China")*ExpBEC4lag0 + BrazilGDP_PPP
              + escritórioInformáticaComunicação+veículosMotosPartesPeças,data =
              as.data.frame(BECtibble1DigitLAGS))
BECtibble1DigitLAGS$detrended <- resid(lm(`1 Bens de capital` ~ fYear + fMonth, BECtibble1DigitLAGS))
BEC4plmLAGS <- plm(detrended ~ ImpBEC4lag0*(partner=="China") + ExpBEC4lag0*(partner=="China") + ImpBEC4lag0 + ExpBEC4lag0 + ImpBEC4lag0.5 + ExpBEC4lag0.5 + ImpBEC4lag1 + ExpBEC4lag1 + ImpBEC4lag1.5 + ExpBEC4lag1.5 + ImpBEC4lag2 + ExpBEC4lag2 + BrazilGDP_PPP+escritórioInformáticaComunicação+veículosMotosPartesPeças,data = BECtibble1DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 41
BEC41LAGS <- lm(`110 Bens de capital, exceto equipamentos de transporte industrial` ~ 
              ImpBEC41lag0 + ExpBEC41lag0 + ImpBEC41lag0.5 + ExpBEC41lag0.5 + ImpBEC41lag1 + ExpBEC41lag1 + ImpBEC41lag1.5 + ExpBEC41lag1.5 + ImpBEC41lag2 + ExpBEC41lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC41lag0 +
              (partner=="China")*ExpBEC41lag0 + BrazilGDP_PPP
              + escritórioInformáticaComunicação,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`110 Bens de capital, exceto equipamentos de transporte industrial` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC41plmLAGS <- plm(detrended ~ ImpBEC41lag0 + ExpBEC41lag0 + ImpBEC41lag0.5 + ExpBEC41lag0.5 + ImpBEC41lag1 + ExpBEC41lag1 + ImpBEC41lag1.5 + ExpBEC41lag1.5 + ImpBEC41lag2 + ExpBEC41lag2 + (partner=="China")*ImpBEC41lag0 + (partner=="China")*ExpBEC41lag0 + BrazilGDP_PPP + escritórioInformáticaComunicação, data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 5
BEC521LAGS <- lm(`120 Equipamentos de transporte industrial` ~
              ImpBEC521lag0 + ExpBEC521lag0 + ImpBEC521lag0.5 + ExpBEC521lag0.5 +ImpBEC521lag1 + ExpBEC521lag1 +ImpBEC521lag1.5 + ExpBEC521lag1.5 +ImpBEC521lag2 + ExpBEC521lag2 +fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC521lag0 +
              (partner=="China")*ExpBEC521lag0
               + BrazilGDP_PPP +veículosMotosPartesPeças,data =
              as.data.frame(BECtibble3DigitLAGS))
BECtibble3DigitLAGS$detrended <- resid(lm(`120 Equipamentos de transporte industrial` ~ fYear + fMonth, BECtibble3DigitLAGS))
BEC215plmLAGS <- plm(detrended ~ ImpBEC521lag0 + ExpBEC521lag0 + ImpBEC521lag0.5 + ExpBEC521lag0.5 +ImpBEC521lag1 + ExpBEC521lag1 +ImpBEC521lag1.5 + ExpBEC521lag1.5 +ImpBEC521lag2 + ExpBEC521lag2 + (partner=="China")*ImpBEC521lag0 + (partner=="China")*ExpBEC521lag0 + BrazilGDP_PPP +veículosMotosPartesPeças,data = BECtibble3DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 111
BEC111LAGS <- lm(`210 Alimentos e bebidas básicos, destinados principalmente à indústria` ~ 
              ImpBEC111lag0 + ExpBEC111lag0 + ImpBEC111lag0.5 + ExpBEC111lag0.5 + ImpBEC111lag1 + ExpBEC111lag1 + ImpBEC111lag1.5 + ExpBEC111lag1.5 + ImpBEC111lag2 + ExpBEC111lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC111lag0 +
              (partner=="China")*ExpBEC111lag0 + BrazilGDP_PPP +hipermercadosProdutosAlimentíciosBebidasFumo
              ,data = 
              as.data.frame(BECtibble3DigitLAGS))
BECtibble3DigitLAGS$detrended <- resid(lm(`210 Alimentos e bebidas básicos, destinados principalmente à indústria` ~ fYear + fMonth, BECtibble3DigitLAGS))
BEC111plmLAGS <- plm(detrended ~ ImpBEC111lag0 + ExpBEC111lag0 + ImpBEC111lag0.5 + ExpBEC111lag0.5 + ImpBEC111lag1 + ExpBEC111lag1 + ImpBEC111lag1.5 + ExpBEC111lag1.5 + ImpBEC111lag2 + ExpBEC111lag2 + (partner=="China")*ImpBEC111lag0 + (partner=="China")*ExpBEC111lag0 + BrazilGDP_PPP +hipermercadosProdutosAlimentíciosBebidasFumo,data = BECtibble3DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 121
BEC121LAGS <- lm(`220 Alimentos e bebidas elaborados, destinados principalmente à indústria` ~ 
              ImpBEC121lag0 + ExpBEC121lag0 + ImpBEC121lag0.5 + ExpBEC121lag0.5 + ImpBEC121lag1 + ExpBEC121lag1 + ImpBEC121lag1.5 + ExpBEC121lag1.5 + ImpBEC121lag2 + ExpBEC121lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC121lag0 +
              (partner=="China")*ExpBEC121lag0
               + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = 
              as.data.frame(BECtibble3DigitLAGS))
BECtibble3DigitLAGS$detrended <- resid(lm(`220 Alimentos e bebidas elaborados, destinados principalmente à indústria` ~ fYear + fMonth, BECtibble3DigitLAGS))
BEC121plmLAGS <- plm(detrended ~ ImpBEC121lag0 + ExpBEC121lag0 + ImpBEC121lag0.5 + ExpBEC121lag0.5 + ImpBEC121lag1 + ExpBEC121lag1 + ImpBEC121lag1.5 + ExpBEC121lag1.5 + ImpBEC121lag2 + ExpBEC121lag2 + (partner=="China")*ImpBEC121lag0 + (partner=="China")*ExpBEC121lag0  + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = BECtibble3DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 21
BEC21LAGS <- lm(`230 Insumos industriais básicos` ~ 
              ImpBEC21lag0 + ExpBEC21lag0 +ImpBEC21lag0.5 + ExpBEC21lag0.5 +ImpBEC21lag1 + ExpBEC21lag1 +ImpBEC21lag1.5 + ExpBEC21lag1.5 +ImpBEC21lag2 + ExpBEC21lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC21lag0 +
              (partner=="China")*ExpBEC21lag0
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`230 Insumos industriais básicos` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC21plmLAGS <- plm(detrended ~ ImpBEC21lag0 + ExpBEC21lag0 +ImpBEC21lag0.5 + ExpBEC21lag0.5 +ImpBEC21lag1 + ExpBEC21lag1 +ImpBEC21lag1.5 + ExpBEC21lag1.5 +ImpBEC21lag2 + ExpBEC21lag2 + (partner=="China")*ImpBEC21lag0 + (partner=="China")*ExpBEC21lag0  + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 22
BEC22LAGS <- lm(`240 Insumos industriais elaborados` ~ 
              ImpBEC22lag0 + ExpBEC22lag0 + ImpBEC22lag0.5 + ExpBEC22lag0.5 + ImpBEC22lag1 + ExpBEC22lag1 + ImpBEC22lag1.5 + ExpBEC22lag1.5 + ImpBEC22lag2 + ExpBEC22lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC22lag0 +
              (partner=="China")*ExpBEC22lag0
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`240 Insumos industriais elaborados` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC22plmLAGS <- plm(detrended ~ ImpBEC22lag0 + ExpBEC22lag0 + ImpBEC22lag0.5 + ExpBEC22lag0.5 + ImpBEC22lag1 + ExpBEC22lag1 + ImpBEC22lag1.5 + ExpBEC22lag1.5 + ImpBEC22lag2 + ExpBEC22lag2 + (partner=="China")*ImpBEC22lag0 + (partner=="China")*ExpBEC22lag0 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 31
BEC31LAGS <- lm(`250 Combustíveis e lubrificantes básicos` ~ 
              ImpBEC31lag0 + ExpBEC31lag0 + ImpBEC31lag0.5 + ExpBEC31lag0.5 + ImpBEC31lag1 + ExpBEC31lag1 + ImpBEC31lag1.5 + ExpBEC31lag1.5 + ImpBEC31lag2 + ExpBEC31lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC31lag0 +
              (partner=="China")*ExpBEC31lag0
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`250 Combustíveis e lubrificantes básicos` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC31plmLAGS <- plm(detrended ~ ImpBEC31lag0 + ExpBEC31lag0 + ImpBEC31lag0.5 + ExpBEC31lag0.5 + ImpBEC31lag1 + ExpBEC31lag1 + ImpBEC31lag1.5 + ExpBEC31lag1.5 + ImpBEC31lag2 + ExpBEC31lag2 + (partner=="China")*ImpBEC31lag0 + (partner=="China")*ExpBEC31lag0 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 322
BEC322LAGS <- lm(`260 Combustíveis e lubrificantes elaborados - exceto gasolinas para automóvel` ~ 
              ImpBEC322lag0 + ExpBEC322lag0 + ImpBEC322lag0.5 + ExpBEC322lag0.5 + ImpBEC322lag1 + ExpBEC322lag1 + ImpBEC322lag1.5 + ExpBEC322lag1.5 + ImpBEC322lag2 + ExpBEC322lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC322lag0 +
              (partner=="China")*ExpBEC322lag0
               + BrazilGDP_PPP+combustíveisLubrificantes,data = 
              as.data.frame(BECtibble3DigitLAGS))
BECtibble3DigitLAGS$detrended <- resid(lm(`260 Combustíveis e lubrificantes elaborados - exceto gasolinas para automóvel` ~ fYear + fMonth, BECtibble3DigitLAGS))
BEC322plmLAGS <- plm(detrended ~ ImpBEC322lag0 + ExpBEC322lag0 + ImpBEC322lag0.5 + ExpBEC322lag0.5 + ImpBEC322lag1 + ExpBEC322lag1 + ImpBEC322lag1.5 + ExpBEC322lag1.5 + ImpBEC322lag2 + ExpBEC322lag2 + (partner=="China")*ImpBEC322lag0 + (partner=="China")*ExpBEC322lag0 + BrazilGDP_PPP+combustíveisLubrificantes,data = BECtibble3DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 42
BEC42LAGS <- lm(`270 Peças e acessórios para bens de capital` ~ 
              ImpBEC42lag0 + ExpBEC42lag0 + ImpBEC42lag0.5 + ExpBEC42lag0.5 +ImpBEC42lag1 + ExpBEC42lag1 +ImpBEC42lag1.5 + ExpBEC42lag1.5 +ImpBEC42lag2 + ExpBEC42lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC42lag0 +
              (partner=="China")*ExpBEC42lag0
               + BrazilGDP_PPP+veículosMotosPartesPeças+escritórioInformáticaComunicação,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`270 Peças e acessórios para bens de capital` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC42plmLAGS <- plm(detrended ~ ImpBEC42lag0 + ExpBEC42lag0 + ImpBEC42lag0.5 + ExpBEC42lag0.5 +ImpBEC42lag1 + ExpBEC42lag1 +ImpBEC42lag1.5 + ExpBEC42lag1.5 +ImpBEC42lag2 + ExpBEC42lag2 + (partner=="China")*ImpBEC42lag0 + (partner=="China")*ExpBEC42lag0 + BrazilGDP_PPP+veículosMotosPartesPeças+escritórioInformáticaComunicação,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 53
BEC53LAGS <- lm(`280 Peças e acessórios para equipamentos de transporte` ~ 
              ImpBEC53lag0 + ExpBEC53lag0 + ImpBEC53lag0.5 + ExpBEC53lag0.5 + ImpBEC53lag1 + ExpBEC53lag1 + ImpBEC53lag1.5 + ExpBEC53lag1.5 + ImpBEC53lag2 + ExpBEC53lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC53lag0 +
              (partner=="China")*ExpBEC53lag0
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`280 Peças e acessórios para equipamentos de transporte` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC53plmLAGS <- plm(detrended ~ ImpBEC53lag0 + ExpBEC53lag0 + ImpBEC53lag0.5 + ExpBEC53lag0.5 + ImpBEC53lag1 + ExpBEC53lag1 + ImpBEC53lag1.5 + ExpBEC53lag1.5 + ImpBEC53lag2 + ExpBEC53lag2 + (partner=="China")*ImpBEC53lag0 + (partner=="China")*ExpBEC53lag0 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 6
BEC6LAGS <- lm(`3 Bens de consumo` ~
              ImpBEC6lag0 + ExpBEC6lag0 + ImpBEC6lag0.5 + ExpBEC6lag0.5 + ImpBEC6lag1 + ExpBEC6lag1 + ImpBEC6lag1.5 + ExpBEC6lag1.5 + ImpBEC6lag2 + ExpBEC6lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC6lag0 +
              (partner=="China")*ExpBEC6lag0
               + BrazilGDP_PPP+varejoTotal,data =
              as.data.frame(BECtibble1DigitLAGS))
BECtibble1DigitLAGS$detrended <- resid(lm(`3 Bens de consumo` ~ fYear + fMonth, BECtibble1DigitLAGS))
BEC6plmLAGS<- plm(detrended ~ ImpBEC6lag0 + ExpBEC6lag0 + ImpBEC6lag0.5 + ExpBEC6lag0.5 + ImpBEC6lag1 + ExpBEC6lag1 + ImpBEC6lag1.5 + ExpBEC6lag1.5 + ImpBEC6lag2 + ExpBEC6lag2 + (partner=="China")*ImpBEC6lag0 + (partner=="China")*ExpBEC6lag0 + BrazilGDP_PPP+varejoTotal,data = BECtibble1DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 61
BEC61LAGS <- lm(`31 Bens de consumo duráveis` ~ 
              ImpBEC61lag0 + ExpBEC61lag0 + ImpBEC61lag0.5 + ExpBEC61lag0.5 + ImpBEC61lag1 + ExpBEC61lag1 + ImpBEC61lag1.5 + ExpBEC61lag1.5 + ImpBEC61lag2 + ExpBEC61lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC61lag0 +
              (partner=="China")*ExpBEC61lag0
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`31 Bens de consumo duráveis` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC61plmLAGS <- plm(detrended ~ ImpBEC61lag0 + ExpBEC61lag0 + ImpBEC61lag0.5 + ExpBEC61lag0.5 + ImpBEC61lag1 + ExpBEC61lag1 + ImpBEC61lag1.5 + ExpBEC61lag1.5 + ImpBEC61lag2 + ExpBEC61lag2 + (partner=="China")*ImpBEC61lag0 + (partner=="China")*ExpBEC61lag0 + BrazilGDP_PPP+varejoTotal,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 51
BEC51LAGS <- lm(`312 Automóveis para passageiros` ~ 
              ImpBEC51lag0 + ExpBEC51lag0 + ImpBEC51lag0.5 + ExpBEC51lag0.5 +ImpBEC51lag1 + ExpBEC51lag1 +ImpBEC51lag1.5 + ExpBEC51lag1.5 +ImpBEC51lag2 + ExpBEC51lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC51lag0 +
              (partner=="China")*ExpBEC51lag0
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`312 Automóveis para passageiros` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC51plmLAGS <- plm(detrended ~ ImpBEC51lag0 + ExpBEC51lag0 + ImpBEC51lag0.5 + ExpBEC51lag0.5 +ImpBEC51lag1 + ExpBEC51lag1 +ImpBEC51lag1.5 + ExpBEC51lag1.5 +ImpBEC51lag2 + ExpBEC51lag2 + (partner=="China")*ImpBEC51lag0 + (partner=="China")*ExpBEC51lag0 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

BEC51ExpLAGS <- lm(`312 Automóveis para passageiros` ~ 
               ExpBEC51lag0 + ExpBEC51lag0.5 +ExpBEC51lag1 +ExpBEC51lag1.5 +ExpBEC51lag2 + fYear + fMonth + (partner=="China") +
              (partner=="China")*ExpBEC51lag0
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`312 Automóveis para passageiros` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC51plmExpLAGS <- plm(detrended ~ ExpBEC51lag0 + ExpBEC51lag0.5 +ExpBEC51lag1 +ExpBEC51lag1.5 +ExpBEC51lag2 + (partner=="China")*ExpBEC51lag0 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")



# BEC 522
BEC522LAGS <- lm(`313 Equipamentos de transporte não industrial` ~ 
              ImpBEC522lag0 + ExpBEC522lag0 +  ImpBEC522lag0.5 + ExpBEC522lag0.5 + ImpBEC522lag1 + ExpBEC522lag1 + ImpBEC522lag1.5 + ExpBEC522lag1.5 + ImpBEC522lag2 + ExpBEC522lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC522lag0 +
              (partner=="China")*ExpBEC522lag0
               + BrazilGDP_PPP+veículosMotosPartesPeças,data = 
              as.data.frame(BECtibble3DigitLAGS))
BECtibble3DigitLAGS$detrended <- resid(lm(`313 Equipamentos de transporte não industrial` ~ fYear + fMonth, BECtibble3DigitLAGS))
BEC522plmLAGS <- plm(detrended ~ ImpBEC522lag0 + ExpBEC522lag0 +  ImpBEC522lag0.5 + ExpBEC522lag0.5 + ImpBEC522lag1 + ExpBEC522lag1 + ImpBEC522lag1.5 + ExpBEC522lag1.5 + ImpBEC522lag2 + ExpBEC522lag2 + (partner=="China")*ImpBEC522lag0 + (partner=="China")*ExpBEC522lag0 + BrazilGDP_PPP+veículosMotosPartesPeças,data = BECtibble3DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 62
BEC62LAGS <- lm(`321 Bens de consumo semiduráveis` ~ 
              ImpBEC62lag0 + ExpBEC62lag0 + ImpBEC62lag0.5 + ExpBEC62lag0.5 + ImpBEC62lag1 + ExpBEC62lag1 +ImpBEC62lag1.5 + ExpBEC62lag1.5 +ImpBEC62lag2 + ExpBEC62lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC62lag0 +
              (partner=="China")*ExpBEC62lag0
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`321 Bens de consumo semiduráveis` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC62plmLAGS <- plm(detrended ~ ImpBEC62lag0 + ExpBEC62lag0 + ImpBEC62lag0.5 + ExpBEC62lag0.5 + ImpBEC62lag1 + ExpBEC62lag1 +ImpBEC62lag1.5 + ExpBEC62lag1.5 +ImpBEC62lag2 + ExpBEC62lag2 + (partner=="China")*ImpBEC62lag0 + (partner=="China")*ExpBEC62lag0 + BrazilGDP_PPP+varejoTotal,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")


# BEC 63
BEC63LAGS <- lm(`322 Bens de consumo não duráveis` ~ 
              ImpBEC63lag0 + ExpBEC63lag0 +  ImpBEC63lag0.5 + ExpBEC63lag0.5 + ImpBEC63lag1 + ExpBEC63lag1 + ImpBEC63lag1.5 + ExpBEC63lag1.5 + ImpBEC63lag2 + ExpBEC63lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC63lag0 +
              (partner=="China")*ExpBEC63lag0
               + BrazilGDP_PPP+varejoTotal,data = 
              as.data.frame(BECtibble2DigitLAGS))
BECtibble2DigitLAGS$detrended <- resid(lm(`322 Bens de consumo não duráveis` ~ fYear + fMonth, BECtibble2DigitLAGS))
BEC63plmLAGS <- plm(detrended ~ ImpBEC63lag0 + ExpBEC63lag0 +  ImpBEC63lag0.5 + ExpBEC63lag0.5 + ImpBEC63lag1 + ExpBEC63lag1 + ImpBEC63lag1.5 + ExpBEC63lag1.5 + ImpBEC63lag2 + ExpBEC63lag2 + (partner=="China")*ImpBEC63lag0 + (partner=="China")*ExpBEC63lag0 + BrazilGDP_PPP+varejoTotal,data = BECtibble2DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 122
BEC122LAGS <- lm(`324 Alimentos e bebidas elaborados, destinados principalmente ao consumo doméstico` ~ 
              ImpBEC122lag0 + ExpBEC122lag0 + ImpBEC122lag0.5 + ExpBEC122lag0.5 + ImpBEC122lag1 + ExpBEC122lag1 + ImpBEC122lag1.5 + ExpBEC122lag1.5 + ImpBEC122lag2 + ExpBEC122lag2 + fYear + fMonth + (partner=="China") + (partner=="China")*ImpBEC122lag0 +
              (partner=="China")*ExpBEC122lag0
               + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo,data = 
              as.data.frame(BECtibble3DigitLAGS))
BECtibble3DigitLAGS$detrended <- resid(lm(`324 Alimentos e bebidas elaborados, destinados principalmente ao consumo doméstico` ~ fYear + fMonth, BECtibble3DigitLAGS))
BEC122plmLAGS <- plm(detrended ~ ImpBEC122lag0 + ExpBEC122lag0 + ImpBEC122lag0.5 + ExpBEC122lag0.5 + ImpBEC122lag1 + ExpBEC122lag1 + ImpBEC122lag1.5 + ExpBEC122lag1.5 + ImpBEC122lag2 + ExpBEC122lag2 +  (partner=="China")*ImpBEC122lag0 + (partner=="China")*ExpBEC122lag0 + BrazilGDP_PPP+hipermercadosProdutosAlimentíciosBebidasFumo
                 ,
                 data = BECtibble3DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

# BEC 7
BEC7LAGS <- lm(`9 Bens não especificados anteriormente` ~ 
              ImpBEC7lag0 + ExpBEC7lag0 + ImpBEC7lag0.5 + ExpBEC7lag0.5 +ImpBEC7lag1 + ExpBEC7lag1 +ImpBEC7lag1 + ExpBEC7lag1 +ImpBEC7lag2 + ExpBEC7lag2 + fYear + fMonth + 
             
             BrazilGDP_PPP +
              + (partner=="China") + 
            
             (partner=="China")*ImpBEC7lag0 +
              (partner=="China")*ExpBEC7lag0
              +varejoTotal,data = 
              as.data.frame(BECtibble1DigitLAGS))
BECtibble1DigitLAGS$detrended <- resid(lm(`9 Bens não especificados anteriormente` ~ fYear + fMonth, BECtibble1DigitLAGS))
BEC7plmLAGS <- plm(detrended ~ ImpBEC7lag0 + ExpBEC7lag0 + ImpBEC7lag0.5 + ExpBEC7lag0.5 +ImpBEC7lag1 + ExpBEC7lag1 +ImpBEC7lag1 + ExpBEC7lag1 +ImpBEC7lag2 + ExpBEC7lag2 +  (partner=="China")*ImpBEC7lag0 + (partner=="China")*ExpBEC7lag0 + BrazilGDP_PPP+varejoTotal,data = BECtibble1DigitLAGS, effect = "individual",
               model = "within",
               index = "partner")

```
```{r lagged-commodity-regressions, include=FALSE, cache=TRUE,warning=FALSE}
HS4DigitMonthlyLAGS <- tradeDataLong %>% 
  group_by(flow,partner,fYear,fMonth,BrazilGDP_PPP,fourDigitHS2017) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpHS4 = case_when(
    flow == "Imports" ~ paste("Imp",as.character(fourDigitHS2017),sep=""),
    flow == "Exports" ~ paste("Exp",as.character(fourDigitHS2017),sep=""),
    TRUE ~ as.character(-1)
  )) %>% mutate(lag0 = value, years = as.double(as.character(fYear)) + (as.double(as.character(fMonth))/12)) 
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% 
  left_join(HS4DigitMonthlyLAGS %>% mutate(lag0.5 = value, yearsLESS0.5 = years-0.5) %>% select(ImpExpHS4,yearsLESS0.5,lag0.5,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS0.5")) %>%
  left_join(HS4DigitMonthlyLAGS %>% mutate(lag1 = value, yearsLESS1 = years-1) %>% select(ImpExpHS4,yearsLESS1,lag1,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS1")) %>%
  left_join(HS4DigitMonthlyLAGS %>% mutate(lag1.5 = value, yearsLESS1.5 = years-1.5) %>% select(ImpExpHS4,yearsLESS1.5,lag1.5,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS1.5")) %>%
  left_join(HS4DigitMonthlyLAGS %>% mutate(lag2 = value, yearsLESS2 = years-2) %>% select(ImpExpHS4,yearsLESS2,lag2,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS2")) %>%
  filter(years > 2002) %>%
  select(-value,-fourDigitHS2017,-flow) %>%
  pivot_longer(cols=c("lag0","lag0.5","lag1","lag1.5","lag2"),names_to="lags_number") %>%
  mutate(new_col_names = paste(ImpExpHS4,lags_number,sep=""),.keep="unused") %>%
  pivot_wider(names_from=new_col_names,values_from=value) %>%
  left_join(meatMonthly, by=c("fYear"="fYear", "fMonth"="fMonth")) %>%
  left_join(vendasVarejo %>% select(-Data), by=c("fYear"="fYear","fMonth"="fMonth")) %>%
  replace(is.na(.), 0) 


HS4DigitAnnualLAGS <- tradeDataLong %>% 
  group_by(flow,partner,fYear,BrazilGDP_PPP,fourDigitHS2017) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpHS4 = case_when(
    flow == "Imports" ~ paste("Imp",as.character(fourDigitHS2017),sep=""),
    flow == "Exports" ~ paste("Exp",as.character(fourDigitHS2017),sep=""),
    TRUE ~ as.character(-1)
  )) %>% mutate(lag0 = value, years = as.double(as.character(fYear))) 
HS4DigitAnnualLAGS <- HS4DigitAnnualLAGS %>% 
  left_join(HS4DigitAnnualLAGS %>% mutate(lag0.5 = value, yearsLESS0.5 = years-0.5) %>% select(ImpExpHS4,yearsLESS0.5,lag0.5,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS0.5")) %>%
  left_join(HS4DigitAnnualLAGS %>% mutate(lag1 = value, yearsLESS1 = years-1) %>% select(ImpExpHS4,yearsLESS1,lag1,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS1")) %>%
  left_join(HS4DigitAnnualLAGS %>% mutate(lag1.5 = value, yearsLESS1.5 = years-1.5) %>% select(ImpExpHS4,yearsLESS1.5,lag1.5,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS1.5")) %>%
  left_join(HS4DigitAnnualLAGS %>% mutate(lag2 = value, yearsLESS2 = years-2) %>% select(ImpExpHS4,yearsLESS2,lag2,partner),
            by=c("ImpExpHS4"="ImpExpHS4","partner"="partner","years"="yearsLESS2")) %>%
  filter(years > 2001.9) %>%
  select(-value,-fourDigitHS2017,-flow) %>%
  pivot_longer(cols=c("lag0","lag0.5","lag1","lag1.5","lag2"),names_to="lags_number") %>%
  mutate(new_col_names = paste(ImpExpHS4,lags_number,sep=""),.keep="unused") %>%
  pivot_wider(names_from=new_col_names,values_from=value) %>%
  left_join(agricultureAnnualReduced, by=c("fYear"="fYear")) %>%
  left_join(valordaproducao, by=c("fYear"="fYear")) %>%
  left_join(vendasVarejo %>% select(-Data, -fMonth) %>% group_by(fYear) %>% summarise_all(mean), by=c("fYear"="fYear")) %>%
  replace(is.na(.), 0) 


HS2DigitAnnualLAGS <- tradeDataLong %>% 
  group_by(flow,partner,fYear,BrazilGDP_PPP,twoDigitHS2017) %>% 
  summarise(value=sum(valueNormalized)) %>%
  ungroup() %>% 
  mutate(ImpExpHS2 = case_when(
    flow == "Imports" ~ paste("Imp",as.character(twoDigitHS2017),sep=""),
    flow == "Exports" ~ paste("Exp",as.character(twoDigitHS2017),sep=""),
    TRUE ~ as.character(-1)
  )) %>% mutate(lag0 = value, years = as.double(as.character(fYear))) 
HS2DigitAnnualLAGS <- HS2DigitAnnualLAGS %>% 
  left_join(HS2DigitAnnualLAGS %>% mutate(lag0.5 = value, yearsLESS0.5 = years-0.5) %>% select(ImpExpHS2,yearsLESS0.5,lag0.5,partner),
            by=c("ImpExpHS2"="ImpExpHS2","partner"="partner","years"="yearsLESS0.5")) %>%
  left_join(HS2DigitAnnualLAGS %>% mutate(lag1 = value, yearsLESS1 = years-1) %>% select(ImpExpHS2,yearsLESS1,lag1,partner),
            by=c("ImpExpHS2"="ImpExpHS2","partner"="partner","years"="yearsLESS1")) %>%
  left_join(HS2DigitAnnualLAGS %>% mutate(lag1.5 = value, yearsLESS1.5 = years-1.5) %>% select(ImpExpHS2,yearsLESS1.5,lag1.5,partner),
            by=c("ImpExpHS2"="ImpExpHS2","partner"="partner","years"="yearsLESS1.5")) %>%
  left_join(HS2DigitAnnualLAGS %>% mutate(lag2 = value, yearsLESS2 = years-2) %>% select(ImpExpHS2,yearsLESS2,lag2,partner),
            by=c("ImpExpHS2"="ImpExpHS2","partner"="partner","years"="yearsLESS2")) %>%
  filter(years > 2001.9) %>%
  select(-value,-twoDigitHS2017,-flow) %>%
  pivot_longer(cols=c("lag0","lag0.5","lag1","lag1.5","lag2"),names_to="lags_number") %>%
  mutate(new_col_names = paste(ImpExpHS2,lags_number,sep=""),.keep="unused") %>%
  pivot_wider(names_from=new_col_names,values_from=value) %>%
  left_join(agricultureAnnualReduced, by=c("fYear"="fYear")) %>%
  left_join(valordaproducao, by=c("fYear"="fYear")) %>%
  left_join(vendasVarejo %>% select(-Data, -fMonth) %>% group_by(fYear) %>% summarise_all(mean), by=c("fYear"="fYear")) %>%
  replace(is.na(.), 0) 

# BOVINOS
bovinosHS <- c(0102, 0202, 0201) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% mutate(importslag0 = Imp102lag0 + Imp202lag0 + Imp201lag0,
                                                      importslag0.5 = Imp102lag0.5 + Imp202lag0.5 + Imp201lag0.5,
                                                      importslag1 = Imp102lag1 + Imp202lag1 + Imp201lag1,
                                                      importslag1.5 = Imp102lag0.5 + Imp202lag1.5 + Imp201lag1.5,
                                                      importslag2 = Imp102lag2 + Imp202lag2 + Imp201lag2,
                                                      exportslag0 = Exp202lag0 + Exp201lag0,
                                                      exportslag0.5 =  Exp202lag0.5 + Exp201lag0.5,
                                                      exportslag1 =  Exp202lag1 + Exp201lag1,
                                                      exportslag1.5 =  Exp202lag1.5 + Exp201lag1.5,
                                                      exportslag2 =  Exp202lag2 + Exp201lag2)
bovinosLMtonsLAGS <- # TO EDIT
  lm(`bovinos (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + fMonth + fYear + hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT
# summary(bovinosLMtons) # TO EDIT

HS4DigitMonthlyLAGS$detrended <- resid(lm(`bovinos (tons)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
# bovinosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner + hipermercadosSupermercados,data = HS4DigitMonthly, effect = "individual",
#                model = "within",
#                index = "partner")
bovinosPLMdisggregateLAGS <- plm(detrended ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +  hipermercadosSupermercados,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(bovinosPLMaggregate)
# summary(bovinosPLMdisggregate)


# FRANGOS
frangosHS <- c(105,207) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% mutate(importslag0 = Imp105lag0 + Imp207lag0,
                                                      importslag0.5 = Imp105lag0.5 + Imp207lag0.5,
                                                      importslag1 = Imp105lag1 + Imp207lag1,
                                                      importslag1.5 = Imp105lag1.5 + Imp207lag1.5,
                                                      importslag2 = Imp105lag2 + Imp207lag2,
                                                      exportslag0 = Exp105lag0 + Exp207lag0,
                                                      exportslag0.5 = Exp105lag0.5 + Exp207lag0.5,
                                                      exportslag1 = Exp105lag1 + Exp207lag1,
                                                      exportslag1.5 = Exp105lag1.5 + Exp207lag1.5,
                                                      exportslag2 = Exp105lag2 + Exp207lag2)
frangosLMtonsLAGS <- # TO EDIT
  lm(`frangos (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +
                      fYear + fMonth + 
                      (partner=="China") + 
                    + hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT

HS4DigitMonthlyLAGS$detrended <- resid(lm(`frangos (tons)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
# frangosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = frangosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
frangosPLMdisggregateLAGS <- plm(detrended ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(frangosPLMaggregate)
# summary(frangosPLMdisggregate)

# SUINOS
suinosHS <- c(103,203) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% mutate(importslag0 = Imp103lag0 + Imp203lag0,
                                                      importslag0.5 = Imp103lag0.5 + Imp203lag0.5,
                                                      importslag1 = Imp103lag1 + Imp203lag1,
                                                      importslag1.5 = Imp103lag1.5 + Imp203lag1.5,
                                                      importslag2 = Imp103lag2 + Imp203lag2,
                                                      exportslag0 = Exp103lag0 + Exp203lag0,
                                                      exportslag0.5 = Exp103lag0.5 + Exp203lag0.5,
                                                      exportslag1 = Exp103lag1 + Exp203lag1,
                                                      exportslag1.5 = Exp103lag1.5 + Exp203lag1.5,
                                                      exportslag2 = Exp103lag2 + Exp203lag2)
suinosLMtonsLAGS <- # TO EDIT
  lm(`suínos (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +
                      fYear + fMonth + 
                      (partner=="China")+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT

HS4DigitMonthlyLAGS$detrended <- resid(lm(`suínos (tons)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
# suinosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner+ hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = suinosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
suinosPLMdisggregateLAGS <- plm(detrended ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(suinosPLMaggregate)
# summary(suinosPLMdisggregate)

# ALGODAO
algodaoHS <- c(52) # TO EDIT
HS2DigitAnnualLAGS <- HS2DigitAnnualLAGS %>% mutate(importslag0 = (Imp52lag0) ,
                                                      importslag0.5 = (Imp52lag0.5) ,
                                                      importslag1 = (Imp52lag1) ,
                                                      importslag1.5 = (Imp52lag1.5) ,
                                                      importslag2 = (Imp52lag2) ,
                                                      exportslag0 = (Exp52lag0) ,
                                                      exportslag0.5 = (Exp52lag0.5) ,
                                                      exportslag1 = (Exp52lag1) ,
                                                      exportslag1.5 = (Exp52lag1.5) ,
                                                      exportslag2 = (Exp52lag2) )
algodaoLMtonsLAGS <- # TO EDIT
  lm(`algodão (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") +
                       poly(years,6) + 
      
                      (partner=="China") + 
                       +tecidosVestuárioECalçados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT
#summary(algodaoLMtons) # TO EDIT
algodaoLMhectLAGS <- # TO EDIT
  lm(`algodão (hect)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")   + # TO EDIT
                      + poly(years,6) +
                      (partner=="China") + 
                      tecidosVestuárioECalçados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT
# summary(algodaoLMhect) # TO EDIT
algodaoLMvalueLAGS <- # TO EDIT
  lm(`algodão (Constant 1982 USD$)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") +
                       poly(years,6) + 
      
                      (partner=="China") + 
                       +tecidosVestuárioECalçados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT

HS2DigitAnnualLAGS$detrendedTons <- resid(lm(`algodão (tons)` ~ poly(years,6), HS2DigitAnnualLAGS))
algodaoPLMtonsLAGS <- plm(detrendedTons ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + tecidosVestuárioECalçados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
HS2DigitAnnualLAGS$detrendedHect <- resid(lm(`algodão (hect)` ~ poly(years,6), HS2DigitAnnualLAGS))
algodaoPLMhectLAGS <- plm(detrendedHect ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + tecidosVestuárioECalçados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(algodaoPLMtons)
# summary(algodaoPLMhect)
HS2DigitAnnualLAGS$detrendedValue <- resid(lm(`algodão (Constant 1982 USD$)` ~ poly(years,6), HS2DigitAnnualLAGS))
algodaoPLMvalueLAGS <- plm(detrendedValue ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + tecidosVestuárioECalçados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")

# CAFE
coffeeHS <- c(0901, 2101) # TO EDIT
HS4DigitAnnualLAGS <- HS4DigitAnnualLAGS %>% mutate(importslag0 = Imp901lag0 + Imp2101lag0,
                                                      importslag0.5 = Imp901lag0.5 + Imp2101lag0.5,
                                                      importslag1 = Imp901lag1 + Imp2101lag1,
                                                      importslag1.5 = Imp901lag1.5 + Imp2101lag1.5,
                                                      importslag2 = Imp901lag2 + Imp2101lag2,
                                                      exportslag0 = Exp901lag0 + Exp2101lag0,
                                                      exportslag0.5 = Exp901lag0.5 + Exp2101lag0.5,
                                                      exportslag1 = Exp901lag1 + Exp2101lag1,
                                                      exportslag1.5 = Exp901lag1.5 + Exp2101lag1.5,
                                                      exportslag2 = Exp901lag2 + Exp2101lag2)
coffeeLMQtdeLAGS <- lm(`café (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +
                      poly(years,6) + 
                      (partner=="China") + 
                        hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,
                    data = as.data.frame(HS4DigitAnnualLAGS))
coffeeLMvalueLAGS <- lm(`café (Constant 1982 USD$)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +
                      poly(years,6) + 
                      (partner=="China") + 
                        hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,
                    data = as.data.frame(HS4DigitAnnualLAGS))
# summary(coffeeLMQtde)
coffeeLMhectLAGS <- lm(`café área colhida (hect)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + 
                      poly(years,6) + 
                      (partner=="China") + 
                     hipermercadosProdutosAlimentíciosBebidasFumo + hipermercadosSupermercados,
                    data = as.data.frame(HS4DigitAnnualLAGS))
# summary(coffeeLMhect)

HS4DigitAnnualLAGS$detrendedQtde <- resid(lm(`café (tons)` ~ poly(years,6), HS4DigitAnnualLAGS))
coffeePLMQtdeLAGS <- plm(detrendedQtde ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
HS4DigitAnnualLAGS$detrendedHect <- resid(lm(`café área colhida (hect)` ~ poly(years,6), HS4DigitAnnualLAGS))
coffeePLMhectLAGS <- plm(detrendedHect ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +  hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(coffeePLMQtde)
# summary(coffeePLMhect)
HS4DigitAnnualLAGS$detrendedValue <- resid(lm(`café (Constant 1982 USD$)` ~ poly(years,6), HS4DigitAnnualLAGS))
coffeePLMvalueLAGS <- plm(detrendedValue ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +  hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")

# CANA DE ACUCAR
canadeacucarHS <- c(17) # TO EDIT
HS2DigitAnnualLAGS <- HS2DigitAnnualLAGS %>% mutate(importslag0 = Imp17lag0 ,
                                                      importslag0.5 = Imp17lag0.5 ,
                                                      importslag1 = Imp17lag1 ,
                                                      importslag1.5 = Imp17lag1.5 ,
                                                      importslag2 = Imp17lag2 ,
                                                      exportslag0 = Exp17lag0 ,
                                                      exportslag0.5 = Exp17lag0.5 ,
                                                      exportslag1 = Exp17lag1 ,
                                                      exportslag1.5 = Exp17lag1.5 ,
                                                      exportslag2 = Exp17lag2 )
canadeacucarLMQtdeLAGS <- # TO EDIT
  lm(`cana-de-açúcar (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +
      
                      poly(years,6) + 
                      (partner=="China") + 
        hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT
canadeacucarLMvalueLAGS <- # TO EDIT
  lm(`cana-de-açúcar (Constant 1982 USD$)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  +
      
                      poly(years,6) + 
                      (partner=="China") + 
        hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT
# summary(canadeacucarLMQtde) # TO EDIT
canadeacucarLMhectLAGS <- # TO EDIT
  lm(`cana-de-açúcar área colhida (hect)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
       hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT
# summary(canadeacucarLMhect) # TO EDIT

HS2DigitAnnualLAGS$detrendedQtde <- resid(lm(`cana-de-açúcar (tons)` ~ poly(years,6), HS2DigitAnnualLAGS))
canadeacucarPLMQtdeLAGS <- plm(detrendedQtde ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + hipermercadosSupermercados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
HS2DigitAnnualLAGS$detrendedHect <- resid(lm(`cana-de-açúcar área colhida (hect)` ~ poly(years,6), HS2DigitAnnualLAGS))
canadeacucarPLMhectLAGS <- plm(detrendedHect ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + hipermercadosSupermercados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
HS2DigitAnnualLAGS$detrendedValue <- resid(lm(`cana-de-açúcar (Constant 1982 USD$)` ~ poly(years,6), HS2DigitAnnualLAGS))
canadeacucarPLMvalueLAGS <- plm(detrendedValue ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + hipermercadosSupermercados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(canadeacucarPLMQtde)
# summary(canadeacucarPLMhect)


# MILHO
milhoHS <- c(1005, 1702, 110313) # TO EDIT
HS4DigitAnnualLAGS <- HS4DigitAnnualLAGS %>% mutate(importslag0 = Imp1005lag0 + Imp1702lag0 + Imp1103lag0,
                                                      importslag0.5 = Imp1005lag0.5 + Imp1702lag0.5+ Imp1103lag0.5,
                                                      importslag1 = Imp1005lag1 + Imp1702lag1+ Imp1103lag1,
                                                      importslag1.5 = Imp1005lag1.5 + Imp1702lag1.5+ Imp1103lag1.5,
                                                      importslag2 = Imp1005lag2 + Imp1702lag2+ Imp1103lag2,
                                                      exportslag0 = Exp1005lag0 + Exp1702lag0+ Exp1103lag0,
                                                      exportslag0.5 = Exp1005lag0.5 + Exp1702lag0.5+ Exp1103lag0.5,
                                                      exportslag1 = Exp1005lag1 + Exp1702lag1+ Exp1103lag1,
                                                      exportslag1.5 = Exp1005lag1.5 + Exp1702lag1.5+ Exp1103lag1.5,
                                                      exportslag2 = Exp1005lag2 + Exp1702lag2+ Exp1103lag2)
milhoLMQtdeLAGS <- # TO EDIT
  lm(`milho (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
        hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnualLAGS)) # TO EDIT
milhoLMvalueLAGS <- # TO EDIT
  lm(`milho (Constant 1982 USD$)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
        hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnualLAGS)) # TO EDIT
# summary(milhoLMQtde) # TO EDIT
milhoLMhectLAGS <- # TO EDIT
  lm(`milho área colhida (hect)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
         hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnualLAGS)) # TO EDIT
# summary(milhoLMhect) # TO EDIT

HS4DigitAnnualLAGS$detrendedQtde <- resid(lm(`milho (tons)` ~ poly(years,6), HS4DigitAnnualLAGS))
milhoPLMQtdeLAGS <- plm(detrendedQtde ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnualLAGS, 
               model = "within",
               index = "partner")
HS4DigitAnnualLAGS$detrendedValue <- resid(lm(`milho (Constant 1982 USD$)` ~ poly(years,6), HS4DigitAnnualLAGS))
milhoPLMvalueLAGS <- plm(detrendedValue ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnualLAGS, 
               model = "within",
               index = "partner")
milhoPLMQtdeExpLAGS <- plm(detrendedQtde ~ exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + hipermercadosSupermercados,data = HS4DigitAnnualLAGS, 
               model = "within",
               index = "partner")
HS4DigitAnnualLAGS$detrendedHect <- resid(lm(`milho área colhida (hect)` ~ poly(years,6), HS4DigitAnnualLAGS))
milhoPLMhectLAGS <- plm(detrendedHect ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
milhoPLMhectExpLAGS <- plm(detrendedHect ~ exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")

# summary(milhoPLMQtde)
# summary(milhoPLMhect)

# SOJA
sojaHS <- c(1201, 2304, 1507) # TO EDIT
HS4DigitAnnualLAGS <- HS4DigitAnnualLAGS %>% 
  mutate(importslag0 = Imp1201lag0 + Imp2304lag0 + Imp1507lag0,
                                                      importslag0.5 = Imp1201lag0.5 + Imp2304lag0.5+ Imp1507lag0.5,
                                                      importslag1 = Imp1201lag1 + Imp2304lag1+ Imp1507lag1,
                                                      importslag1.5 = Imp1201lag1.5 + Imp2304lag1.5+ Imp1507lag1.5,
                                                      importslag2 = Imp1201lag2 + Imp2304lag2+ Imp1507lag2,
                                                      exportslag0 = Exp1201lag0 + Exp2304lag0+ Exp1507lag0,
                                                      exportslag0.5 = Exp1201lag0.5 + Exp2304lag0.5+ Exp1507lag0.5,
                                                      exportslag1 = Exp1201lag1 + Exp2304lag1+ Exp1103lag1,
                                                      exportslag1.5 = Exp1201lag1.5 + Exp2304lag1.5+ Exp1507lag1.5,
                                                      exportslag2 = Exp1201lag2 + Exp2304lag2+ Exp1507lag2)
sojaLMQtdeLAGS <- # TO EDIT
  lm(`soja (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
         hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnualLAGS)) # TO EDIT
sojaLMvalueLAGS <- # TO EDIT
  lm(`soja (Constant 1982 USD$)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")  + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
         hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnualLAGS)) # TO EDIT
# summary(sojaLMQtdeLAGS) # TO EDIT
sojaLMhectLAGS <- # TO EDIT
  lm(`soja área colhida (hect)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")   + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS4DigitAnnualLAGS)) # TO EDIT
# summary(sojaLMhect) # TO EDIT
HS4DigitAnnualLAGS$detrendedValue <- resid(lm(`soja (Constant 1982 USD$)` ~ poly(years,6), HS4DigitAnnualLAGS))
sojaPLMvalueLAGS <- plm(detrendedValue ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China")  + 
                     #(Exp2304 + Exp1201 + Exp1507) +  
                     hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
# HS4DigitAnnualLAGS$detrendedQtde <- resid(lm(`soja (tons)` ~ poly(years,6), HS4DigitAnnualLAGS))
# sojaPLMQtdeLAGS <- plm(detrendedQtde ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
#                model = "within",
#                index = "partner")
# summary(sojaPLMQtdeLAGS)
# HS4DigitAnnualLAGS$detrendedHect <- resid(lm(`soja área colhida (hect)` ~ poly(years,6), HS4DigitAnnualLAGS))
# sojaPLMhectLAGS <- plm(detrendedHect ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") +  hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
#                model = "within",
#                index = "partner")
# summary(sojaPLMvalor)
# summary(sojaPLMhect)

sojaPLMQtdeImpLAGS <- plm(detrendedQtde ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China")  + 
                     #(Exp2304 + Exp1201 + Exp1507) +  
                     hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
summary(sojaPLMQtdeImpLAGS)
sojaPLMhectImpLAGS <- plm(detrendedHect ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China") + 
                     hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
summary(sojaPLMhectImpLAGS)
sojaPLMQtdeExpLAGS <- plm(detrendedQtde ~  
                     importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China") +  
                     hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
sojaPLMhectExpLAGS <- plm(detrendedHect ~  
                     exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2)*(partner=="China") +  
                     hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
# HS4DigitAnnual %>% filter(partner=="China") %>% mutate(soyExp = scale(Exp2304 + Exp1201 + Exp1507),
#                                                        normalSoyQtde = scale(detrendedQtde)) %>% ggplot() +
#   geom_line(aes(x = year, y = soyExp), color = "blue") +
#   geom_line(aes(x = year, y = normalSoyQtde), color = "red")

# print(sojaPLMvalor)
# print(sojaPLMhect)
# fixef(sojaPLMvalor)
# fixef(sojaPLMhect)
# summary(sojaPLMvalorNoExp)
# summary(sojaPLMhectNoExp)
#vcovHC(sojaPLMvalor)

# CACAU 
cacauHS <- c(18) # TO EDIT
HS2DigitAnnualLAGS <- HS2DigitAnnualLAGS %>% mutate(importslag0 = Imp18lag0 ,
                                                      importslag0.5 = Imp18lag0.5 ,
                                                      importslag1 = Imp18lag1 ,
                                                      importslag1.5 = Imp18lag1.5 ,
                                                      importslag2 = Imp18lag2 ,
                                                      exportslag0 = Exp18lag0 ,
                                                      exportslag0.5 = Exp18lag0.5 ,
                                                      exportslag1 = Exp18lag1 ,
                                                      exportslag1.5 = Exp18lag1.5 ,
                                                      exportslag2 = Exp18lag2 )
cacauLMQtdeLAGS <- # TO EDIT
  lm(`cacau (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+ # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
        hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT
# summary(cacauLMQtde) # TO EDIT
cacauLMvalueLAGS <- # TO EDIT
  lm(`cacau (Constant 1982 USD$)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+ # TO EDIT
                      poly(years,6) + 
                      (partner=="China") + 
        hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT

HS2DigitAnnualLAGS$detrendedQtde <- resid(lm(`cacau (tons)` ~ poly(years,6), HS2DigitAnnualLAGS))
cacauPLMQtdeLAGS <- plm(detrendedQtde ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")

HS2DigitAnnualLAGS$detrendedValue <- resid(lm(`cacau (Constant 1982 USD$)` ~ poly(years,6), HS2DigitAnnualLAGS))
cacauPLMvalueLAGS <- plm(detrendedValue ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(cacauPLMQtde)



# FUMO
fumoHS <- c(24) # TO EDIT
HS2DigitAnnualLAGS <- HS2DigitAnnualLAGS %>% mutate(importslag0 = Imp24lag0 ,
                                                      importslag0.5 = Imp24lag0.5 ,
                                                      importslag1 = Imp24lag1 ,
                                                      importslag1.5 = Imp24lag1.5 ,
                                                      importslag2 = Imp24lag2 ,
                                                      exportslag0 = Exp24lag0 ,
                                                      exportslag0.5 = Exp24lag0.5 ,
                                                      exportslag1 = Exp24lag1 ,
                                                      exportslag1.5 = Exp24lag1.5 ,
                                                      exportslag2 = Exp24lag2 )
fumoLMQtdeLAGS <- # TO EDIT
  lm(`fumo (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") +  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT
fumoLMvalueLAGS <- # TO EDIT
  lm(`fumo (Constant 1982 USD$)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + # TO EDIT
                      poly(years,6) + 
                      (partner=="China") +  hipermercadosSupermercados, # TO EDIT
                    data = as.data.frame(HS2DigitAnnualLAGS)) # TO EDIT

HS2DigitAnnualLAGS$detrendedQtde <- resid(lm(`fumo (tons)` ~ poly(years,6), HS2DigitAnnualLAGS))
fumoPLMQtdeLAGS <- plm(detrendedQtde ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")

HS2DigitAnnualLAGS$detrendedValue <- resid(lm(`fumo (Constant 1982 USD$)` ~ poly(years,6), HS2DigitAnnualLAGS))
fumoPLMvalueLAGS <- plm(detrendedValue ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+ hipermercadosSupermercados,data = HS2DigitAnnualLAGS, effect = "individual",
               model = "within",
               index = "partner")

# TRIGO
trigoHS <- c(11,1001) # TO EDIT
# #1101 1108 1107 1104 1109 1102 1103
# trigoLMQtdeLAGS <- # TO EDIT
#   lm(`trigo (tons)` ~ (Imp1101 + Imp1108 + Imp1107 +Imp1104 +Imp1109 +Imp1102 +Imp1103 +Imp1001)*(partner=="China") + (Exp1101 + Exp1108 + Exp1107 +Exp1104 +Exp1109 +Exp1102 +Exp1103 +Exp1001)*(partner=="China") + # TO EDIT
#                       poly(year,6) + 
#                       (partner=="China") + hipermercadosSupermercados, # TO EDIT
#                     data = as.data.frame(HS4DigitAnnualLAGS)) # TO EDIT
# # summary(trigoLMQtde) # TO EDIT
# 
# HS4DigitAnnualLAGS$detrendedQtde <- resid(lm(`trigo (tons)` ~ poly(year,6), HS4DigitAnnual))
# trigoPLMQtdeLAGS <- plm(detrendedQtde ~ (Imp1101 + Imp1108 + Imp1107 +Imp1104 +Imp1109 +Imp1102 +Imp1103 +Imp1001)*((partner=="China")) + (Exp1101 + Exp1108 + Exp1107 +Exp1104 +Exp1109 +Exp1102 +Exp1103 +Exp1001)*((partner=="China"))+  hipermercadosSupermercados,data = HS4DigitAnnualLAGS, effect = "individual",
#                model = "within",
#                index = "partner")
# # summary(trigoPLMQtde)


HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% left_join(hydrocarbonsMonthly, by=c("fYear"="fYear","fMonth"="fMonth"))

petroleoHS <- c(2709, 2710, 2713) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% 
  mutate(importslag0 = Imp2709lag0 + Imp2304lag0 + Imp1507lag0,
                                                      importslag0.5 = Imp2709lag0.5 + Imp2710lag0.5+ Imp2713lag0.5,
                                                      importslag1 = Imp2709lag1 + Imp2710lag1+ Imp2713lag1,
                                                      importslag1.5 = Imp2709lag1.5 + Imp2710lag1.5+ Imp2713lag1.5,
                                                      importslag2 = Imp2709lag2 + Imp2710lag2+ Imp2713lag2,
                                                      exportslag0 = Exp2709lag0 + Exp2710lag0+ Exp2713lag0,
                                                      exportslag0.5 = Exp2709lag0.5 + Exp2710lag0.5+ Exp2713lag0.5,
                                                      exportslag1 = Exp2709lag1 + Exp2710lag1+ Exp2713lag1,
                                                      exportslag1.5 = Exp2709lag1.5 + Exp2710lag1.5+ Exp2713lag1.5,
                                                      exportslag2 = Exp2709lag2 + Exp2710lag2+ Exp2713lag2)
petroleoLMLAGS <- # TO EDIT
  lm(`petróleo (k brl/day)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      combustíveisLubrificantes, # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT
#summary(petroleoLM) # TO EDIT

HS4DigitMonthlyLAGS$detrendedVolume <- resid(lm(`petróleo (k brl/day)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
petroleoPLMvolumeLAGS <- plm(detrendedVolume ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+combustíveisLubrificantes,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
#summary(petroleoPLMvolume)


gasHS <- c(2711) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% 
  mutate(importslag0 = Imp2711lag0,
                                                      importslag0.5 = Imp2711lag0.5 ,
                                                      importslag1 = Imp2711lag1 ,
                                                      importslag1.5 = Imp2711lag1.5 ,
                                                      importslag2 = Imp2711lag2 ,
                                                      exportslag0 = Exp2711lag0 ,
                                                      exportslag0.5 = Exp2711lag0.5 ,
                                                      exportslag1 = Exp2711lag1 ,
                                                      exportslag1.5 = Exp2711lag1.5 ,
                                                      exportslag2 = Exp2711lag2)
gasLMLAGS <- # TO EDIT
  lm(`gás natural (m^3/day)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+combustíveisLubrificantes, # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT
# summary(gasLM) # TO EDIT

HS4DigitMonthlyLAGS$detrendedVolume <- resid(lm(`gás natural (m^3/day)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
gasPLMvolumeLAGS <- plm(detrendedVolume ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+combustíveisLubrificantes,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(gasPLMvolume)

HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% 
  left_join(metalsMonthly, by=c("fYear"="fYear","fMonth"="fMonth"))

# PIG IRON
ferroGusaHS <- c(7201) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% 
  mutate(importslag0 = Imp7201lag0,
                                                      importslag0.5 = Imp7201lag0.5 ,
                                                      importslag1 = Imp7201lag1 ,
                                                      importslag1.5 = Imp7201lag1.5 ,
                                                      importslag2 = Imp7201lag2 ,
                                                      exportslag0 = Exp7201lag0 ,
                                                      exportslag0.5 = Exp7201lag0.5 ,
                                                      exportslag1 = Exp7201lag1 ,
                                                      exportslag1.5 = Exp7201lag1.5 ,
                                                      exportslag2 = Exp7201lag2)
ferroGusaLMtonsLAGS <- # TO EDIT
  lm(`ferro-gusa (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                    
       BrazilGDP_PPP , # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT
# summary(bovinosLMtons) # TO EDIT

HS4DigitMonthlyLAGS$detrended <- resid(lm(`ferro-gusa (tons)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
ferroGusaPLMaggregateLAGS <- plm(detrended ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + BrazilGDP_PPP,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(ferroGusaPLMaggregate)
# bovinosPLMdisggregate <- plm(detrended ~ (Imp201 + Imp202 + Imp201)*partner + (Exp202 + Exp201)*partner + hipermercadosSupermercados,data = bovinosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
# summary(bovinosPLMaggregate)
#summary(bovinosPLMdisggregate)


# CRUDE STEEL
acoBrutoHS <- c(7227, 7218) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% 
  mutate(importslag0 = Imp7227lag0 + Imp7218lag0 + Imp1507lag0,
                                                      importslag0.5 = Imp7227lag0.5 + Imp7218lag0.5,
                                                      importslag1 = Imp7227lag1 + Imp7218lag1,
                                                      importslag1.5 = Imp7227lag1.5 + Imp7218lag1.5,
                                                      importslag2 = Imp7227lag2 + Imp7218lag2,
                                                      exportslag0 = Exp7227lag0 + Exp7218lag0,
                                                      exportslag0.5 = Exp7227lag0.5 + Exp7218lag0.5,
                                                      exportslag1 = Exp7227lag1 + Exp7218lag1,
                                                      exportslag1.5 = Exp7227lag1.5 + Exp7218lag1.5,
                                                      exportslag2 = Exp7227lag2 + Exp2710lag2)
acoBrutoLMtonsLAGS <- # TO EDIT
  lm(`aço bruto (tons)` ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      
       BrazilGDP_PPP , # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT
# summary(acoBrutoLMtons) # TO EDIT

HS4DigitMonthlyLAGS$detrended <- resid(lm(`aço bruto (tons)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
# acoBrutoPLMaggregate <- plm(detrended ~ imports*partner + exports*partner + BrazilGDP_PPP,data = HS4DigitMonthly, effect = "individual",
#                model = "within",
#                index = "partner")
acoBrutoPLMdisggregateLAGS <- plm(detrended ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + BrazilGDP_PPP,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(acoBrutoPLMaggregate)
# summary(acoBrutoPLMdisggregate)





# Laminates
laminadosHS <- c(7225, 7220, 7221, 7219, 7227, 7208, 7210, 7213, 7211, 7212, 7226) # TO EDIT
HS4DigitMonthlyLAGS <- HS4DigitMonthlyLAGS %>% 
  mutate(importslag0 = Imp7225lag0 + Imp7220lag0 + Imp7221lag0 + Imp7219lag0 + Imp7227lag0 + Imp7208lag0 + Imp7210lag0 + Imp7213lag0 + Imp7211lag0 + Imp7212lag0 + Imp7226lag0,
                                                      importslag0.5 = Imp7225lag0.5 + Imp7220lag0.5 + Imp7221lag0.5 + Imp7219lag0.5 + Imp7227lag0.5 + Imp7208lag0.5 + Imp7210lag0.5 + Imp7213lag0.5 + Imp7211lag0.5 + Imp7212lag0.5 + Imp7226lag0.5,
                                                      importslag1 = Imp7225lag1 + Imp7220lag1 + Imp7221lag1 + Imp7219lag1 + Imp7227lag1 + Imp7208lag1 + Imp7210lag1 + Imp7213lag1 + Imp7211lag1 + Imp7212lag1 + Imp7226lag1,
                                                      importslag1.5 = Imp7225lag1.5 + Imp7220lag1.5 + Imp7221lag1.5 + Imp7219lag1.5 + Imp7227lag1.5 + Imp7208lag1.5 + Imp7210lag1.5 + Imp7213lag1.5 + Imp7211lag1.5 + Imp7212lag1.5 + Imp7226lag1.5,
                                                      importslag2 = Imp7225lag2 + Imp7220lag2 + Imp7221lag2 + Imp7219lag2 + Imp7227lag2 + Imp7208lag2 + Imp7210lag2 + Imp7213lag2 + Imp7211lag2 + Imp7212lag2 + Imp7226lag2,
         

         exportslag0 = Exp7225lag0 + Exp7220lag0 + Exp7221lag0 + Exp7219lag0 + Exp7227lag0 + Exp7208lag0 + Exp7210lag0 + Exp7213lag0 + Exp7211lag0 + Exp7212lag0 + Exp7226lag0,
                                                      exportslag0.5 = Exp7225lag0.5 + Exp7220lag0.5 + Exp7221lag0.5 + Exp7219lag0.5 + Exp7227lag0.5 + Exp7208lag0.5 + Exp7210lag0.5 + Exp7213lag0.5 + Exp7211lag0.5 + Exp7212lag0.5 + Exp7226lag0.5,
                                                      exportslag1 = Exp7225lag1 + Exp7220lag1 + Exp7221lag1 + Exp7219lag1 + Exp7227lag1 + Exp7208lag1 + Exp7210lag1 + Exp7213lag1 + Exp7211lag1 + Exp7212lag1 + Exp7226lag1,
                                                      exportslag1.5 = Exp7225lag1.5 + Exp7220lag1.5 + Exp7221lag1.5 + Exp7219lag1.5 + Exp7227lag1.5 + Exp7208lag1.5 + Exp7210lag1.5 + Exp7213lag1.5 + Exp7211lag1.5 + Exp7212lag1.5 + Exp7226lag1.5,
                                                      exportslag2 = Exp7225lag2 + Exp7220lag2 + Exp7221lag2 + Exp7219lag2 + Exp7227lag2 + Exp7208lag2 + Exp7210lag2 + Exp7213lag2 + Exp7211lag2 + Exp7212lag2 + Exp7226lag2,)
laminadosLMtonsLAGS <- # TO EDIT
  lm(`laminados (tons)` ~  # TO EDIT
                      fYear + fMonth + 
                      (partner=="China") + 
                      importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China")+
       BrazilGDP_PPP , # TO EDIT
                    data = as.data.frame(HS4DigitMonthlyLAGS)) # TO EDIT
# summary(laminadosLMtons) # TO EDIT

HS4DigitMonthlyLAGS$detrended <- resid(lm(`laminados (tons)` ~ fYear + fMonth, HS4DigitMonthlyLAGS))
# laminadosPLMaggregate <- plm(detrended ~ imports*partner + exports*partner + BrazilGDP_PPP,data = laminadosTibble, effect = "individual",
#                model = "within",
#                index = "partner")
laminadosPLMdisggregateLAGS <- plm(detrended ~ importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2 + (importslag0 + importslag0.5 + importslag1 + importslag1.5 + importslag2 + exportslag0 + exportslag0.5 + exportslag1 + exportslag1.5 + exportslag2)*(partner=="China") + BrazilGDP_PPP,data = HS4DigitMonthlyLAGS, effect = "individual",
               model = "within",
               index = "partner")
# summary(laminadosPLMdisggregate)
# summary(laminadosPLMdisggregate)$coefficients[c("Imp7225:partnerChina","Imp7213:partnerChina","Imp7226:partnerChina"),]
# summary(acoBrutoPLMaggregate)
# summary(acoBrutoPLMdisggregate)



```
```{r presentation-tibble-assembling, include=FALSE, cache=TRUE,warning=FALSE}
get_row_metrics <- function(row) {
  sigfigs = 4
  estimate <- signif(row[1],digits=sigfigs)
  sd <- signif(row[2],digits=sigfigs)
  tprob <- row[4]
  significance <- case_when(
    tprob < 0.001   ~ "***",
    tprob < 0.01  ~ "**",
    tprob < 0.05  ~ "*",
    tprob < 0.1  ~ ".",
    TRUE ~ " "
  )
  lower_95 <- signif(estimate - 1.96*sd,digits=sigfigs)
  upper_95 <- signif(estimate + 1.96*sd,digits=sigfigs)
  conf_interval <- paste("[", lower_95, ", ", upper_95, "]",sep="")
  new_row <- c(estimate,sd,conf_interval,significance)
  return(new_row)
}

signr <- function(num) {
  if (sign(num) == 1) {
    "+"
  } else if (sign(num) == -1) {
    "-"
  } else {
    "0"
  }
}

get_lag_significance_BEC <- function(coefs) {
  importslag0INDEX = -1
  importslag0.5INDEX = -1
  importslag1INDEX = -1
  importslag1.5INDEX = -1
  importslag2INDEX = -1
  exportslag0INDEX = -1
  exportslag0.5INDEX = -1
  exportslag1INDEX = -1
  exportslag1.5INDEX = -1
  exportslag2INDEX = -1
  names <- rownames(coefs)
  for (i in 1:length(names)) {
    word <- names[i]
    
    wordlength <- str_length(word)
    if (substr(word, 1,3) == "Imp" && substr(word, wordlength-3,wordlength) == "lag0") {
      importslag0INDEX = i
    }
    if (substr(word, 1,3) == "Imp" && substr(word, wordlength-5,wordlength) == "lag0.5") {
      importslag0.5INDEX = i
    }
    if (substr(word, 1,3) == "Imp" && substr(word, wordlength-3,wordlength) == "lag1") {
      importslag1INDEX = i
    }
    if (substr(word, 1,3) == "Imp" && substr(word, wordlength-5,wordlength) == "lag1.5") {
      importslag1.5INDEX = i
    }
    if (substr(word, 1,3) == "Imp" && substr(word, wordlength-3,wordlength) == "lag2") {
      importslag2INDEX = i
    }
    if (substr(word, 1,3) == "Exp" && substr(word, wordlength-3,wordlength) == "lag0") {
      exportslag0INDEX = i
    }
    if (substr(word, 1,3) == "Exp" && substr(word, wordlength-5,wordlength) == "lag0.5") {
      exportslag0.5INDEX = i
    }
    if (substr(word, 1,3) == "Exp" && substr(word, wordlength-3,wordlength) == "lag1") {
      exportslag1INDEX = i
    }
    if (substr(word, 1,3) == "Exp" && substr(word, wordlength-5,wordlength) == "lag1.5") {
      exportslag1.5INDEX = i
    }
    if (substr(word, 1,3) == "Exp" && substr(word, wordlength-3,wordlength) == "lag2") {
      exportslag2INDEX = i
    }
  }
  
  importslag0 = ""
  importslag0.5 = ""
  importslag1 = ""
  importslag1.5 = ""
  importslag2 = ""
  exportslag0 = ""
  exportslag0.5 = ""
  exportslag1 = ""
  exportslag1.5 = ""
  exportslag2 = ""
  
  if (coefs[importslag0INDEX,4] < 0.05) {
    importslag0 <- signr(coefs[importslag0INDEX,1])
  }
  if (coefs[importslag0.5INDEX,4] < 0.05) {
    importslag0.5 <- signr(coefs[importslag0.5INDEX,1])
  }
  if (coefs[importslag1INDEX,4] < 0.05) {
    importslag1 <- signr(coefs[importslag1INDEX,1])
  }
  if (coefs[importslag1.5INDEX,4] < 0.05) {
    importslag1.5 <- signr(coefs[importslag1.5INDEX,1])
  }
  if (coefs[importslag2INDEX,4] < 0.05) {
    importslag2 <- signr(coefs[importslag2INDEX,1])
  }
  if (coefs[exportslag0INDEX,4] < 0.05) {
    exportslag0 <- signr(coefs[exportslag0INDEX,1])
  }
  if (coefs[exportslag0.5INDEX,4] < 0.05) {
    exportslag0.5 <- signr(coefs[exportslag0.5INDEX,1])
  }
  if (coefs[exportslag1INDEX,4] < 0.05) {
    exportslag1 <- signr(coefs[exportslag1INDEX,1])
  }
  if (coefs[exportslag1.5INDEX,4] < 0.05) {
    exportslag1.5 <- signr(coefs[exportslag1.5INDEX,1])
  }
  if (coefs[exportslag2INDEX,4] < 0.05) {
    exportslag2 <- signr(coefs[exportslag2INDEX,1])
  }

  new_row <- c(importslag0,importslag0.5,importslag1,importslag1.5,importslag2,exportslag0,exportslag0.5,exportslag1,exportslag1.5 ,exportslag2)
  return(new_row)
}

get_lag_significance_commodities <- function(coefs) {
  names <- rownames(coefs)
  importslag0 = ""
  importslag0.5 = ""
  importslag1 = ""
  importslag1.5 = ""
  importslag2 = ""
  exportslag0 = ""
  exportslag0.5 = ""
  exportslag1 = ""
  exportslag1.5 = ""
  exportslag2 = ""
  
  if ("importslag0" %in% rownames(coefs) && coefs[c("importslag0"),4] < 0.05) {
    importslag0 <- signr(coefs[c("importslag0"),4])
  }
  if ("importslag0.5" %in% rownames(coefs) && coefs[c("importslag0.5"),4]  < 0.05) {
    importslag0.5 <- signr(coefs[c("importslag0.5"),4])
  }
  if ("importslag1" %in% rownames(coefs) &&coefs[c("importslag1"),4] < 0.05) {
    importslag1 <- signr(coefs[c("importslag1"),4])
  }
  if ("importslag1.5" %in% rownames(coefs) &&coefs[c("importslag1.5"),4] < 0.05) {
    importslag1.5 <- signr(coefs[c("importslag1.5"),4])
  }
  if ("importslag2" %in% rownames(coefs) && coefs[c("importslag2"),4] < 0.05) {
    importslag2 <- signr(coefs[c("importslag2"),4])
  }
  if ("exportslag0" %in% rownames(coefs) &&coefs[c("exportslag0"),4] < 0.05) {
    exportslag0 <- signr(coefs[c("exportslag0"),1])
  }
  if ("exportslag0.5" %in% rownames(coefs) &&coefs[c("exportslag0.5"),4] < 0.05) {
    exportslag0.5 <- signr(coefs[c("exportslag0.5"),1])
  }
  if ("exportslag1" %in% rownames(coefs) &&coefs[c("exportslag1"),4] < 0.05) {
    exportslag1 <- signr(coefs[c("exportslag1"),1])
  }
  if ("exportslag1.5" %in% rownames(coefs) &&coefs[c("exportslag1.5"),4] < 0.05) {
    exportslag1.5 <- signr(coefs[c("exportslag1.5"),1])
  }
  if ("exportslag2" %in% rownames(coefs) &&coefs[c("exportslag2"),4] < 0.05) {
    exportslag2 <- signr(coefs[c("exportslag2"),1])
  }

  new_row <- c(importslag0,importslag0.5,importslag1,importslag1.5,importslag2,exportslag0,exportslag0.5,exportslag1,exportslag1.5,exportslag2)
  return(new_row)
}


# partnerChina table
partnerChinaRowsBEC <- rbind(get_row_metrics(summary(BEC111)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC111plm))[c("China"),]),
get_row_metrics(summary(BEC121)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC121plm))[c("China"),]),
get_row_metrics(summary(BEC122)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC122plm))[c("China"),]),
get_row_metrics(summary(BEC21)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC21plm))[c("China"),]),
get_row_metrics(summary(BEC22)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC22plm))[c("China"),]),
get_row_metrics(summary(BEC31)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC31plm))[c("China"),]),
get_row_metrics(summary(BEC322)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC322plm))[c("China"),]),
get_row_metrics(summary(BEC41)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC41plm))[c("China"),]),
get_row_metrics(summary(BEC42)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC42plm))[c("China"),]),
get_row_metrics(summary(BEC51)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC51plm))[c("China"),]),
get_row_metrics(summary(BEC522)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC522plm))[c("China"),]),
get_row_metrics(summary(BEC53)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC53plm))[c("China"),]),
get_row_metrics(summary(BEC61)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC61plm))[c("China"),]),
get_row_metrics(summary(BEC62)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC62plm))[c("China"),]),
get_row_metrics(summary(BEC63)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC63plm))[c("China"),]),
get_row_metrics(summary(BEC7)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC7plm))[c("China"),]))

partnerChinaNamesBEC <- c("BEC111 Primary food and beverages, mainly for industry", "BEC111 Primary food and beverages, mainly for industry", "BEC121 Processed food and beverages, mainly for industry","BEC121 Processed food and beverages, mainly for industry", "BEC122 Processed food and beverages, mainly for household consumption","BEC122 Processed food and beverages, mainly for household consumption", "BEC21 Primary industrial supplies nes","BEC21 Primary industrial supplies nes", "BEC22 Processed industrial supplies nes","BEC22 Processed industrial supplies nes", "BEC31 Primary fuels and lubricants", "BEC31 Primary fuels and lubricants", "BEC222 Processed fuels and lubricants, other than motor spirit","BEC222 Processed fuels and lubricants, other than motor spirit", "BEC41 Capital goods (except transport equipment)","BEC41 Capital goods (except transport equipment)", "BEC42 Capital goods parts and accessories","BEC42 Capital goods parts and accessories", "BEC51 Passenger motor cars","BEC51 Passenger motor cars", "BEC522 Other non-industrial transport equipment","BEC522 Other non-industrial transport equipment", "BEC53 Transport equipment parts and accessories","BEC53 Transport equipment parts and accessories", "BEC61 Durable consumer goods","BEC61 Durable consumer goods", "BEC62 Semi-durable consumer goods","BEC62 Semi-durable consumer goods", "BEC63 Non-durable consumer goods","BEC63 Non-durable consumer goods", "BEC7 Goods not elsewhere specified", "BEC7 Goods not elsewhere specified")

partnerChinaModelsBEC <- rep(c("`lm`", "`plm`"),16)

partnerChinaTibbleBEC <- cbind(partnerChinaNamesBEC, partnerChinaModelsBEC, partnerChinaRowsBEC)

# INTERACTION TERM TABLE
interactionTermRowsBEC <- rbind(
  get_row_metrics(summary(BEC111)$coefficients[c("ImpBEC111:partner == \"China\"TRUE"),]),
  get_row_metrics(summary(BEC111)$coefficients[c("ExpBEC111:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC111plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC111"),]),
get_row_metrics(summary(BEC111plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC111"),]),
get_row_metrics(summary(BEC121)$coefficients[c("ImpBEC121:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC121)$coefficients[c("ExpBEC121:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC121plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC121"),]),
get_row_metrics(summary(BEC121plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC121"),]),
get_row_metrics(summary(BEC122)$coefficients[c("ImpBEC122:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC122)$coefficients[c("ExpBEC122:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC122plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC122"),]),
get_row_metrics(summary(BEC122plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC122"),]),
get_row_metrics(summary(BEC21)$coefficients[c("ImpBEC21:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC21)$coefficients[c("ExpBEC21:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC21plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC21"),]),
get_row_metrics(summary(BEC21plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC21"),]),
get_row_metrics(summary(BEC22)$coefficients[c("ImpBEC22:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC22)$coefficients[c("ExpBEC22:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC22plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC22"),]),
get_row_metrics(summary(BEC22plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC22"),]),
get_row_metrics(summary(BEC31)$coefficients[c("ImpBEC31:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC31)$coefficients[c("ExpBEC31:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC31plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC31"),]),
get_row_metrics(summary(BEC31plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC31"),]),
get_row_metrics(summary(BEC322)$coefficients[c("ImpBEC322:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC322)$coefficients[c("ExpBEC322:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC322plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC322"),]),
get_row_metrics(summary(BEC322plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC322"),]),
get_row_metrics(summary(BEC41)$coefficients[c("ImpBEC41:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC41)$coefficients[c("ExpBEC41:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC41plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC41"),]),
get_row_metrics(summary(BEC41plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC41"),]),
get_row_metrics(summary(BEC42)$coefficients[c("ImpBEC42:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC42)$coefficients[c("ExpBEC42:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC42plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC42"),]),
get_row_metrics(summary(BEC42plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC42"),]),
get_row_metrics(summary(BEC51)$coefficients[c("ImpBEC51:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC51)$coefficients[c("ExpBEC51:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC51plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC51"),]),
get_row_metrics(summary(BEC51plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC51"),]),
get_row_metrics(summary(BEC522)$coefficients[c("ImpBEC522:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC522)$coefficients[c("ExpBEC522:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC522plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC522"),]),
get_row_metrics(summary(BEC522plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC522"),]),
get_row_metrics(summary(BEC53)$coefficients[c("ImpBEC53:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC53)$coefficients[c("ExpBEC53:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC53plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC53"),]),
get_row_metrics(summary(BEC53plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC53"),]),
get_row_metrics(summary(BEC61)$coefficients[c("ImpBEC61:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC61)$coefficients[c("ExpBEC61:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC61plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC61"),]),
get_row_metrics(summary(BEC61plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC61"),]),
get_row_metrics(summary(BEC62)$coefficients[c("ImpBEC62:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC62)$coefficients[c("ExpBEC62:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC62plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC62"),]),
get_row_metrics(summary(BEC62plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC62"),]),
get_row_metrics(summary(BEC63)$coefficients[c("ImpBEC63:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC63)$coefficients[c("ExpBEC63:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC63plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC63"),]),
get_row_metrics(summary(BEC63plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC63"),]),
get_row_metrics(summary(BEC7)$coefficients[c("ImpBEC7:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC7)$coefficients[c("ExpBEC7:partner == \"China\"TRUE"),]),
get_row_metrics(summary(BEC7plm)$coefficients[c("partner == \"China\"TRUE:ImpBEC7"),]),
get_row_metrics(summary(BEC7plm)$coefficients[c("partner == \"China\"TRUE:ExpBEC7"),]))


interactionTermNamesBEC = c("BEC111 Primary food and beverages, mainly for industry","BEC111 Primary food and beverages, mainly for industry","BEC111 Primary food and beverages, mainly for industry","BEC111 Primary food and beverages, mainly for industry", "BEC121 Processed food and beverages, mainly for industry","BEC121 Processed food and beverages, mainly for industry","BEC121 Processed food and beverages, mainly for industry","BEC121 Processed food and beverages, mainly for industry", "BEC122 Processed food and beverages, mainly for household consumption","BEC122 Processed food and beverages, mainly for household consumption","BEC122 Processed food and beverages, mainly for household consumption","BEC122 Processed food and beverages, mainly for household consumption", "BEC21 Primary industrial supplies nes","BEC21 Primary industrial supplies nes","BEC21 Primary industrial supplies nes","BEC21 Primary industrial supplies nes", "BEC22 Processed industrial supplies nes","BEC22 Processed industrial supplies nes","BEC22 Processed industrial supplies nes","BEC22 Processed industrial supplies nes", "BEC31 Primary fuels and lubricants", "BEC31 Primary fuels and lubricants", "BEC31 Primary fuels and lubricants", "BEC31 Primary fuels and lubricants", "BEC222 Processed fuels and lubricants, other than motor spirit","BEC222 Processed fuels and lubricants, other than motor spirit","BEC222 Processed fuels and lubricants, other than motor spirit","BEC222 Processed fuels and lubricants, other than motor spirit", "BEC41 Capital goods (except transport equipment)", "BEC41 Capital goods (except transport equipment)", "BEC41 Capital goods (except transport equipment)", "BEC41 Capital goods (except transport equipment)", "BEC42 Capital goods parts and accessories", "BEC42 Capital goods parts and accessories", "BEC42 Capital goods parts and accessories", "BEC42 Capital goods parts and accessories", "BEC51 Passenger motor cars", "BEC51 Passenger motor cars", "BEC51 Passenger motor cars", "BEC51 Passenger motor cars", "BEC522 Other non-industrial transport equipment", "BEC522 Other non-industrial transport equipment", "BEC522 Other non-industrial transport equipment", "BEC522 Other non-industrial transport equipment", "BEC53 Transport equipment parts and accessories", "BEC53 Transport equipment parts and accessories", "BEC53 Transport equipment parts and accessories", "BEC53 Transport equipment parts and accessories", "BEC61 Durable consumer goods","BEC61 Durable consumer goods","BEC61 Durable consumer goods","BEC61 Durable consumer goods", "BEC62 Semi-durable consumer goods", "BEC62 Semi-durable consumer goods", "BEC62 Semi-durable consumer goods", "BEC62 Semi-durable consumer goods", "BEC63 Non-durable consumer goods","BEC63 Non-durable consumer goods","BEC63 Non-durable consumer goods","BEC63 Non-durable consumer goods","BEC7 Goods not elsewhere specified","BEC7 Goods not elsewhere specified","BEC7 Goods not elsewhere specified", "BEC7 Goods not elsewhere specified")

interactionTermModelsBEC <- rep(c("`lm`","`lm`","`plm`","`plm`"),16)

interactionTermTradeFlowsBEC <- rep(c("Import","Export"),32)

interactionTermsTibbleBEC <- as.data.frame(cbind(interactionTermNamesBEC,interactionTermTradeFlowsBEC,interactionTermModelsBEC, interactionTermRowsBEC))


#Agropecuario PartnerChina

partnerChinaRowsAgropecuario <- rbind(
get_row_metrics(summary(bovinosLMtons)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(bovinosPLMdisggregate))[c("China"),]),
get_row_metrics(summary(frangosLMtons)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(frangosPLMdisggregate))[c("China"),]),
get_row_metrics(summary(suinosLMtons)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(suinosPLMdisggregate))[c("China"),]),
get_row_metrics(summary(algodaoLMtons)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(algodaoPLMtons))[c("China"),]),
get_row_metrics(summary(algodaoLMhect)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(algodaoPLMhect))[c("China"),]),
get_row_metrics(summary(coffeeLMQtde)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(coffeePLMQtde))[c("China"),]),
get_row_metrics(summary(coffeeLMhect)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(coffeePLMhect))[c("China"),]),
get_row_metrics(summary(canadeacucarLMQtde)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(canadeacucarPLMQtde))[c("China"),]),
get_row_metrics(summary(canadeacucarLMhect)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(canadeacucarPLMhect))[c("China"),]),
get_row_metrics(summary(milhoLMQtde)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(milhoPLMQtde))[c("China"),]),
get_row_metrics(summary(milhoLMhect)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(milhoPLMhect))[c("China"),]),
get_row_metrics(summary(sojaLMQtde)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(sojaPLMQtdeImp))[c("China"),]),
get_row_metrics(summary(fixef(sojaPLMQtdeImp))[c("China"),]),
get_row_metrics(summary(sojaLMhect)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(sojaPLMhectImp))[c("China"),]),
get_row_metrics(summary(fixef(sojaPLMhectExp))[c("China"),]),
get_row_metrics(summary(cacauLMQtde)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(cacauPLMQtde))[c("China"),]),
get_row_metrics(summary(fumoLMQtde)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(fumoPLMQtde))[c("China"),]) #,
#get_row_metrics_with_intercept(summary(trigoLMQtde)$coefficients[c("partnerChina"),],summary(trigoLMQtde)$coefficients[c("(Intercept)"),]), I THINK THAT BRAZIL DIDNT TRADE WITH CHINA IN WHEAT
#get_row_metrics(summary(fixef(trigoPLMQtde))[c("China"),])
)

partnerChinaNamesAgropecuario <- c(
  "Beef","Beef","Poultry (chicken)","Poultry (chicken)","Pork","Pork","Cotton","Cotton","Cotton","Cotton","Coffee","Coffee","Coffee","Coffee","Sugarcane","Sugarcane","Sugarcane","Sugarcane","Corn","Corn","Corn","Corn","Soy","Soy","Soy","Soy","Soy","Soy","Cocoa","Cocoa","Tobacco","Tobacco"
)

partnerChinaMetricAgropecuario <-
  c(rep("Weight (tons)",8), rep(c("Area harvested (hect)","Area harvested (hect)","Weight (tons)","Weight (tons)"),4),"Weight (tons)","Area harvested (hect)","Area harvested (hect)","Area harvested (hect)","Weight (tons)","Weight (tons)","Weight (tons)","Weight (tons)")

partnerChinaModelsAgropecuario <- 
  c(rep(c("`lm`","`plm`"),12),"`plm`","`lm`","`plm`","`plm`","`lm`","`plm`","`lm`","`plm`")

partnerChinaAgropecuarioTibble <- as.data.frame(cbind(partnerChinaNamesAgropecuario, partnerChinaModelsAgropecuario, partnerChinaMetricAgropecuario, partnerChinaRowsAgropecuario))

names(partnerChinaAgropecuarioTibble) <- c("Product","Model","Metric","Estimate","Std. Error","95% Conf. Int.", "Signif.")

# Metal Fuels 
partnerChinaRowsMetalFuels <-
  rbind(
get_row_metrics(summary(algodaoLMvalue)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(algodaoPLMvalue))[c("China"),]),
get_row_metrics(summary(coffeeLMvalue)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(coffeePLMvalue))[c("China"),]),
get_row_metrics(summary(canadeacucarLMvalue)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(canadeacucarPLMvalue))[c("China"),]),
get_row_metrics(summary(milhoLMvalue)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(milhoPLMvalue))[c("China"),]),
get_row_metrics(summary(sojaLMvalue)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(sojaPLMvalue))[c("China"),]),
get_row_metrics(summary(cacauLMvalue)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(cacauPLMvalue))[c("China"),]),
get_row_metrics(summary(fumoLMvalue)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(fumoPLMvalue))[c("China"),]),
get_row_metrics(summary(petroleoLM)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(petroleoPLMvolume))[c("China"),]),
get_row_metrics(summary(gasLM)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(gasPLMvolume))[c("China"),]),
get_row_metrics(summary(ferroGusaLMtons)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(ferroGusaPLMaggregate))[c("China"),]),
get_row_metrics(summary(acoBrutoLMtons)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(acoBrutoPLMdisggregate))[c("China"),]),
get_row_metrics(summary(laminadosLMtons)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(laminadosPLMdisggregate))[c("China"),])
)

partnerChinaNamesMetalFuels <- c("Cotton", "Cotton", "Coffee", "Coffee", "Sugarcane", "Sugarcane", "Corn", "Corn", "Soy", "Soy", "Cocoa", "Cocoa", "Tobacco", "Tobacco",
  "Petroleum","Petroluem","Natural gas","Natural gas","Pig iron","Pig iron","Crude steel","Crude steel","Laminates","Laminates")

partnerChinaMetricMetalFuels <-
  c(rep("Constant 1982 USD$",14),"Volume (avg barrels/day)","Volume (avg barrels/day)", "Volume (cubic meters)","Volume (cubic meters)",rep(c("Index (mid-2014 = 100)"), 6))

partnerChinaModelsMetalFuels <- 
  c(rep(c("`lm`","`plm`"),5+7))

partnerChinaMetalFuelsTibble <- as.data.frame(cbind(partnerChinaNamesMetalFuels, partnerChinaModelsMetalFuels, partnerChinaMetricMetalFuels, partnerChinaRowsMetalFuels))

# COUNTING COUNTRIES 
countryCountingTibble <- as.data.frame(partnersCountingMatrix)
countryCountingColnames <- c("Positive Country Coef", "Positive Import Interaction", "Positive Export Interaction", "Negative Country Coef", "Negative Import Interaction", "Negative Export Interaction")
names(countryCountingTibble) <- countryCountingColnames
countryCountingCountries <- partners[1:10]
countryCountingTibble <- cbind(countryCountingCountries, countryCountingTibble)




interactionsAgropecuarioMetalsFuelsRow <-
  rbind(
    get_row_metrics(summary(bovinosLMtons)$coefficients[c("Exp202:partner == \"China\"TRUE"),]),
  get_row_metrics(summary(bovinosPLMdisggregate)$coefficients[c("partner == \"China\"TRUE:Exp202"),]),
get_row_metrics(summary(coffeeLMQtde)$coefficients[c("Exp2101:partner == \"China\"TRUE"),]),
get_row_metrics(summary(coffeePLMQtde)$coefficients[c("partner == \"China\"TRUE:Exp2101"),]),
get_row_metrics(summary(milhoPLMQtde)$coefficients[c("Imp1103:partner == \"China\"TRUE"),]),
get_row_metrics(summary(milhoLMhect)$coefficients[c("Exp1005:partner == \"China\"TRUE"),]),
get_row_metrics(summary(milhoPLMhect)$coefficients[c("Imp1005:partner == \"China\"TRUE"),]),
get_row_metrics(summary(sojaLMhect)$coefficients[c("Imp1201:partner == \"China\"TRUE"),]),
get_row_metrics(summary(petroleoLM)$coefficients[c("Exp2713:partner == \"China\"TRUE"),]),
get_row_metrics(summary(petroleoPLMvolume)$coefficients[c("partner == \"China\"TRUE:Exp2713"),]),
get_row_metrics(summary(laminadosLMtons)$coefficients[c("partner == \"China\"TRUE:Imp7225"),]),
get_row_metrics(summary(laminadosLMtons)$coefficients[c("partner == \"China\"TRUE:Imp7226"),]),
get_row_metrics(summary(laminadosLMtons)$coefficients[c("partner == \"China\"TRUE:Imp7213"),]),
get_row_metrics(summary(laminadosPLMdisggregate)$coefficients[c("Imp7225:partner == \"China\"TRUE"),]),
get_row_metrics(summary(laminadosPLMdisggregate)$coefficients[c("Imp7213:partner == \"China\"TRUE"),]),
get_row_metrics(summary(laminadosPLMdisggregate)$coefficients[c("Imp7212:partner == \"China\"TRUE"),])
  )

interactionsAgropecuarioMetalsFuelsCommodity <- c("Beef", "Beef", "Coffee", "Coffee", "Corn","Corn","Corn","Soy","Petroleum","Petroleum","Laminates","Laminates","Laminates","Laminates","Laminates","Laminates")
interactionsAgropecuarioMetalsFuelsMetric <- c("Weight (tons)", "Weight (tons)", "Weight (tons)", "Weight (tons)", "Area harvested (hect)","Area harvested (hect)","Area harvested (hect)","Area harvested (hect)","Volume (avg barrels/day)","Volume (avg barrels/day)","Index (mid-2014 = 100)","Index (mid-2014 = 100)","Index (mid-2014 = 100)","Index (mid-2014 = 100)","Index (mid-2014 = 100)","Index (mid-2014 = 100)")
interactionsAgropecuarioMetalsFuelsFlow <- c("Export","Export","Export","Export","Import","Export","Import","Import","Export","Export","Import","Import","Import","Import","Import","Import")
interactionsAgropecuarioMetalsFuelsModel <- c("`lm`", "`plm`", "`lm`", "`plm`", "`plm`","`lm`","`lm`","`lm`","`lm`","`plm`","`lm`","`lm`","`lm`","`plm`","`plm`","`plm`")


interactionsAgropecuarioMetalsFuelsTibble <- as.data.frame(cbind(interactionsAgropecuarioMetalsFuelsCommodity,interactionsAgropecuarioMetalsFuelsMetric,interactionsAgropecuarioMetalsFuelsFlow,interactionsAgropecuarioMetalsFuelsModel,interactionsAgropecuarioMetalsFuelsRow))



# BEC LAGGED TERMS - CHINA FIXED EFFECT
BEC_lags_China_FE <- rbind(
  get_row_metrics(summary(BEC111LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC111plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC121LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC121plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC122LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC122plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC21LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC21plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC22LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC22plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC31LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC31plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC322LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC322plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC41LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC41plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC42LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC42plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC51LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC51plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC522LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC522plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC53LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC53plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC61LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC61plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC62LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC62plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC63LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC63plmLAGS))[c("China"),]),
get_row_metrics(summary(BEC7LAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(BEC7plmLAGS))[c("China"),]))

BEC_lags_China_FE_tibble <- cbind(partnerChinaNamesBEC, partnerChinaModelsBEC, BEC_lags_China_FE)

# BEC LAGGED TERMS - SIGNIFICANCE OF LAGS 
BEC_lags_significance_rows <- rbind(
  get_lag_significance_BEC(summary(BEC111LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC111plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC121LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC121plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC122LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC122plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC21LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC21plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC22LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC22plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC31LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC31plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC322LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC322plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC41LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC41plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC42LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC42plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC51LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC51plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC522LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC522plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC53LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC53plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC61LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC61plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC62LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC62plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC63LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC63plmLAGS)$coefficients),
get_lag_significance_BEC(summary(BEC7LAGS)$coefficients),
get_lag_significance_BEC(summary(BEC7plmLAGS)$coefficients))

BEC_lags_significance_rows_tibble <- cbind(partnerChinaNamesBEC, partnerChinaModelsBEC, BEC_lags_significance_rows)

# COMMODITIES CHINA FE
agriculture_china_fe_lags <- rbind(
get_row_metrics(summary(bovinosLMtonsLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(bovinosPLMdisggregateLAGS))[c("China"),]),
get_row_metrics(summary(frangosLMtonsLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(frangosPLMdisggregateLAGS))[c("China"),]),
get_row_metrics(summary(suinosLMtonsLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(suinosPLMdisggregateLAGS))[c("China"),]),
get_row_metrics(summary(algodaoLMtonsLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(algodaoPLMtonsLAGS))[c("China"),]),
get_row_metrics(summary(algodaoLMhectLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(algodaoPLMhectLAGS))[c("China"),]),
get_row_metrics(summary(coffeeLMQtdeLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(coffeePLMQtdeLAGS))[c("China"),]),
get_row_metrics(summary(coffeeLMhectLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(coffeePLMhectLAGS))[c("China"),]),
get_row_metrics(summary(canadeacucarLMQtdeLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(canadeacucarPLMQtdeLAGS))[c("China"),]),
get_row_metrics(summary(canadeacucarLMhectLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(canadeacucarPLMhectLAGS))[c("China"),]),
get_row_metrics(summary(milhoLMQtdeLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(milhoPLMQtdeLAGS))[c("China"),]),
get_row_metrics(summary(milhoLMhectLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(milhoPLMhectLAGS))[c("China"),]),
get_row_metrics(summary(sojaLMQtdeLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(sojaPLMQtdeImpLAGS))[c("China"),]),
get_row_metrics(summary(fixef(sojaPLMQtdeImpLAGS))[c("China"),]),
get_row_metrics(summary(sojaLMhectLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(sojaPLMhectImpLAGS))[c("China"),]),
get_row_metrics(summary(fixef(sojaPLMhectExpLAGS))[c("China"),]),
get_row_metrics(summary(cacauLMQtdeLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(cacauPLMQtdeLAGS))[c("China"),]),
get_row_metrics(summary(fumoLMQtdeLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(fumoPLMQtdeLAGS))[c("China"),]) 
)
ChinaFE_LAGSAgropecuarioTibble <- as.data.frame(cbind(partnerChinaNamesAgropecuario, partnerChinaModelsAgropecuario, partnerChinaMetricAgropecuario, agriculture_china_fe_lags))

# names(ChinaFE_LAGSAgropecuarioTibble) <- c("Product","Model","Metric","ImpLag0","ImpLag0.5","ImpLag1", "ImpLag1.5", "ImpLag2", "ExpLag0","ExpLag0.5","ExpLag1", "ExpLag1.5", "ExpLag2")



metalsfuels_lags_china_fixedeffect <-
  rbind(
get_row_metrics(summary(algodaoLMvalueLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(algodaoPLMvalueLAGS))[c("China"),]),
get_row_metrics(summary(coffeeLMvalueLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(coffeePLMvalueLAGS))[c("China"),]),
get_row_metrics(summary(canadeacucarLMvalueLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(canadeacucarPLMvalueLAGS))[c("China"),]),
get_row_metrics(summary(milhoLMvalueLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(milhoPLMvalueLAGS))[c("China"),]),
get_row_metrics(summary(sojaLMvalueLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(sojaPLMvalueLAGS))[c("China"),]),
get_row_metrics(summary(cacauLMvalueLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(cacauPLMvalueLAGS))[c("China"),]),
get_row_metrics(summary(fumoLMvalueLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(fumoPLMvalueLAGS))[c("China"),]),
get_row_metrics(summary(petroleoLMLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(petroleoPLMvolumeLAGS))[c("China"),]),
get_row_metrics(summary(gasLMLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(gasPLMvolumeLAGS))[c("China"),]),
get_row_metrics(summary(ferroGusaLMtonsLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(ferroGusaPLMaggregateLAGS))[c("China"),]),
get_row_metrics(summary(acoBrutoLMtonsLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(acoBrutoPLMdisggregateLAGS))[c("China"),]),
get_row_metrics(summary(laminadosLMtonsLAGS)$coefficients[c("partner == \"China\"TRUE"),]),
get_row_metrics(summary(fixef(laminadosPLMdisggregateLAGS))[c("China"),])
)
# partnerChinaNamesMetalFuels <- c(
#   "Petroleum","Petroluem","Natural gas","Natural gas","Pig iron","Pig iron","Crude steel","Crude steel","Laminates","Laminates")
# 
# partnerChinaMetricMetalFuels <-
#   c("Volume (avg barrels/day)","Volume (avg barrels/day)", "Volume (cubic meters)","Volume (cubic meters)",rep(c("Index (mid-2014 = 100)"), 6))
# 
# partnerChinaModelsMetalFuels <- 
#   c(rep(c("`lm`","`plm`"),5))
partnerChinaMetalFuelsLAGSTibble <- as.data.frame(cbind(partnerChinaNamesMetalFuels, partnerChinaModelsMetalFuels, partnerChinaMetricMetalFuels, metalsfuels_lags_china_fixedeffect))

# COMMODITIES LAG SIGNIFICANCE
agriculture_lags_significance <- rbind(get_lag_significance_commodities(summary(bovinosLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(bovinosPLMdisggregateLAGS)$coefficients),
get_lag_significance_commodities(summary(frangosLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(frangosPLMdisggregateLAGS)$coefficients),
get_lag_significance_commodities(summary(suinosLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(suinosPLMdisggregateLAGS)$coefficients),
get_lag_significance_commodities(summary(algodaoLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(algodaoPLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(algodaoLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(algodaoPLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(coffeeLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(coffeePLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(coffeeLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(coffeePLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(canadeacucarLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(canadeacucarPLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(canadeacucarLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(canadeacucarPLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(milhoLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(milhoPLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(milhoLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(milhoPLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaPLMQtdeImpLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaPLMQtdeImpLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaLMhectLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaPLMhectImpLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaPLMhectExpLAGS)$coefficients),
get_lag_significance_commodities(summary(cacauLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(cacauPLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(fumoLMQtdeLAGS)$coefficients),
get_lag_significance_commodities(summary(fumoPLMQtdeLAGS)$coefficients))
# partnerChinaNamesAgropecuario <- c(
#   "Beef","Beef","Poultry (chicken)","Poultry (chicken)","Pork","Pork","Cotton","Cotton","Cotton","Cotton","Coffee","Coffee","Coffee","Coffee","Sugarcane","Sugarcane","Sugarcane","Sugarcane","Corn","Corn","Corn","Corn","Soy","Soy","Soy","Soy","Soy","Soy","Cocoa","Cocoa","Tobacco","Tobacco"
# )
# partnerChinaMetricAgropecuario <-
#   c(rep("Weight (tons)",8), rep(c("Area harvested (hect)","Area harvested (hect)","Weight (tons)","Weight (tons)"),4),"Weight (tons)","Area harvested (hect)","Area harvested (hect)","Area harvested (hect)","Weight (tons)","Weight (tons)","Weight (tons)","Weight (tons)")
# partnerChinaModelsAgropecuario <- 
#   c(rep(c("`lm`","`plm`"),12),"`plm`","`lm`","`plm`","`plm`","`lm`","`plm`","`lm`","`plm`")
lagsSignificanceAgropecuarioTibble <- as.data.frame(cbind(partnerChinaNamesAgropecuario, partnerChinaModelsAgropecuario, partnerChinaMetricAgropecuario, agriculture_lags_significance))

names(lagsSignificanceAgropecuarioTibble) <- c("Product","Model","Metric","ImpLag0","ImpLag0.5","ImpLag1", "ImpLag1.5", "ImpLag2", "ExpLag0","ExpLag0.5","ExpLag1", "ExpLag1.5", "ExpLag2")

metalsfuels_lags_significance <-
  rbind(
get_lag_significance_commodities(summary(algodaoLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(algodaoPLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(coffeeLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(coffeePLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(canadeacucarLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(canadeacucarPLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(milhoLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(milhoPLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(sojaPLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(cacauLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(cacauPLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(fumoLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(fumoPLMvalueLAGS)$coefficients),
get_lag_significance_commodities(summary(petroleoLMLAGS)$coefficients),
get_lag_significance_commodities(summary(petroleoPLMvolumeLAGS)$coefficients),
get_lag_significance_commodities(summary(gasLMLAGS)$coefficients),
get_lag_significance_commodities(summary(gasPLMvolumeLAGS)$coefficients),
get_lag_significance_commodities(summary(ferroGusaLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(ferroGusaPLMaggregateLAGS)$coefficients),
get_lag_significance_commodities(summary(acoBrutoLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(acoBrutoPLMdisggregateLAGS)$coefficients),
get_lag_significance_commodities(summary(laminadosLMtonsLAGS)$coefficients),
get_lag_significance_commodities(summary(laminadosPLMdisggregateLAGS)$coefficients))
# partnerChinaNamesMetalFuels <- c(
#   "Petroleum","Petroluem","Natural gas","Natural gas","Pig iron","Pig iron","Crude steel","Crude steel","Laminates","Laminates")
# partnerChinaMetricMetalFuels <-
#   c("Volume (avg barrels/day)","Volume (avg barrels/day)", "Volume (cubic meters)","Volume (cubic meters)",rep(c("Index (mid-2014 = 100)"), 6))
# partnerChinaModelsMetalFuels <- 
#   c(rep(c("`lm`","`plm`"),5))
LagsSignificanceMetalFuelsTibble <- as.data.frame(cbind(partnerChinaNamesMetalFuels, partnerChinaModelsMetalFuels, partnerChinaMetricMetalFuels, metalsfuels_lags_significance))

```
```{r plot-prep-annex, include=FALSE, echo=FALSE,warning=FALSE,message=FALSE,cache=TRUE}
commodity_diff_scale_avg <- meatMonthly %>% inner_join(metalsMonthly, by=c("fYear"="fYear","fMonth"="fMonth")) %>% inner_join(hydrocarbonsMonthly, by=c("fYear"="fYear","fMonth"="fMonth")) %>%
  transmute(beef = (`bovinos (tons)`),
            pork = (`suínos (tons)`),
            chicken = (`frangos (tons)`),
            `pig iron` = (`ferro-gusa (tons)`),
            `crude petroleum` = (`petróleo (k brl/day)`),
            years = as.double(as.character(fYear)) + as.double(as.character(fMonth))/12) %>% 
  pivot_longer(cols = c("beef","pork","chicken","pig iron", "crude petroleum"), names_to = "Commodity", values_to="Commodity Production") %>% 
  inner_join(tradeDataLong %>% 
               filter(flow=="Exports") %>% 
               filter(fourDigitHS2017 %in% c(202, 207, 203,7201,2709)) %>% 
               mutate(`Export Partner` = case_when(partner=="China" ~ "China", TRUE ~ "Other"),
                      `Trade Good = Matching Brazil Commodity` = 
                        case_when(fourDigitHS2017 == 202 ~ "Frozen Bovine Meat",
                                               fourDigitHS2017 == 207 ~ "Poultry Meat",
                                               fourDigitHS2017 == 203 ~ "Pig Meat",
                                               fourDigitHS2017 == 7201 ~ "Pig Iron",
                                               fourDigitHS2017 == 2709 ~ "Crude Petroleum"),
                      `Matching Commodity` = case_when(fourDigitHS2017 == 202 ~ "beef",
                                               fourDigitHS2017 == 207 ~ "chicken",
                                               fourDigitHS2017 == 203 ~ "pork",
                                               fourDigitHS2017 == 7201 ~ "pig iron",
                                               fourDigitHS2017 == 2709 ~ "crude petroleum"),
                      years = as.double(as.character(fYear)) + as.double(as.character(fMonth))/12) %>%
               group_by(years,`Export Partner`,`Trade Good = Matching Brazil Commodity`,`Matching Commodity`) %>%
               summarise(`Trade Value` = sum(valueNormalized)), by=c("years"="years","Commodity"="Matching Commodity")) %>% group_by(Commodity,years, `Commodity Production`) %>% summarise(`Trade Value`=sum(`Trade Value`)) %>% group_by(Commodity) %>% 
  summarise(avg_commodity_production = mean(`Commodity Production`),
            avg_trade_value = mean(`Trade Value`))



bec_avg_intensity <- PIM_PF_BEC %>% inner_join(tradeDataLong %>% select(threeDigitBEC,fYear,fMonth,valueNormalized), by=c("fYear"="fYear","fMonth"="fMonth","BEC"="threeDigitBEC")) %>% group_by(fYear,fMonth,BEC) %>% summarise(`Output Index` = mean(PIM_PF_BECindexValue), `Trade Value` = sum(valueNormalized)) %>% filter(BEC != 7) %>%
  mutate(years = as.double(as.character(fYear)) + as.double(as.character(fMonth))/12,
         .keep="unused") %>%
  filter(!(BEC %in% c(7,112))) %>% 
  group_by(BEC) %>% summarise(avg_intensity = mean(`Output Index`),
                                      avg_trade_value = mean(`Trade Value`))

share_harvest_to_china <- valordaproducao %>% filter(year > 2000) %>%
  mutate(soy = (`soja (Current USD$)`)*1000,
         corn = (`milho (Current USD$)`)*1000,
         sugarcane = `cana-de-açúcar (Current USD$)`*1000,
         coffee = `café (Current USD$)`*1000,
         cocoa = `cacau (Current USD$)`*1000,
         cotton = `algodão (Current USD$)`*1000,
         tobacco = `fumo (Current USD$)`*1000) %>%
  pivot_longer(cols = c("soy", "corn", "sugarcane", "coffee","cocoa","cotton", "tobacco"), names_to = "crop", values_to = "production_value") %>%
  inner_join(
    eda_trade_data %>%
      mutate(CROP = case_when(HS4Digit == 1201 ~ "soy",
                              HS4Digit == 901 ~ "coffee",
                              HS4Digit == 1701 ~ "sugarcane",
                              HS4Digit == 1005 ~ "corn",
                              HS2Digit == 18 ~ "cocoa",
                              HS2Digit == 24 ~ "tobacco",
                              HS2Digit == 52 ~ "cotton")) %>%
      drop_na(), by=c("year"="year", "crop"="CROP")) %>%
  filter(partner=="China") %>%
  filter(flow=="Export") %>%
  mutate(PctToChina = value/production_value) %>%
  ggplot(aes(x=period, y=PctToChina,colour=crop)) +
  geom_line() + 
  labs(x="Year", y="Share of Harvest to China", title="Share of Select Crop Harvests Exported to China") +
  theme(plot.title=element_text(hjust=0.5,size=8))

share_harvest_exported <- valordaproducao %>% filter(year > 2000) %>%
  mutate(soy = (`soja (Current USD$)`)*1000,
         corn = (`milho (Current USD$)`)*1000,
         sugarcane = `cana-de-açúcar (Current USD$)`*1000,
         coffee = `café (Current USD$)`*1000,
         cocoa = `cacau (Current USD$)`*1000,
         cotton = `algodão (Current USD$)`*1000,
         tobacco = `fumo (Current USD$)`*1000) %>%
  pivot_longer(cols = c("soy", "corn", "sugarcane", "coffee","cocoa","cotton", "tobacco"), names_to = "crop", values_to = "production_value") %>%
  inner_join(
    eda_trade_data %>%
      mutate(CROP = case_when(HS4Digit == 1201 ~ "soy",
                              HS4Digit == 901 ~ "coffee",
                              HS4Digit == 1701 ~ "sugarcane",
                              HS4Digit == 1005 ~ "corn",
                              HS2Digit == 18 ~ "cocoa",
                              HS2Digit == 24 ~ "tobacco",
                              HS2Digit == 52 ~ "cotton")) %>%
      drop_na(), by=c("year"="year", "crop"="CROP")) %>%
  filter(flow=="Export") %>%
  group_by(crop,period) %>% summarise(`production_value` = mean(production_value),
                                      `Trade Value` = sum(value)) %>% 
  mutate(PctExported = `Trade Value`/production_value) %>%
  ggplot(aes(x=period, y=PctExported,colour=crop)) +
  geom_line() + 
  labs(x="Year", y="Share of Harvest to China", 
       title="Share of Select Crop Harvests Exported to International Markets") + theme(plot.title=element_text(hjust=0.5,size=8), legend.position="none")

# plots to save for appendix

 brazil_china_monthlytradevalue_with_soy <- tradeDataLong %>% filter(partner=="China") %>%
  filter(!(fourDigitHS2017 == 1201)) %>%
  mutate(year = year + (month/12),.keep="unused") %>% 
  group_by(flow,year) %>% summarise(value = sum(valueNormalized)) %>%
  mutate(flow = case_when(as.character(flow) == "Exports" ~ "Brazil to China",
                          as.character(flow) == "Imports" ~ "China to Brazil"),
         .keep="unused") %>% 
  ggplot(aes(x=year,y=value,colour=flow)) +
  geom_point() + #geom_smooth(se=FALSE) +
  #geom_smooth(se=FALSE) + 
  labs(x = "Year", y = "Monthly Trade Value (Constant 1982 USD)",
       title = "Sino-Brazilian Monthly Trade Flows over Time, Except Soy") +
   theme(plot.title = element_text(hjust = 0.5))
 
 brazil_china_monthlytradevalue_no_soy <- tradeDataLong %>% filter(partner=="China") %>%
  mutate(year = year + (month/12),.keep="unused") %>% 
  group_by(flow,year) %>% summarise(value = sum(valueNormalized)) %>%
  mutate(flow = case_when(as.character(flow) == "Exports" ~ "Brazil to China",
                          as.character(flow) == "Imports" ~ "China to Brazil"),
         .keep="unused") %>% 
  ggplot(aes(x=year,y=value,colour=flow)) +
  geom_point() + #geom_smooth(se=FALSE) +
  labs(x = "Year", y = "Monthly Trade Value (Constant 1982 USD)",
       title = "Sino-Brazilian Monthly Trade Flows over Time") + 
  theme(plot.title = element_text(hjust = 0.5))
 
 RetailGrid1 <- varejoAnnual %>% ggplot(aes(x=year,y=varejoTotal)) +
  geom_point() +
     annotate("rect", xmin = 2014.5, xmax = 2016.5, ymin = 50, ymax = 100,
        alpha = .2) +
  labs(x = "Year", y = "Total Retail Sales Index (mid 2014 = 100)") +
  theme_bw()

GDPGrid2 <-BrazilGDP %>% mutate(year = as.double(as.character(fYear))) %>% 
  filter(year > 1999) %>% 
  ggplot(aes(x=year,y=BrazilGDP_PPP)) + 
  geom_point() +
     annotate("rect", xmin = 2014.5, xmax = 2016.5, ymin = 12000, ymax = 16000,
        alpha = .2) +
  labs(x = "Year", y = "Brazilian GDP per Capita (PPP, US$)") +
  theme_bw()
# varejoGrowth %>% ggplot(aes(x=year,y=varejoTotalGROWTH)) + geom_point() + geom_smooth(se=FALSE)

BECstoAnalyze = c(2,4,6)
BECGrid3 <- PIM_PF_BEC %>% filter(BEC %in% BECstoAnalyze) %>%
  mutate(time=as.double(as.character(fYear))+(as.double(as.character(fMonth))/12)) %>% 
  mutate(Sector = as.factor(case_when(
    BEC == 2 ~ "Industrial Supplies",
    BEC == 4 ~ "Capital Goods",
    BEC == 6 ~ "Consumer Goods"
  ))) %>%
  ggplot(aes(x=time, y= PIM_PF_BECindexValue, colour=Sector, shape=Sector)) +
   geom_point() +
     annotate("rect", xmin = 2014.5, xmax = 2016.5, ymin = 0, ymax = 125,
        alpha = .2) +
  labs(x = "Year", y = "PIM-PF Output Index (mid 2012 = 100)") +
  theme_bw()


TradeGrid4 <-tradeDataLong %>%
  mutate(Flow = flow) %>%
  group_by(Flow,year) %>% summarise(total_trade = sum(valueNormalized)) %>%
  ggplot(aes(x=year,y=total_trade,colour=Flow)) +
  geom_point(se=FALSE) +
     annotate("rect", xmin = 2014.5, xmax = 2016.5, ymin = 0, ymax = 100000000000,
        alpha = .2) +
  labs(x = "Year", y = "Annual Trade Flows in Brazil (Constant 1982 US$)") +
  theme_bw()
```

# Abstract 

This study aims to measure the distributional effects on Brazil of engaging in trade with China. It seeks to do this through a fixed effects panel data model of sector level production in Brazil regressed on both import and export trade flows with 15 top partners. The model regresses Brazilian output across the UN’s Broad Economic Categories (BEC) and various agricultural and industrial commodities. It then regresses these outputs on export and import trade flows for the corresponding goods. The significance and sign of the fixed effect for China and the interaction term between the fixed effect for China are analyzed. Lags for the past two years of trade are included in the model. The findings reveal that trade flows with China have a significant and positive effect on the vast majority of sectors as defined by BEC. By contrast, after controlling for trade flows and domestic demand, the study found that the effect of the "China trade shock" on commodities production in Brazil is not significant. The study then granularly analyzes the trade data and domestic production data to investigate why this discrepancy exists.

# Introduction 

## Motivation

The entrance of the People’s Republic of China into the World Trade Organization in 2001 marked a paradigm shift for economies around the world. The effect for developed western countries such as the United States has been extensively researched, as in the widely cited 2016 study from Autor, Dorn and Hanson. However, one lesser studied aspect of this new trade paradigm is its impact on commodities exporters, such as Brazil. While China received less than 2% of Brazilian exports in 2000, by 2020 China was already the destination for 32.1% of Brazil’s `$`211 billion worth of exports, up from 28.3% of exports pre-pandemic in 2019. Concurrent with this massive increase in exports, imports from China in Brazil also exploded. In the year 2000, China accounted for 2.2% of imports in Brazil. By 2020, this share had grown eleven-fold to over 22%. All told, China claimed well over a quarter (27.6%) of Brazil’s over `$`385 billion dollars worth of trade in 2020. China’s share of Brazilian trade thus far surpasses the share of Brazil’s second largest second largest partner (the United States, at 13.8% of the total) and the third largest (Argentina, at 4.5% of the total, despite being another member of the South American Mercosur Free Trade Area). 

	
```{r brazil-tradepartners-time, cache = TRUE, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height = 5, out.width = "100%", fig.align='center', fig.cap = "Trade Volumes of Top Partners over Time"}
eda_trade_data %>% 
  filter(partner %in% countriesforgraph) %>%
  group_by(partner,year,flow) %>% summarise(annual_trade = sum(normalizedValue)) %>%
  mutate(Partner = as.factor(partner)) %>%
  ggplot(aes(x=year,y=annual_trade,colour=partner)) +
  scale_x_discrete(breaks = seq(1997, 2018, by = 5)) +
  geom_smooth(se=FALSE) +
  geom_point() + 
  facet_grid(~flow) +
  labs(x = "Year", y = "Annual Trade Value", title = "Trade Volumes of Top Partners over Time") + 
  theme(plot.title = element_text(hjust = 0.5))
```

The rise of China as such an important trade partner for Brazil has had many prima facie effects on its economy. First, while being a net importer in 2000, Brazil has emerged as an important export economy at the world level. This is especially visible in the agricultural sector, as, coming from being a net food importer at the turn of the century, Brazil has been transformed into an agricultural superpower, producing a third of the world’s supply of soy and a half of soy exports in 2019 (FAOSTAT). Moreover, this transformation as an export power is notable for other commodities, such as petroleum and iron. While crude petroleum represented only 0.34% of exports in 2000, exports have grown by over a factor of 125 (by value) to become 10.6% of total exports in 2019. A similar trend is seen with iron, with China being the principal destination for both, as well as a host of other commodity exports such as cotton, wood pulp, poultry, beef and pork. 

	
```{r brazil-china-exports-table, echo=FALSE,cache=TRUE}
# (Table Brazil top exports in 2020, share of total exports for each category, share of each export destined for China)
eda_trade_data %>% filter(flow == "Export") %>% filter(year==2020) %>%
  group_by(HS4Digit) %>% summarise(exports2020byHS4 = sum(value)) %>%
  inner_join((eda_trade_data %>% filter(flow == "Export") %>% filter(year==2020) %>%
                filter(partner=="China") %>%
                group_by(HS4Digit) %>% summarise(exports2020CHINAbyHS4 = sum(value))),
             by=c("HS4Digit"="HS4Digit")) %>% 
  mutate(shareOfTotalExports = exports2020byHS4/(yearlyExportsCurrent %>% filter(year==2020) %>% pull(yearlyExports)), 
         shareOfExportsToChina = exports2020CHINAbyHS4/exports2020byHS4) %>%
  left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  arrange(desc(exports2020byHS4)) %>% select(-exports2020byHS4,-exports2020CHINAbyHS4) %>%
  transmute(rank = row_number(), HS4Digit = HS4Digit, commodity = Description, shareTotal = shareOfTotalExports, shareToChina = shareOfExportsToChina) %>%
  head(20) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
        col.names = c("Rank", "Good (HS Code)", "Good (Description)", "Share of 2020 Brazilian Exports", "Share of Good Exports to China"),
        caption = "Top 2020 Brazilian Exports and Share of Exports of that Good Bound for China") %>%
  column_spec(c(1,2,4,5), width="1in") %>%
  kable_styling(position = "center",latex_options = "HOLD_position") 

```



On the import side, no one individual product clearly dominates China to Brazil trade flows. Regardless, in aggregate, Chinese imports are increasingly dominating the Brazilian market. Over 36% of Brazil’s 2020 imports of machines, as defined by Section XVI of the 2017 edition HS nomenclature, are sourced from China. In the year 2000, this figure was just 3%. Likewise, imports of Chinese textiles grew from 3.7% of Brazilian textiles imports to 59% in the same period. As of 2020, China has become one of the largest sources of plastics, scientific/industrial instruments, chemical products and vehicles/vehicle parts in Brazil. 

	
```{r brazil-china-imports-tables, echo=FALSE}
eda_trade_data %>% filter(flow == "Import") %>% filter(year==2020) %>%
  group_by(HSSection) %>% summarise(imports2020byHSSection = sum(value)) %>%
  inner_join((eda_trade_data %>% filter(flow == "Import") %>% filter(year==2020) %>%
                filter(partner=="China") %>%
                group_by(HSSection) %>% summarise(imports2020CHINAbyHSSection = sum(value))),
             by=c("HSSection"="HSSection")) %>% 
  mutate(shareOfTotalImports2020 = imports2020byHSSection/(yearlyImportsCurrent %>% filter(year==2020) %>% pull(yearlyImports)), 
         shareOfImportsFromChina2020 = imports2020CHINAbyHSSection/imports2020byHSSection) %>%
  # left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  arrange(desc(imports2020byHSSection)) %>% select(-imports2020byHSSection,-imports2020CHINAbyHSSection) %>%
  mutate(rank = row_number())  %>% # ***** this block to join the two tables ****
  left_join(eda_trade_data %>% filter(flow == "Import") %>% filter(year==2000) %>%
  group_by(HSSection) %>% summarise(imports2000byHSSection = sum(value)) %>%
  inner_join((eda_trade_data %>% filter(flow == "Import") %>% filter(year==2000) %>%
                filter(partner=="China") %>%
                group_by(HSSection) %>% summarise(imports2000CHINAbyHSSection = sum(value))),
             by=c("HSSection"="HSSection")) %>% 
  mutate(shareOfTotalImports2000 = imports2000byHSSection/(yearlyImportsCurrent %>% filter(year==2000) %>% pull(yearlyImports)), 
         shareOfImportsFromChina2000 = imports2000CHINAbyHSSection/imports2000byHSSection) %>%
  # left_join(HS4DigitToWords, by=c("HS4Digit"="HS4Digit")) %>%
  arrange(desc(imports2000byHSSection)) %>% select(-imports2000byHSSection,-imports2000CHINAbyHSSection) %>%
  mutate(rank = row_number())  
,
by=c("HSSection"="HSSection")) %>%
  transmute(HSSection = HSSection, shareTotal2000 = shareOfTotalImports2000, shareChineseImports2000 =shareOfImportsFromChina2000, shareTotal2020 = shareOfTotalImports2020, shareChineseImports2020 = shareOfImportsFromChina2020) %>%
  head(10) %>%
    kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
        col.names = c("Imports", "Share of 2000 Imports", "Share of 2000 Imports of Good From China",
                      "Share of 2020 Imports", "Share of 2020 Imports of Good from China"),
        caption = "Brazilian Imports Agreggated by HS Section in 2000, 2020 and Share of Imports of Commodity from China") %>%
  column_spec(2:5, width="1in") %>%
  kable_styling(position = "center",latex_options = "HOLD_position") 
```


Since the China-Brazil trade relationship began to shift in the 21st century, trade economists, Sinologists and other scholars began to note the marked differences between China to Brazil trade flows and those from Brazil to China. While Brazilian exports to China are overwhelmingly dominated by commodities, Brazil imports from China are vastly more varied and are disproportionately medium- to high-technology manufactured goods. In contrast to Brazil’s five largest exports to China (disaggregated at the four digit HS code level) - soybeans, iron ore, crude petroleum, frozen bovine meat and sulfate chemical woodpulp - China’s five largest exports to Brazil consist of cellphones, broadcasting equipment, semiconductors, special purpose ships and office machine parts. 

Furthermore, this extraordinarily high degree of specialization is not characteristic of Brazil’s trade with the rest of the world. The aforementioned top five Brazilian exports to China only represent 20.4% of Brazil’s exports to the rest of the world while they represent 84.7% of Brazil’s exports to China. Moreover, while the entire sections (as defined by the Harmonized System) of Machines, Instruments, Chemical Products and Transportation (vehicles) only represent 0.8% of Brazilian exports to China, they constitute 21% of Brazilian exports to the rest of the world. Argentina, Mexico, the United States, Chile and several other countries of the Americas have a notable demand for Brazilian vehicles and machines. 
	
```{r treemaps, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE,fig.height = 4, out.width = "100%", fig.align='center', fig.cap = "Exports from Brazil to China"}
treemap(
    treemap_topexportstoChinaDTF %>%
      mutate(HSSectionModified = case_when(
        as.character(HSSection) == "Vegetable Products" ~ "Soybeans",
        TRUE ~ as.character(HSSection)
      )),
    index = c("HSSectionModified", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazilian Exports to China"
  )
```

```{r treemaps2, echo=FALSE,cache=TRUE,message=FALSE, warning=FALSE,fig.height = 4, out.width = "100%", fig.align='center', fig.cap = "Exports from Brazil to Rest of World"}
treemap(
    topexportstoWorldexChinaDTF,
    index = c("HSSection", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazilian Exports to Rest of World"
  )
```
```{r treemaps3, echo=FALSE,cache=TRUE,message=FALSE, warning=FALSE,fig.height = 4, out.width = "100%", fig.align='center', fig.cap = "Imports from China to Brazil"}
treemap(
    treemap_topimportsfromChinaDTF,
    index = c("HSSection", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazilian Imports from China"
  )
```
```{r treemaps4, echo=FALSE,cache=TRUE, message=FALSE, warning=FALSE, fig.height = 4, out.width = "100%", fig.align='center', fig.cap = "Imports From Rest of World to Brazil"}
treemap(
    treemap_topimportsfromChinaDTF,
    index = c("HSSection", "HS4DigitDescription"),
    vSize="trade_value",
    type="index",
    title="Brazilian Imports from Rest of World"
  )

```

Classical economists would argue that trade almost always stimulates economic growth, as it allows countries to specialize and thereby produce more value overall. However, many scholars have begun to argue that this new trade dynamic has insidious consequences for the Brazilian economy. As British economist Rhys Jenkins writes in his 2015 paper, there has been a "lively" debate in recent years as to whether or not this enormous trade dynamic with China has resulted in the "deindustrialization" of the Brazilian economy or the "reprimarization" of its exports [@jenkins2015chinese]. Brookings foreign policy expert Harold Trinkunas argues in his 2020 article that the Brazilian manufacturing sector has benefited immensely from very protectionist national politics, and as a result was unable to compete with the relatively less expensive Chinese imports [@trinkunas2020testing]. On the demand side, Sousa de Assis and Alves da Silva argue in their 2020 article published in Brazilian Journal of Development that strong Chinese demand for commodities has been a major factor pushing the "reprimarization" of Brazilian exports [@de2020reprimarizaccao].
	
These accusations are not without precedent. The data do show a relative "deindustrialization" of the Brazilian economy over the 21st century. While the United Nations Industrial Development Organization (UNIDO)  ranked Brazil’s economy as the 29th most competitive industrial economy in 1997, by 2018 Brazil had fallen to 40th place. Likewise, UNIDO’s "Industrialization Intensity Index" for Brazil fell by nearly a quarter over the same period, from 0.444 to 0.346.

```{r deindustrialization-graphs, cache = TRUE, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height = 5, out.width = "100%", fig.align='center', fig.cap = "UNIDO Industrialization Indicators for Brazil"}
BrazilCompetitiveIndustrialPerformanceIndex %>% 
  filter(Indicator %in% c("Competitive Industrial Performance Score","Share of world MVA index","MVA per capita index", "Manufacturing Value Added share in total GDP")) %>%
  pivot_longer(cols = `1995`:`2018`, names_to = "year", values_to="value") %>%
  select(year, Indicator, value) %>%
  mutate(time_index = as.double(year) - 1994) %>%
  ggplot(aes(colour=Indicator,fill=Indicator)) + 
  geom_point(aes(x=year,y=value)) + geom_smooth(aes(x=time_index,y=value), se=FALSE) +
  scale_x_discrete(breaks = seq(1997, 2018, by = 5)) +
  labs(x = "Year", y = "Indicator Value") + 
  theme_bw()

```

Jenkins concludes his analysis of Brazilian "deindustrialization" that it was relative rather than absolute, but that does not offer a decisive verdict on what effect, if any, trade with China has had on the development of the Brazilian economy [@jenkins2015chinese]. Papers by Blazquéz-Lidoy, Rodríguez and Santiso and Araújo, Vitório, Lima and de Arruda have argued that Sino-Brazilian trade has resulted in a major specialization of the Brazilian economy and concentration of production in a handful of sectors [@dos2012emergence] [@de2020importancia]. Is there a more nuanced and detailed statement that one can make about the overall distributional effects Sino-Brazilian trade has had across Brazilian industries? Many scholars claim that Chinese demand has induced the growth of low-value added commodities industries and many other (or often the same) scholars conclude that cheap Chinese competition has acutely challenged the Brazilian manufacturing industry. Can one pinpoint exactly which sectors, granularly defined, have benefited from trade with China and which have suffered? If such sectors can be identified precisely, can one quantify exactly how much the "China trade shock" has affected their growth and development (or lack thereof)?




## Articulation of Objective

This paper seeks to better understand the distributional effects of the "China shock" across Brazilian industries. More specifically, it hopes to identify and quantify how trade with China has reallocated economic output in Brazil. This "reallocation" of output will be evaluated across broad economic sectors (as defined by the United Nations Statistics Division’s BEC categorization system) and across the production of various key commodities. 

First, this paper will test the hypothesis of whether or not trading with China in a certain good has a unique effect on the growth of each Brazilian industry or output of a given commodity. In other words, this study will test whether or not Brazil choosing to engage in trade (of both directions) with China will have a different effect on the size of the corresponding domestic sector than if Brazil engaged in trade of the same good with a different (unspecified) partner.  If this effect (for an individual trade good/industry pairing) is significant, this paper will analyze the sign and magnitude of this discrepancy.

Second, this paper will assess how Chinese trade *as a whole* has influenced the growth and output of various sectors/commodities in Brazil. While the previous section analyzed the effect of trade in one good, this section will look at how the volume, product mix and directions of the trade with China collectively has influenced the growth and output of the aforementioned economic sectors and commodities. This section asks whether or not Chinese trade collectively leads to the growth or shrinking of a particular industry in Brazil. Like before, if the relationship between Chinese trade and the output of a particular sector is found to be significant, this study will analyze the sign and magnitude of this observed effect. 

## Empirical Approach

This study analyzes the heterogeneous impact of the China shock by looking at its effect on different sectors individually. To quantify the output in any given period (defined for every month between January 2002 and December 2021) this study first looks at output indices corresponding to 16 different sectors from the (Brazilian Monthly Industrial Survey) [Brazilian Monthly Industrial Production (IBGE/PIM-PF)] and later at various output metrics for 10 agricultural commodities and 5 industrial commodities. 

For each sector/commodity, the study generates various models. For each measurement metric of a dependent variable, one model was generated using OLS and one model was generated with a panel regression through the `plm` package. The OLS model is advantageous because it allowed me to manually add time dummies to best control for the time trend, while the benefit of the panel regression is that it creates cluster standard errors, which reduces the risk that the standard errors are invalid if there is heteroscedasticity across clusters.

Each sector/commodity was paired up with a set of trade goods. Fortunately, as one of the criteria the Monthly Industrial Survey (PIM-PF) used to report its findings had a one-to-one correspondence with the United Nations Statistics Division’s Broad Economic Categories (BEC) system, the trade goods chosen for the regression were those from the corresponding BEC. For the 15 commodities analyzed, the good (or potentially goods, if there were multiple) included in the model was chosen according to the Harmonized System (HS), disaggregated to the four-digit level. 

Each model regressed output of each sector of commodity on trade flows of the chosen good, an interaction between the trade flows and a dummy, a fixed effect for China and several controls. In the `lm` model, the fixed effect capturing the "China effect" was a dummy equal to 1 if a trade flow came from China and 0 otherwise. For the `plm` panel regression model, the fixed effect for China used in the analysis is the default individual fixed effect for each country in the data. This data set uses trade data between Brazil and Brazil’s top 15 trade partners, so each of the 15 countries gets a fixed effect through the `plm` model. For the OLS models with monthly data, the time trend is controlled for with yearly and seasonal (monthly) dummies. Multicollinearity concerns wouldn’t allow the `plm` models with time dummies (added manually or added through the package), so for the panel regressions, the response variables are detrended on the time dummies and the residuals are then used in the coefficient estimation. For the commodities without annual data, principally the agricultural commodities, a polynomial trend was used to control for time. 

For every model computed, the coefficients on the China fixed effect and the interaction term between the China dummy and the different trade flows are analyzed. If the coefficient on one of the interaction terms results significant, the study concludes that there is a differentiated effect on output of the analyzed industry/commodity when Brazil engages in that form of trade (import or export) with China. The difference is understood to be relative to the case when the dummy evaluates to 0, i.e. when Brazil engages in the same kind of trade in the same kind of good with a different partner. 	If the coefficient on the China fixed effect results significant, the study concludes that overall trade with China (trade *as a whole*, as this paper will repeatedly phrase it) has an effect on the output of the sector in the given regression. The study then interprets the signs and magnitudes of the significant coefficients of interest: those on the interaction term and on the fixed effect representing China. 

Finally, as a robustness check, the study recalculates all of the models computed (32 different models in total) nine different times, each iteration swapping out the China dummies for dummies representing a different country of Brazil’s top ten trade partners. 


## Value Added to the Literature

First, it is a temporal update of the literature that exists. Many of the studies that have analyzed the trade relationship between China and Brazil are over a decade old and, considering how fast the economies of these two emerging economies are evolving, these studies’ conclusions may already be outdated. 

Second, while many papers have tried to analyze the net effect of trade with China on Brazil by using aggregate statistics such as GDP, this study provides a much more nuanced perspective that looks at the Brazilian economy heterogeneously. This investigation seeks to identify the "winners" and "losers" of such trade (for the sectors where the trade shock appears to be significant) and quantify the effect that Sino-Brazilian trade has had on each. Beyond that, this study brings together various different time series on domestic output in Brazil from various different statistical agencies to help measure and assess the effect of this "shock". This diversity of data not only allows the study to assess the distributional effects of the China trade across various different dimensions, but it also serves to add a degree of robustness to the study’s findings. 

Third, by comparing the effect of trade with China, whether as a whole or in a certain good specifically, against trade from a non-specified partner, this study helps isolate the "China shock" that is specific to China, rather than calculating effects which are relative to a basket of other partners chosen for the study. 

Fourth, by drawing the direct correspondences between various trade goods and different economic sectors/commodities in Brazil, this study’s methodology helps ensure that the trade regressors used have a very direct impact on the dependent variable (output in the corresponding sector).

Lastly, this study’s methodology adds several robustness checks and safeguards that several other methodologies lack. This study’s use of the `plm` package allows for heteroscedasticity across different clusters (trade partners) and therefore has less risk of calculating invalid standard errors. By using a series of indices measuring sales in various segments of the retail industry in Brazil, this model helps control for the potentially endogenous variable of demand. In addition, the diversity of approaches to control for the time trend (detrending and using time dummies), the standardization of trade values to constant 1982 dollars, the variety of metrics used to assess the output of the various commodities, and most importantly the final comparison of the results obtained to the model results for the other nine top ten trade partners all add a certain degree of robustness to this study’s findings.

## Roadmap

First, this paper begins with a review of the literature on this topic. The literature review groups the existing literature into three broad categories. Second, this paper explains in detail this study’s economic model. This section outlines the general model, the different specifications of it used, the fixed effects and interactions which were interpreted, and the various personalizations to each regression in this study. Third, this paper discusses the data used. This section explains what metrics the data use, how the data were obtained, the advantages and limitations of using this data, and the constituent variables. Fourth, the paper presents the study’s findings and interprets some conclusions of interest. This section begins with an assessment of the unique effect trading in a certain good with China may have, then analyzes how the China trade shock as a whole has influenced the growth and decline of output of various sectors across Brazil, subsequently repeats the analysis with lagged trade data to understand the relationship between previous trade and future output and finally repeats the study on the other nine of Brazil’s top ten trade partners as a robustness check. Finally, the paper presents a conclusion with the main takeaways from this study and the avenues for future research.


# Literature Review

The literature shows that the aspects/ways in which the "China shock" has affected Brazil through trade are both enormously diverse as well as profound. Costa, Garred and Pessoa (2016) [@costa2016winners] even characterize the impact on Brazil as the "two China shocks", referring to China both as a consumer of Brazilian exporters and as a competitor for Brazilian industry. However, from studies like Fernanda De Negri’s 2005[@de2005perfil] paper on China’s heterogeneous effect on Brazilian firms of different productivities, as well as the myriad articles focusing on China’s effect through FDI, politics and other channels, a growing literature suggests that the "two shocks" characterization is perhaps too simple to understand the complexities of the effects of the new Sino-centric trade regime. 

While several papers argue in the binary sense whether the rise of China was "good" or "bad" for Brazil, even the most simplified articles will recognize that distributional effects mean that their generalization is extraordinarily limited in its descriptive power. Though this study takes a very different methodology, several of the cited papers provide a good foundation to understand the distirbutional effects of the China trade shock.

This literature review is organized into three sections. The first describes articles that attempt to understand the "China shock"’s aggregate effect on Brazilian output. The second looks into China’s effect on wages and other metrics of Brazilian worker welfare. The last section analyzes articles focused on the reorganization of resources domestically in Brazil in response to Chinese trade. Though articles may be slotted into one of these sections, that does not at all mean that the article only considers that aspect of the Sino-Brazilian trade relationship. Moreover, the categorization of these articles’ main goals as one of the above categories is much more of a subjective art than an objective one. In short, the schema is only one of many ways to organize the articles that constitute the corpus of literature on this topic.

## Aggregate Output

Frank, Lélis Caputi, Carvalho and Iglesias’s recently published 2021 paper in Emerging Markets Finance & Trade utilizes a generalized method of moments methodology to explore how Chinese exports have influenced Brazilian and Mexican exports to their top 52 export partners. With a two-stage dynamic panel data model they hope to account for the hysteresis in trade models, as well as the endogeneity of GDP growth of constituent economies affecting exports. Frank, Lélis Caputi, Carvalho and Iglesias interestingly found a positive correlation between Chinese exports of a certain category of product (as determined by Guerrieri’s 1998 adaptation of Pavitt’s 1984 taxonomy). For a 1% increase in Chinese exports of a certain type to a given country, Brazilian exports were purported to increase 0.1%. However, despite the positive correlation, the authors acknowledged that this discrepancy implied a long-run decrease in market share for Brazil as Chinese exports increased. Furthermore, given the quadratic nature of their model, Frank, Lélis Caputi, Carvalho and Iglesias noted that Chinese exports did appear to substitute Brazilian and Mexican exports up until a certain absolute value of Chinese exports was reached [@franke2021impact].

Jenkins and de Freitas Barbosa (2012) stand out in the literature for taking an internal look at the Brazilian market. Utilizing Nassif’s 2008 classification scheme, they look at Chinese penetration in the Brazilian market and claim that, in fact, Chinese imports have much more displaced imports from other countries rather than displaced production for the domestic market. Jenkins and de Freitas Barbosa point out that only a small fraction of Brazilian manufacturing gets exported, so, while China may be displacing Brazilian exports in foreign markets, the claim that China is provoking "deindustrialization" in Brazil is exaggerated. Furthermore, the authors pointed out that the scope of the China shock is potentially broader than expected, as Chinese firms have rapidly entered many different sectors of the Brazilian economy beyond manufacturing, especially textiles and medium- to high-tech and knowledge-driven industries [@jenkins2012fear].

Jenkins, one of the most published scholars in this field, further built on the above analysis in his 2015 paper Is Chinese Competition Causing Deindustrialization in Brazil published in Latin American Perspectives. Jenkins cites that although manufactured goods have constituted an increasingly small portion of Brazilian exports, that manufacturing value added peaked in 2008 and that manufacturing has decreased relative to other components of GDP, he notes that manufacturing employment has continued to increase in Brazil. In short, Jenkins argues that the observed "deindustrialization" in Brazil is relative rather than absolute [@jenkins2015chinese].

In the Inter-american Development Bank’s working paper China and India’s challenge for Latin America: Opportunity or Threat? in the eponymous book, Olarreaga, Perry and Lederman find that China, even more so than India, has an enormously high demand elasticity for Latin American products. Regardless of the model formulation the authors employed, through a subnational-level analysis, they found that China consumed a substantially larger portion of Latin American products as GDP increased. However, the authors note that their analysis is potentially biased as Brazil was not included in their regressions. Brazil’s inclusion, though, they state, would most likely only offer further support for their conclusions [@lederman2008china].

Yulin Hou’s 2019 study Latin American Growth and Exports to China, published in International Economic Journal, finds that the Latin American countries (such as Brazil) that have restructured to increase exports to China have experienced much more economic growth in the long run. She divides LAC countries into two main clusters, the "Brazil" cluster which engaged in large-scale trade with China and the "Mexico" cluster which did not. First, looking at cluster identity as a binary treatment, secondly looking at the Chinese demand shock as a continuous treatment and employing a difference-in-differences methodology and lastly relying on each country’s 2001 initial comparative advantage in a good times its 2001 level of trade with China as an instrument, Hou concludes that that increasing exports to China by 10% can increase economic growth in the long run by 1% per annum. The findings of this study were quite groundbreaking and the methodology robust, so the lack of citations may be indicative of the bias in this field of academia [@hou2019latin].

One of the most pessimistic attitudes towards the "China shock" was taken by Flora Cabranes Méndes, who found in her 2011 paper that not only did China displace Mexican exports 2004-2008, but that Chinese firms had created more competition overall. Cabranes Méndes observed that Chinese firms were steadily increasing their market share in various sectors, such as machinery and transportation, which Mexican firms had previously dominated. However, if there is any reason why scholars focused on Mexico may be more pessimistic about the China shock than those focused on Brazil, it may be that Brazil has taken much better advantage of the opportunity of China as a consumer than Mexico, as Hou (2019) observes. This distinction between Brazil and Mexico, though, somewhat contradicts the findings from Frank, Lélis Caputi, Carvalho and Iglesias (2021) which maintains that Brazilian manufactured exports have been more displaced in third markets by China than Mexico’s [@cabranes2011exportaciones].


## Worker Welfare

Costa, Garred and Pessoa’s 2016 extensive study on labor market, sector-level and region-level effects of the "two China shocks" on Brazil outlines many winners and losers of the trade paradigm in Brazil. First, echoing Jenkins’s (2015) analysis that manufacturing value added in Brazil has decreased since 2008 but that manufacturing employment has increased, Costa, Gerrad and Pessoa find that Chinese import competition negatively affects manufacturing wages in Brazil. However, at the regional level, the authors find that rising Chinese commodity demand is associated with increased wages and an increased share of the formal employment. Utilizing IV to control for potential confounders on supply and/or demand local to Brazil or world prices, the authors believe their data disaggregated to 412 IBGE Brazilian micro-regions is sufficient to support causality [@costa2016winners].

Lourenço Paz’s 2019 study published by the Interamerican Development Bank assesses the "China shock"’s effect on Brazilian workers using data from the household-, sector-, worker- and state level of disaggregation. Though the different models all had very diverse results, the authors’ view was generally more pessimistic than that of Costa Garred and Pessoa (2016), concluding that Chinese import penetration reduces the employment level, the share of the population employed and the hourly wage. However, in agreement with Costa, Garred and Pessoa, Paz found that Chinese import competition had a negative effect on informal employment, and, when using a geographic model (as did Costa, Garred and Pessoa), the initial negative effects on employment and wages were reversed after 2008. Moreover, as Paz later argued in more depth in his 2019 paper "Chinese imports’ impact on Brazil’s inter-industry wage premium" published in the Journal of Economic Studies, Paz concludes that Chinese import competition leads to a greater wage premium for educated workers [@paz2019impact].

In Autor, Dorn and Hanson’s (2013) widely cited paper in American Economic Review, the authors point out the potential decreases to worker welfare associated with an increase in Chinese import competition, though in the United States. In a geographic gravity model disaggregated to the level of the "commuter zone" (CZ), the authors find that CZ’s with manufacturing industries more exposed to Chinese competition observed reduced wages and a decline in manufacturing employment. However, ironically, the authors pointed out that their model argued that, in spite of the other negative effects, manufacturing wages remained unaffected by Chinese imports, potentially indicating that the competition only pushed out the least productive workers, leaving the most productive ones [@david2013china].


## Distributional Effects

Blazquéz-Lidoy, Rodríguez and Santiso, in a paper published in 2009 by the OECD, find that different sectors in Latin America have been clear winners and losers as a result of trade with China. Analyzing the the coefficient specialization (CS) and coefficient of conformity (CC) metrics for the 1998-2004 exports of 34 different countries, 15 of which are in Latin America, the authors identify that many Latin American countries specialize in the production of goods very complementary to the Chinese economy. Moreover, this study concludes that Latin America’s competitive advantage relies not in goods suitable for intra-industry trade, but rather in commodities and other natural resources, which implies that they need an economy like China’s to which they can export [@rodriguez2006angel].

Featured in the April 2020 Revista CEPAL (United Nations Economic Commission for Latin America and the Caribbean), de Araújo, Vitório, Lima and de Arruda find that trade with BRICS (of which the most important was China by far) has accentuated specialization in the northeast of Brazil. Utilizing metrics like Balassa’s Revealed Comparative Advantage Index and Lafay’s 1990 revision of it, the authors conduct an analysis similar to the one above and conclude that northeastern Brazil’s comparative advantage specifically lay in foods, tobacco, alcoholic beverages, paper and cellulose, plastics and rubber, textiles, footwear and leather goods. The study claimed that trade with BRICS didn’t affect the technological level of goods produced, though, echoing the OECD study, they found that the goods with a comparative advantage with a high level of intra-industry tradability were those not exported to China. The study believed that the comparative advantage of the listed goods was due to the relative endowments of the factors of production in the region [@de2020importancia].

Sponsored by Brazil’s national Institute of Applied Economic Research (IPEA) in 2005, Fernanda De Negri’s analysis of exports at the firm level concluded that Brazil’s inability to enter the high value-added manufacturing segment was not due to a lack of competitiveness of Brazilian firms. De Negri noted that Brazil had many firms exporting high value goods to most other advanced economies, showing that the country was capable of meeting the standards of the world market. Moreover, De Negri observed that the Brazilian firms that did export to China were larger, more productive and more innovative across nine different metrics, indicating that exports to China were consolidating benefits to the most productive firms in the economy [@de2005perfil].

Looking at soybean and soybean oil exports to China, Chen, Marchant and Muhammad found that Brazil, though the leading exporter of soy to China, was by far the most elastic supplier [@chen2012china].

Leveraging the BACI dataset created by Guillaume and Zignago in 2010, which assesses exports based on their quality and their level of technology, Dos Santos and Zignago echo Blazquéz-Lidoy, Rodríguez and Santiso, concluding that both China and Brazil specialized enormously from 1994-2007. The authors claim that the countries not only gained comparative advantage in the products in which they initially had it, but they also lost advantage in their uncompetitive sectors. However, diverging slightly from the aforementioned studies, Dos Santos and Zignago argue that trade with China not only helped Brazil gain comparative advantage in commodities, but that it also allowed Brazil to increase the quality of its goods and gain market share in the manufacture of a few high technology products [@gaulier2010baci].

## Summary

Current scholars on this topic do not so much disagree as much as they emphasize different components of the heterogeneity of the China shock on Brazil. In terms of the China shock’s effect on Brazilian output, the scholarship generally seems to agree that, although the China shock has resulted in a relative "deindustrialization" of Brazilian exports, the existence of China as a consumer and the strength of Brazil’s strong domestic economy mean that there may have more overall positive effects on output for Brazil. At the worker level, the rise of China may have decreased the welfare of manufacturing workers in Brazil, though it may have also increased employment in other sectors. Focusing on the redistribution of resources, as theory would argue, it’s clear that the Sino-Brazilian trade paradigm made both countries specialize, and though Brazil may have primarily specialized in commodities, said paradigm may open up few opportunities in other high technology sectors.

Looking at the scholarship metadata, it’s visible that articles on the "China shock"’s effect on Brazil seemed to proliferate around 2008-2011, a period which Barros de Castro (2008) described as the "return to mediocre results [which] coincided with the explicit affirmation of China as a leader among emerging economies" [@castro2008semi]. Moreover, the articles found in this literature review were disproportionately published by bodies like the United Nations Economic Commission for Latin America and the Caribbean, Organization for Economic Cooperation and Development, Interamerican Development Bank, showing that the interest in this topic is relatively higher in multilateral development institutions than in academia. This framing gives a little bit of color to the approach and agendas which the scholarship has in these papers. However, in the above cited paper, Blazquéz-Lidoy, Rodríguez and Santiso (2009) interestingly point out the limitations of this development economics approach as they cite the lack of development economists advising China during its economic rise, one of the biggest economic miracles in human history. "If Jeffrey Sachs advised Bolivia," the authors conclude, "he never reached Beijing, at least not with his advise." (Blazquéz-Lidoy, Rodríguez and Santiso, 2009) [@rodriguez2006angel].


# Economic Model

## General Model

At the highest level of abstraction, the model in this study can be written as 

$$
\text{output}_{i,time} = c_0 + \text{imp}_{hs/bec,time} + \text{exp}_{hs/bec,time} + \text{China} + \text{time} +\\ 
$$
$$
\text{imp}_{hs/bec,time}:\text{China} + \text{exp}_{hs/bec,time}:\text{China} + \text{controls} + \varepsilon
$$
The variables in the above model represent the following:

$\text{output}_{i,time}$ refers to the output of sector $i$ in the Brazilian economy at time $time$.  

$\text{imp}_{hs/bec,time}$ and $\text{exp}_{hs/bec,time}$ represent import and export trade flows. They are indexed by commodity and time. The commodity traded may be classified according to the Harmonized System (HS) or according to the UN's Broad Economic Categories (BEC), hence the subscript $hs/bec,time$. 

${partner}$ represents trade partner fixed effects. This is rendered as a vector of categorical dummies for each of the 15 trade partners minus 1 (which happened to be Argentina)

$\text{time}$ refers to time fixed effects. $\text{time}$ also appears in the subscript of this model's panel data, where it shows that this panel data is indexed by time.

${imp}_{hs/bec,time}:{China}$ and ${exp}_{hs/bec,time}:{China}$ represent the interaction between a categorical dummy for China and continuous import and export trade flows.

$hs/bec$ refer to a vector of trade goods chosen to correspond to the production on the left hand side of the regression call.

$c_0$ is an intercept, indicating that the variables in this model were regressed on a constant.

$\epsilon$ represents the noise in the data.

While the $i$ subscript in $output_i$ and the $hs/bec$ subscript in $\text{imp}_{hs/bec}$ and $\text{exp}_{hs/bec}$ are not the same, they have a one-to-one correspondence in the model. For each sector $i$, the model has a different vector of trade goods $hs/bec$. In an attempt to directly measure the impact of trade on Brazilian economic output, the trade goods are chosen to have the best correspondence with the Brazilian sector $i$. Occasionally this was made easy because of one-to-one correspondence between the BEC and Brazilian PIM-PF codes or the direct correlation of a certain commodity with an HS code, but occasionally more subjective methods had to be used to choose this vector of trade commodities. 

## OLS and PLM

For all model formulations, two models were computed. The first is an Ordinary Least Squares (OLS) regression using the `lm` package. The `lm` models are almost identical to the formula in [General Model]. The OLS models had both and time-invariant fixed effects and a fixed effect dummy for China. 

The second formulation is a panel regression sing the `plm` package. As useful as OLS is, it has the restriction of assuming homoscedasticity across all observations of the data. `plm`, by contrast, allows for cluster specific standard errors, with clusters in this case referring to different countries. In hopes that `plm` would generate models with valid standard errors if the errors are, in fact, hetereoscedastic across clusters, the study decided to build `plm` models in addition to the OLS ones.

Because of multicollinearity concerns, this `plm` package would not compute coefficients for the model with time-invariant fixed effects, whether they were added manually or whether they were specified through the implementation of the package. To remedy this problem, the study detrended the time series of response data before using it in coefficient estimation in each `plm` model. As is detailed below in [Time Fixed Effects], whether the response variable was regressed on yearly and monthly dummies or on a polynomial trend in this detrending process depends on whether the data were observed monthly or annually. This detrended series was then regressed on a model nearly identical to the formulation described in [General Model], except without time fixed effects. 

One potentially important distinction in the execution of these two sets of models is the number partner fixed effects. Because this study wanted to assess the "China shock" against the alternative (trade from other partners), the `lm` OLS models only included one dummy for China rather than a fixed effect for every country in the model. The panel regression `plm` model, by contrast, calculates a separate fixed effect for every one of the 15 countries in the data. Again, because of the package's use of cluster standard errors, the estimates for the fixed effects for each country in the data are more reliable through `plm` than they would be if they had been estimated through OLS.

## Time Fixed Effects

Fortunately, most of the response data (domestic output in Brazil of various sectors/products) was observed monthly. The trade data was observed monthly, as well, so this allowed for a more granular fit of the model. 

Where there was monthly data, the time fixed effects were fit through a series of yearly dummies and a series of monthly dummies. The study hoped this approach would control for seasonality concerns through the month dummies and trend concerns through the yearly dummies without overfitting the response variable (output). 

Where monthly output data was not available (as in the agricultural time series), the study used yearly data. With annual observations, the study could not use yearly and monthly dummies as it had before; yearly dummies would perfectly fit the response variable and render the rest of the model variables useless. To remedy this problem, the study used a polynomial time trend to control for temporal effects. Various models with a polynomial time trend showed that the terms tended to be significant until the sixth degree term, so for consistency, all series with annual data in this study were fit with a sixth degree polynomial of the time trend. 

## Lagged Trade Data

The models that included lagged values of trade are functionally very similar as the model presented in [General Model]. The only modification is that four lags, each representing the trade value six months prior to the previous lag, are included in the model. In total, this means that, in addition to the zeroth lag, there is a lag for exports and imports six months, one year, 18 months and two years prior. These lagged values of trade are of the same good as the dependent variable, just as in the model without lagged trade data. Only two years of lags are included because of the limitations of the trade data, as monthly observations of trade data for Brazil is only available from the year 2000 on. 

$$
\text{output}_{i,time} = c_0 + \Sigma_{h=0}^{4}{(\text{imp}_{hs/bec,time}^{\text{lag}\frac{h}{2}\text{years}} + \text{exp}_{hs/bec,time}^{\text{lag}\frac{h}{2}\text{years}})} + \text{China} + \text{time} + \\
$$
$$
\text{imp}_{hs/bec,time}^{\text{lag}\space0}:\text{China} + \text{exp}_{hs/bec,time}^{\text{lag}\space0}:\text{China} + \text{controls} + \varepsilon
$$

## Model Specification According to Response Variable

### Brazilian Monthly Industrial Production (IBGE/PIM-PF)

The one-to-one correspondence made choosing the trade goods to include in the IBGE/PIM-PF models easy. For more information on the correspondence between PIM-PF and BEC categories, please consult the [Annex].

All data in this category was observed monthly. In the OLS models, the time fixed effects were yearly and monthly dummies and for the `plm` models the response variable was detrended on yearly and monthly dummies. 

For controls, all models in this category used real per capita GDP in Brazil (PPP), as well as one or more relevant indices for retail sales. Both of these control variables were indexed by time, so there was an observation for each time period in the data. The retail sales variable(s) was (were) chosen to control for domestic demand as granularly as possible. This would mean that, for example, `BEC42 Capital goods parts and accessories` included retail sales of `vehicle parts and pieces` and `office IT and communication technology` as controls. For models which lacked such a clear retail indicator, such as `BEC62 Semi-durable consumer goods`, the model just included `total retail sales` as a control.

### Brazilian Annual Agricultural Production (IBGE/PAM)

This series was very important to analyze, as Brazilian agricultural production has increased very much with Chinese trade over the years. Unfortunately, this series presented problems because the variables were only observed annually rather than monthly. This is perhaps because harvests of any crop only occur during select months of the year, so monthly data would have extraordinarily extreme seasonsality. As mentioned before, as there were only annual observations, the model used a 6th degree polynomial trend for these models. 

The correspondence between the crop grown in Brazil in the various trade goods is less explicit, but this study rarely had to choose trade goods subjectively. Occasionally, as with cocoa, sugar cane and tobacco, the product had a direct connection with a two-digit HS section. Other times, this model had to look at several commodities categorized by the four-digit HS code in order to ensure all potentially relevant trades were included in the regression. 

For most agricultural products, output was measured through two different criteria: weight produced (measured in tons) and hectares harvested. For both potential response variables, the study calculated an OLS regression and detrended the response data, then calculating a `plm` model. This resulted in four models per agricultural goods. As expected, the detrending was done with a sixth degree polynomial time trend.

As a control, retail sales for hypermarkets and supermarkets were used in all agricultural models. GDP was not used. The exception was cotton, for which, in addition to the index on hypermarket and supermarket sales, the model used the index for sales of clothing and footwear. 

The model for soy became uniquely problematic because a multicollinearity issue arose when the interaction between the partner dummies and exports were included in the `plm` formulation. For that reason, the interaction was not computed, and rather the partner fixed effects and the coefficients on the trade itself were calculated separately. 

### Brazilian Monthly Livestock Slaughters (IBGE/Coagro)

Fortunately, this series had monthly data, for which it could use the time dummies as in [Brazilian Monthly Industrial Production (IBGE/PIM-PF)]. The trade goods are classified at the 4-digit HS code level. To control for demand, the model used the index on hypermarket and supermarket retail sales and the index on hypermarket food, beverage and tobacco sales. 

### Brazilian Fuels Production (ANP)

Monthly and yearly time dummies are employed. Trade goods are included, disaggregated at the 4-digit HS code level. To control for domestic demand, the index of retail sales of fuels and lubricants is used.  

### Brazilian Metals Production (IBS/IE)

This series also used monthly and yearly time dummies. As a control, only Brazilian GDP per capita is included; there are no retail sales indices in these models. Trade commodities are disaggregated at the 4-digit HS code level. The corresponding codes for crude steel and pig iron were quite clear; the Brazilian Steelworks Industry's description of "laminates" was not the most clear, and the study had to include a number of transformed steel commodities in this last model.

## Risks & Mitigations

One of the greatest potential sources of endogeneity in this model is the massive 2014 financial crisis in Brazil. After Brazilians were proudly weathered the United States’s 2008 financial crisis, Brazil suddenly found itself in a recession substantially worse beginning in mid-2014 in which the country didn’t see positive GDP growth until 2017. As expected, such a severe recession had massive impacts on consumption, trade flows and production in Brazil. 

```{r recession-graphs, echo=FALSE, cache=TRUE, fig.width = 9, fig.height = 8, out.width = "100%",warning=FALSE, fig.align='center', fig.cap = "Economic Activity Indicators (2014 Financial Crisis Highlighted)"}
# plot_grid of consumption (retail sales), production (BEC), international trade (imports and exports) and GDP per capita PPP
plot_grid(RetailGrid1, GDPGrid2, BECGrid3, TradeGrid4, nrow=2, ncol = 2)
```
This study’s models included  GDP per capita and retail sales to attempt to control for this effect. However, with such a massive shock to the Brazilian economy which affected all of the endogenous variables, there is always the question of whether or not these variables capture enough of the effect to truly "control" for the shock.

Second, endogeneity could also potentially result from issues regarding currency conversions and purchasing power parity. Trade values in the UN Comtrade data set are typically reported in nominal local currency (at the value of the time the trade is made), after which the UN Statistics Department adds the trade value to the database by converting the local currency to US dollars at the nominal exchange rate. Not only is there some uncertainty about the value of a past trade in present US dollars because of fluctuations in the exchange rate, but also there are issues resulting from the fact that the dollar values reported by the UN Statistics Department are in *current* US dollars (i.e. the value at the time of the transaction in nominal dollars) rather than *constant* US dollars (i.e. all of the dollar values are standardized to the value of a dollar at a given time). For this reason, I use the consumer price index from the St. Louis Federal Reserve bank to standardize the trade values to *constant* 1982 US dollars. Because of the steady inflation of the US dollar, failing to account for changing prices would bias the model to weight more heavily trade which occur in more recent years. Because trade with China disproportionately occurs in more recent years, this source of endogeneity could lead to enormous bias in the models. 

Third, selection of trade goods to include in the model presents a huge risk in the development of this model. If the models neglect to include the trade goods that truly impact output of the sector or commodity being evaluated in the model - or if some models include them and some models do not - coefficient estimates could be horribly biased. Since there are potentially extraordinarily complex relationships and dependencies between each output sector and each trade good (one could imagine that a given good is an intermediate good for the production of some other good which is a substitute/complement/is outright the dependent variable in the regression, among many other increasingly convoluted relationships) to ensure standardization across models, this methodology just pairs each sector/commodity as the dependent variable with trade flows the exact same good(s). This decision presents a risk of excluding potentially relevant regressors, but the study chose to include only this simplistic relationship to avoid some models being more biased than others. For the majority of Broad Economic Categories models, the choice of trade good was quite straightforward, as the PIM-PF sectors had a one-to-one correspondence with the UN Statistics Division’s Broad Economic Categories and many of the commodities directly corresponded to one (or a few) trade goods disaggregated at the four-digit level. However, for a small handful of models, such as the regression of the Brazilian Steelworks’s Industry’s broadly defined "laminates", the correspondence was not so clear, and several trade goods were chosen as regressors. This presents the risk of increasing the variance of the model, but the study thought that preferable to leaving out goods which appear to match the IBS’s definition of "laminates".

Even with the decision to only include the HS coded trade goods that directly correspond to the commodity in the dependent variable, the lack of a one-to-one correspondence between Brazilian Institute of Geography and Statistics commodity production data and HS coded trade goods (like there was between the PIM-PF and BEC systems) was a constant headache in the development of this methdology. As is discussed further, the As is discussed further in [How has Sino-Brazilian bilateral trade as a whole affected the growth of various Brazilian sectors?], the methodology potentially interpreted the commodities too broadly, resulting in the inclusion of irrelevant trade data regressors which increased the variance of the models. Conversely, it is entirely possible that the trade data regressors omitted part of the trade in the dependent variable commodity. 

Lastly, although fitting the time trend for the monthly variables was quite straightforward with year and seasonality dummies, the agricultural commodities’ output was only observed annually. The time trend could not be fit by the same technique in this instance, since, as there were annual readings of crop production, yearly dummies could have perfectly fit the response variable. In light of this, this study chose to fit the time trend with a polynomial trend. Unfortunately, perhaps because of the high variability of Brazilian crop production, the polynomial terms didn’t appear to fit the time trend as well as the yearly dummies. The consequences of these models’ inability to fully control for the time trend were seen through increased standard errors on the coefficient estimates in the agricultural models. The agricultural models were challenged by a shocking paucity of significant coefficients, regardless of whether they were on the trade flows, the controls, the fixed effects, the interaction terms, or even terms in the time trend polynomials themselves. This is even in spite of the fact that there was usually a very direct one-to-one correspondence between agricultural good and a 4-digit HS code, so it would be truly surprising if trade flows really had no effect on output. The one model which may have been potentially most surprising was that on soy. Considering the *enormity* of Chinese demand for Brazilian soy and the and the concurrent massive expansion in soy production, it is truly inconceivable that Sino-Brazilian trade has had no significant effect on Brazilian soy production. Potentially, in agriculture, yields and demand are very unpredictable, so concurrent trade flows have little effect on domestic output in the same period, so the models most likely should have tried lag terms on trade flows. This proposal would be an interesting direction for future research. Regardless, the problem still stands, that whether for a poor fit of the time trend or for the lack of lag terms in the regression, the coefficient estimates for this portion of the data were not incredibly interpretable.

For the models on metals and fuels output, there was a surprising lack of significant coefficients, as well. This challenge was in spite of the fact that these output trends in Brazil had monthly observations, which allowed for the same yearly and monthly dummies. Again, the overwhelming majority of the coefficients for trade flows of the equivalent goods, the China fixed effect, controls for demand, and the interaction terms were not significant. The time trend, however, did fit better. The difficulty with the petroleum models potentially lies in the metric used to measure output: average output per day, for which the relationship with trade flows may be less straightforward. Moreover, the model may suffer from the same issues as the agricultural models, which is that planning for the exploration and production of hydrocarbons may happen months or years in advance, for which reason concurrent demand may not be the best predictor of output. The metals models may also have been poor because the vast majority of Brazilian "metals" exports were not of transformed/refined metals, but rather of iron (and to a lesser extent, copper) *ores.* The indices used, by contrast, assess the quantity produced of transformed metals. Again, the indices used may have not been the best approximation of actual "output", for which reason the models were notably poor.

For the reasons mentioned above, this study concludes that the models for the PIM-PF are superior to those from the commodities data. Accordingly, the conclusions disproportionately rely on the findings from the Broad Economic Categories sector-level data. 



# Data

This model utilized data from a variety of different sources. Moreover, to ensure some continuity of units, several transformations and wranglings were used. The data used, their sources, and how they were used in this investigation are detailed below. 

```{r data-sources, cache=TRUE, eval=TRUE, echo=FALSE}
tribble(~data, ~source, ~detail,
        "Trade Data", "UN Comtrade", "Current US Dollars",
        "Brazilian Industrial Output", "Instituto Brasileiro de Geografia e Estadística - Pesquisa Industrial Mensal (IBGE/PIM)", "Index (Mid 2012 = 100)",
        "Brazilian Agricultural Production", "Instituto Brasileiro de Geografia e Estatística - Pesquisa Agrícola Municipal (IBGE/PAM)", "Tons Produced, Hectares Harvested",
        "Brazilian Livestock Output", "Instituto Brasileiro de Geografia e Estadística - Pesquisa Trimestral do Abate de Animais (IBGE/Coagro)", "Tons Slaughtered",
        "Brazilian Fuels Production", "Agência Nacional do Petróleo (ANP)", "Cubic Meters & Barrels per Day",
        "Brazilian Metals Production", "Instituto Brasileiro de Siderurgia - Informe Estatístico (IBS/IE)", "Tons Produced",
        "Brazilian Retail Sales", "Instituto Brasileiro de Geografia e Estadística - Pesquisa Mensal de Comérico (IBGE/PMC)", "Index (Mid 2014 = 100)",
        "Consumer Price Index", "Federal Reserve Bank of St. Louis (FRED)", "Index (Dec 1982 = 100)",
        "Brazilian GDP per Capita (PPP)", "World Bank - World Development Indicators", "Constant 2017 International USD"
        ) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Data",
                                      "Source",
                                      "Units"),
        caption = "Data Used") %>%
          column_spec(1, width = "1in") %>%
          column_spec(2, width = "3in") %>%
          column_spec(3, width = "1in") %>%
  kable_styling(position = "center",latex_options = "HOLD_position")
  
```


## Trade Data

The trade data used was sourced from the United Nations Comtrade International Trade Statistics Database. The trade data were classified according to the Harmonized System (HS), an internationally standardized system of names and numbers for trade products which is maintained by the World Customs Organization (WCO). The data were extracted from the database at the six-digit HS level of disaggregation, which allows for the most granular interpretation of the data.

In the analysis, the trade data were actually most frequently used at the four-digit level of aggregation, though occasionally they were used at the two- and six-digit level of aggregation, as well. The main reason this study extracted the data at the six-digit level of disaggregation was to facilitate the conversion of the Harmonized System (HS) codes to the United Nation's Broad Economic Categories (BEC) classification system. 

First, the HS codes were updated according to the most recent (2017) classification system. The World Customs Organization (WCO) publishes a new edition of HS nomenclature every five years, so a new (2022) version was published on January 1st, 2022. However, since the data used in this study covered the time period of January 2002 through December 2021, the only editions of HS nomenclature that had to be addressed were those of of the 2002, 2007, 2012 and 2017 editions. Based on the year a sum of trade data was reported, this study used the appropriate conversion table to transform the reported HS codes to those of the 2017 nomenclature. Because the revisions made to the HS nomenclature can be quite expansive, it can quite frequently occur that the there is not a one-to-one correspondence between HS codes, but rather a one-to-n, n-to-one or n-to-n correspondence. In the case that the reported HS code corresponded to more than one code from the 2017 edition, the trade value was reported multiple times in the updated data frame according to all of the 2017 correspondences. This is because the study sought to avoid a case in which a trade commodity which potentially could have impacted production of a certain product in Brazil wasn't accounted for in the final model, thus biasing the results.

Second, after all of the HS codes were updated according to the 2017 nomenclature, the trade values were standardized to 1982 dollars. Each each, United Nations members may report the value of their trade in current dollars, but most often, the trade gets reported in current local currency. In the latter case,  UN Trade Statistics converts the trade value to current US dollars for the UN Comtrade Database. For this reason, the fluctuating value of the US dollar is a factor which could potentially add a lot of bias to the model. Therefore, this study used the St. Louis Federal Reserve Bank's Consumer Price Index to standardize all trade values to December 1982 US dollars.

Finally, to ensure the best correspondence between Brazilian domestic production data and UN Comtrade trade data, this study converted all of the HS codes to Broad Economic Categories (BEC) codes. The Monthly Industry Survey (PIM) of the Brazilian Institute of Geography and Statistics (IBGE) reports production of physical goods (PF) according to various schema. The only internationally utilized schema is BEC, hence this study's reliance on BEC codes. The HS 2017 to BEC correspondence table, published by UN Trade Statistics, was used for this conversion. Since, like the correspondence among HS nomenclature editions, there are frequently scenarios in which one HS code corresponds to various BEC codes, each BEC correspondence for a given trade value was used in the final resulting data frame. 
  
The trade data used in this model is restricted both in time and in terms of trade partners, though not in goods; all over 5300 products identified in the Harmonized System (HS) at the six-digit level are included in the computation of these models. In terms of trade partners, only Brazil's top 15 trade partners are considered. The restriction on the number of countries (there are over 250 in the data set) helps control the variance on the country fixed effects coefficients. Moreover, while these top 15 trade partners represent only a few of the countries which which Brazil has engaged in trade, these countries account for over two-thirds of all trade value in this period. Furthermore, considering that these countries represent all continents except Australia and Antarctica, this study decided they had more than enough diversity against which to compare Chinese trade.

The time bounds on this study data were again chosen with China in mind. The "China trade shock" didn't begin in earnest until the 21st century and Sino-Brazilian trade volumes have almost uniformly increased over time in the period analyzed. Even after standardizing the dollar values to December 1982 dollars, the value of bilateral Sino-Brazilian trade in 2021 is over 11.5 times more than the value of bilateral Sino-Brazilian trade in 2002. (Without this standardization, the gap is a factor of over 18.5, again highlighting the importance of standardization to constant dollars).

```{r brazil-top-trade-partners, cache=TRUE, eval=TRUE, echo=FALSE, warning=FALSE}
eda_trade_data %>% 
  filter(year > 2001) %>%
  group_by(partner) %>% summarise(trade = signif(sum(normalizedValue),digits=4)) %>%
  arrange(desc(trade)) %>%
  transmute(rank = row_number(), partner=as.character(partner), trade=trade) %>%
  head(20) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
        col.names = c("Rank", "Partner", "Total Trade Value"),
        caption = "Top Brazilian Trade Partners by Total 2002-2020 Trade Value (Constant 1982 USD)") %>%
  column_spec(1, width="2in") %>%
  column_spec(2, width="2in") %>%
  column_spec(3, width="2in") %>%
  kable_styling(position = "center",latex_options = "HOLD_position")

  
```


## Brazilian Domestic Production

Unfortunately, the data on domestic production of goods in Brazil was not all available in the same place. This study had to source the data from various different Brazilian statistical agencies/surveys and wrangle and synthesize it. 

The study analyzed production of the following goods.

```{r br-domestic-production-tibble, cache=TRUE, eval=TRUE, echo=FALSE}
bec_series = c("BEC111 Primary food and beverages, mainly for industry", "BEC121 Processed food and beverages, mainly for industry", "BEC122 Processed food and beverages, mainly for household consumption", "BEC21 Primary industrial supplies nes", "BEC22 Processed industrial supplies nes", "BEC31 Primary fuels and lubricants", "BEC222 Processed fuels and lubricants, other than motor spirit", "BEC41 Capital goods (except transport equipment)", "BEC42 Capital goods parts and accessories", "BEC51 Passenger motor cars", "BEC522 Other non-industrial transport equipment", "BEC53 Transport equipment parts and accessories", "BEC61 Durable consumer goods", "BEC62 Semi-durable consumer goods", "BEC63 Non-durable consumer goods", "BEC7 Goods not elsewhere specified")
agropecuario_series = c("Chickens", "Pigs", "Cows", "Cotton", "Coffee", "Sugarcane", "Corn", "Soy", "Cacau", "Tobacco", "Wheat")
metals_fuels_series = c("Petroleum", "Natural gas", "Crude steel", "Pig iron", "Laminates")
tibble(series = c(bec_series, agropecuario_series, metals_fuels_series),
        units = c(rep("index (mid-2012 = 100)",length(bec_series)),
                  rep("tons slaughtered", 3),
                  rep("tons harvested, area harvested", length(agropecuario_series)-3),
                  "Avg Barrels/Day", "Cubic Meters", rep("Index (mid-2014 = 100)", 3)),
        fuente = c(rep("IBGE/PIM-PF",length(bec_series)),
                   rep("IBGE/Coagro",3),
                   rep("IBGE/PAM",length(agropecuario_series)-3),
                   rep("ANP",2),
                   rep("IBS/IE",3))) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Series",
                                      "Units",
                                      "Source"),
        caption = "Domestic Production Series Used in Analysis") %>%
  column_spec(1, width="2.5in") %>%
  column_spec(2:3, width="1.5in") %>%
  kable_styling(position = "center",latex_options = "HOLD_position") 

```

### Brazilian Monthly Industrial Production (IBGE/PIM-PF)

Perhaps the most used Brazilian production data was that of the IBGE's Brazilian Monthly Industrial Production - Physical Production (PIM-PF) survey. The PIM-PF reports production across all of Brazilian industry, so it was quite relevant for this study. Moreover, as one of the categorization systems employed was the international BEC system, PIM-PF made mapping the correspondence between the trade data and industrial production in Brazil quite easy. 

PIM-PF reports output figures in various ways, but the results from BEC categorized tables use an index. There were two overlapping production time series, of which this study utilized the newer one, which runs from January 2002 to December 2021. This time series used the average production level in 2012 as the base reference for the index (i.e. average 2012 production = 100%). This study used deseasonalized figures. 

### Brazilian Annual Agricultural Production (IBGE/PAM)

Largely because of the annual cyclicity of agricultural harvests, the data for production of agricultural goods is reported annually, rather than monthly like the other time series in this data. This presents several risks, for which this study's mitigation strategies are presented in [Time Fixed Effects]. Production is reported using various methods, but production was analyzed through tons of each agricultural commodity produced, as well as hectares harvested for each good. 

The PAM has yet to release data for the year 2021, so this data is restricted to just a period of 19 years, beginning in January 2002 (restricted by the dates of the trade data from [Trade Data]) and ending in December 2020. 

### Brazilian Monthly Livestock Slaughters (IBGE/Coagro)

Jointly developed by IBGE and Cooperativa Agroindustrial (Coagro), this time series data measures output of various meats (pork, poultry and beef) through tons of the animal slaughtered each month. This study used deseasonalized figures. 

### Brazilian Fuels Production (ANP)

Monthly fuel production data is taken from National Petroleum Agency data. The ANP data measures petroleum production in barrels per day (the median value for a given month) and natural gas production in cubic meters (accumulated over a month).

### Brazilian Metals Production (IBS/IE)

The Brazilian Steelworks Institute's monthly data on metals production is reported in tons. Unfortunately for this study, the data measures output of transformed metals (crude steel, pig iron and laminates), rather than extraction of metal ores from Brazilian mines. 

## Control Variables and Others

### Brazilian Retail Sales (IBGE/PMC)

In earlier fits of my model, the coefficient on imports was counterintuitively frequently significant and positive. In other words, the models picked up a positive correlation between imports of a good and domestic production of the same, even when controlling for the time trend. Since this defies conventional logic, this study decided to include another variable in the model to control for the omitted variable of domestic demand. 

Retail sales, especially when observed at further levels of disaggregation, provided a good instrument to measure demand for a given good. The Brazilian Monthly Commerce Survey (PMC) reports sales in each segment on an index with respect to mid-2014 (i.e. mid 2014 = 100). This study used deseasonalized figures. The segments used were `Total Retail`, `Pharmaceuticals, Cosmetics & Perfumes`, `Books, Magazines and Newspapers`, `Office-IT & Communication Technology`, `Other Articles for Personal and Domestic Use`, `Fuels and Lubricants`, `Hypermarkets: Food, Beverages and Tobacco`, `Hypermarkets & Supermarkets`, `Fabrics, Clothing and Footwear`, `Furtniture and Appliances`, `Vehicles, Motorcycles, and Parts and Pieces Thereof`. 

### US Dollar Consumer Price Index (St. Louis FRED)

To normalize prices from current dollars to constant dollars, this study used the St. Louis Federal Reserve Bank's Consumer Price Index (CIP) series. This series took the CPI for December 1982 as 100, so the time series was used to normalize the values of all sums of trade to constant 1982 US dollars. 

### GDP per Capita (World Bank) 

A secondary series which was used to approximate domestic demand for various goods, Brazilian GDP per capita was obtained from the World Bank Development Indicators. Purchasing parity power (PPP) values were used rather than nominal values because the study hypothesizes that consumer behavior is influenced more by the amount of disposable income they have, rather than the nominal value of their income. 




# Findings

## Does Brazil trading in a given good with China have a different effect than when it trades in the same good with other countries?

This section will analyze the effect trade with China in a given good has relative to other countries trading in the same. As was detailed before in [Economic Model], this study attempts to measure/evaluate this effect by examining the interaction between the continuous variables representing various trade flows and the binary dummy representing China. If significant, this interaction would suggest that, when the dummy evaluates 1 (i.e. when China is trading in this good) the effect on the dependent variable is significantly different from when the dummy evaluates to 0 (i.e. when trade of the same quantity comes from a partner other than China). 

```{r BEC-interactions-tibble, echo=FALSE}
interactionTermsTibbleBEC %>%
  head(32) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Economic Sector",
                                      "Trade Flow",
                                      "Model Type",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "Coefficients on Interaction Terms between Trade Flows and China Dummy, Economic Sectors") %>%
  column_spec(1, width="2in") %>%
  column_spec(c(2,3,7), width="0.4in") %>%
  column_spec(4:5, width="0.6in") %>%
  #column_spec(6, width="0.5in") %>%
  kable_styling(font_size = 8) %>%
  kable_styling(position = "center",latex_options = "HOLD_position") 
```

```{r BEC-interactions-tibble2, echo=FALSE}
interactionTermsTibbleBEC %>%
  slice(33:64) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Economic Sector",
                                      "Trade Flow",
                                      "Model Type",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "Coefficients on Interaction Terms between Trade Flows and China Dummy, Economic Sectors (cont.)") %>%
  column_spec(1, width="2in") %>%
  column_spec(c(2,3,7), width="0.4in") %>%
  column_spec(4:5, width="0.6in") %>%
  #column_spec(6, width="0.5in") %>%
  kable_styling(font_size = 8) %>%
  kable_styling(position = "center",latex_options = "HOLD_position") 
```

Tallying up all of the observed effects, one sees that 2 of the coefficients on imports are positive, 3 of the coefficients on exports are positive, 12 of the coefficients on imports are negative and 8 of the coefficients on exports are negative. The negative coefficients outnumber the positive ones, suggesting that, *in general*, Brazil does not stimulate the growth of its various industries as much as it does with other partners when it engages in trade with China. 

Looking more granuarly at the results, this study finds that different industries/products respond very differently to the China trade shock. According to Table \@ref(tab:BEC-interactions-tibble), the interaction terms with the largest absolute coefficients are those of imports of `BEC 111 Primary foods and beverages, mainly for industry` and exports of `BEC 522 Other non-industrial transport equipment`. Moreover, it is interesting that the coefficients on the interaction terms of these two trade flows are positive, indicating that when Chinese trade induces a uniquely positive effect on the growth of an industry relative to trade from other partners, the effect is larger in magnitude than when Chinese trade uniquely hinders the growth of a Brazilian industry. 

The coefficient on the interaction of exports of `BEC 522 Other non-industrial transport equipment` with the China dummy makes sense intuitively. Vehicles are a product that requires a lot of sophistication and advanced technology to manufacture successfully. So if Brazilian vehicles can compete in export markets, especially export markets as difficult to enter as those in China, it would make sense that the industry is concurrently growing and developing in Brazil. Moreover, since this interaction term represents the differentiated effect on the industry relative to other trade partners, one can see that in other countries to which Brazil exports vehicles - principally Argentina - competition in the auto industry may not be as intense (both from domestic players and from foreign imports). For this reason, a growth in vehicle exports to Argentina may not be associated with as strong a trend of a growth in the auto industry in Brazil. 

The fact that the interaction on imports of `BEC 111 Primary foods and beverages, mainly for industry` and the China dummy is positive and significant (and of a large magnitude) is quite interesting. Traditional logic would argue that imports of any product would hinder growth of the domestic industry that produces said good. However, this interaction term does not imply anything about the relationship between imports of food and the growth of the food production industry in Brazil; rather, the coefficient has to be interpreted as the effect relative to imports of the same good from other trade partners. (Though the coefficient on imports of BEC 111 in both the `lm` and `plm` models is positive and significant while neither of the control variables are significant, suggesting the model did not control well for the potentially endogenous variable of demand) One potential interpretation of this result is that BEC 111 imports from China are generally low-value products, so a marked increase in imports of BEC 111 from China would be associated with a specialization of the Brazilian food production industry in high value-added goods, which could be read as an increase in output. Regardless, the fact that both the `plm` and `lm` models agree on the (uniquely large) magnitude, significance and sign of the coefficient on the interaction between imports of `BEC 111 Primary foods and beverages, mainly for industry` and exports of `BEC 522 Other non-industrial transport equipment` with the China dummy suggests that the findings are generally reliable. 

Another interesting insight from this section is that the significant and negative coefficient on the interaction between trade in (both imports and exports of) `BEC 31 Primary fuels and lubricants` with the China dummy. The agreement of the `lm` and `plm` models on the significance, sign and order of magnitude of all of these coefficients indicates that the findings are robust. This finding is counter intuitive, since exports of crude petroleum (a primary fuel) to China have exploded as trade between Brazil and China has grown. However, the negative sign on all of these coefficients means that exports of petroleum to China don't grow the Brazilian petroleum industry more than exports of petroleum to other partners. These findings indicate that the growth of the Brazilian petroleum industry (see Figure \@ref(fig:fuels-sector-output)) is not due to a unique effect from trade with China, but rather just the effect of exports in themselves (and potentially a demand shock in the Brazilian economy, though this needs more investigation).

The interaction term of `BEC 41 Capital goods (except transport equipment)` and the China dummy shows that imports of this category from China aren't as associated with an expansion of this sector domestically as imports from other countries. "Expansion" is a precise choice of wording, because the coefficient on imports of BEC 41 is significant and positive in both the `lm` and `plm` models. This positive correlation still exists even after including controls for demand, `Office-IT & Communication Technology` and Brazilian GDP per capita. Both control variables are significant at the 0.001 level in both the `lm` and `plm` models. This positive correlation between imports of capital goods and an expansion of the production in capital goods, though, makes sense intuitively, since capital goods, by definition, will be employed to produce other goods. Among the goods capital goods produce are capital goods. 

When scholars write about the "deindustrialization" or "reprimarization" of Brazil through the trade with China, one of the factors that is explored is the effect of Chinese imports of consumer goods on production of those goods domestically in Brazil. Main scholars believe that, because consumer goods from China are uniquely cost competitive through manufacturing efficiency, network effects, and a devalued Chinese renminbi, Brazilian firms cannot compete in the manufacture of these goods. Table \@ref(tab:BEC-interactions-tibble) seems to support these conclusions, as the coefficients on the interaction of imports of `BEC 61 Durable consumer goods` and `BEC 62 Semi-durable consumer goods` with the China dummy are significant and negative. This implies that imports of durable and semi-durable consumer goods from China to not stimulate the growth of the corresponding sectors as much as imports from other partners, potentially indicating a replacement of Brazilian production because of  attributes that are unique to the CHinese products. This language is precise, as well, saying "not stimulate the growth of the corresponding sectors as much" because, even after adding controls to the regression, the coefficient on imports of BEC 61 and BEC 62 in both the `lm` and `plm` models is significant. The controls added are `Total Retail Sales` and Brazilian GDP per capita. Both controls are significant at the 0.01 or 0.001 levels in all of the models considered. 

Finally, one interesting conclusion from Table \@ref(tab:BEC-interactions-tibble) is that there doesn't appear to be a marked difference in the effects between imports and exports, at least relative to other trade partners. In other words, it would be an interesting supposition to say that Brazilian industries uniquely expand as a result of exports to China and uniquely shrink as a result of imports from China. However, the data does not support this hypothesis. It rather suggests that the unique effect of trade with trade with Chinese firms is more determined by the industry/product being traded rather than the flow (direction) of the trade. 

Nationalist Brazilian politicians who hope to increase exports to China and reduce imports from China should take note. At least relative to other countries, there doesn't seem to be a major difference across exports and imports. 

```{r agropecuario-metals-fuels-interactions-tibble, echo=FALSE}
interactionsAgropecuarioMetalsFuelsTibble %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Commodity",
                                      "Measurement of Ouput",
                                      "Trade Flow",
                                      "Model Type",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "Coefficients on Interaction Terms between Trade Flows and China Dummy, Commodities Production") %>%
  column_spec(1:8, width="0.63in") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 
```

Table \@ref(tab:agropecuario-metals-fuels-interactions-tibble) shows all of the interactions terms in the commodities data that are significant at the 0.05 level or "marginally significant" at the 0.1 level. This includes all of the models for meat and livestock (of which there are 6), all of the models for agricultural commodities (of which there are 32) and all of the models for metals and fuels production (of which there are 10). All told, there are 48 models in this category that are being considered, each with multiple interaction terms that could potentially be significant, since each model has two trade flows (imports and exports) and potentially multiple HS code-indexed commodities as regressors (though usually just one per model). For this reason, it is quite shocking that Table \@ref(tab:agropecuario-metals-fuels-interactions-tibble) only has 17 lines, 6 of which come from the final laminates models. This scarcity of significant terms comes in stark contrast to the findings from Table \@ref(tab:BEC-interactions-tibble), where, although not every variable is significant, significant terms are not uncommon. Out of 32 models with 64 interaction terms which could potentially be significant, 26 terms were identified as significant at the 0.05 level and 4 at the 0.1 level.

The paucity of significant terms implies that, when it comes to trade in commodities, the domestic industries don't care if the trade is with China or with another partner. In general, it appears exports of commodities to China won't stimulate the domestic industries any more than exports of the same to other partners. In general, it appears that imports of commodities from China don't threaten domestic industries any more than imports from other trade partners.

This conclusion is unsurprising. Commodities *by definition* are undifferentiated goods. Therefore, it follows very logically that this should be a category in which the coefficients on the interaction terms generally aren't significant. 

The results from Table \@ref(tab:BEC-interactions-tibble) should be (and are) very different, since they are looking at the effect of trade in very broad categories on output on very broad economic categories. Indeed, the classification system used to describe these categories was the UN's Broad Economic Categories (BEC) system. For this reason, these models are considering trade in differentiated goods (as well as trade in commodities) and so the fact that trade from different countries affects Brazilian industries heterogeneously should be expected. One can assume the "capital goods" exported from China to Brazil are different than those exported from Argentina to Brazil, at least in some key aspects.

However, even among the commodities, it appears that there are a few interaction terms in which trade with China does have a differentiated impact with respect to trade in those goods with other partners. 

First is petroleum. The `lm` and `plm` models are both in agreement that exports from Brazil to China in petroleum do not stimulate domestic industries as much as exports to other countries. This finding echos the observation from Table \@ref(tab:BEC-interactions-tibble) that trade with China doesn't stimulate the production of `BEC31 Primary fuels and lubricants` as much as trade with other countries does. While petroleum may be a commodity (especially since Brazil overwhelmingly exports it crude rather than refined) what is unique about Chinese demand is its enormity. Over the period analyzed, China became Brazil's largest export partner for petroleum, so it is very conceivable that Brazilian exports of petroleum to China are stimulating domestic production substantially (indeed, the coefficient on exports of BEC31 is positive and significant at the 0.001 level in both the `lm` and `plm` models), but just not stimulating quite as much as should be expected given the size of these trade flows. Additionally, the fact that HS2713 refers to petroleum coke, rather than crude petroleum (Brazil's principal primary fuel export) may also add further complexity to the model.

The second commodity of interest from Table \@ref(tab:agropecuario-metals-fuels-interactions-tibble) is beef. Again, the interaction term for exports is negative and significant. However, the interaction term for beef most likely suffers from the same effect as petroleum. While Brazilian exports of beef are worth less than exports of petroleum in dollars, China is again not only the largest export partner in these products, but actually consumes the majority of them. 

Soy, which, surprisingly, for which there is only one model in Table \@ref(tab:agropecuario-metals-fuels-interactions-tibble) where the interaction term is significant, potentially suffers from the same distortionary effect. 

The last point to address in this section is the preponderance of significant interaction terms on imports of "laminates" from China. Unfortunately, there was not an easy correspondence between the Brazilian Steelworks Industry's definition of "laminates" and iron and steel products as classified by the HS system. For that reason, 11 different HS codes were used in this regression, making the laminates models by far the models with the largest number of regressors. Moreover, there is not a substantial flow of trade in some of these laminates with China. Accordingly, it is very possible that a lot of these interaction terms came out as significant through pure random chance. 

In summary, when looking at the Brazilian economy broadly at the "economic category" level, one sees that in general trade with China in any given good does not stimulate the growth of the corresponding domestic industry in Brazil as much as trade in the same good with a different partner. This effect is notably observed for trade in consumer goods and primary fuels, but there are a handful of other categories that buck the trend. When it comes to trade in commodities, though, the corresponding sectors in the Brazilian economy don't necessarily care about where the commodities are exported to or imported from. There are a tiny handful of exceptions for which Chinese trade flows do have a differentiated effect on the Brazilian economy, but this is potentially a result of the fact that China is the largest export partner in these goods. 

## How has Sino-Brazilian bilateral trade as a whole affected the growth of various Brazilian sectors?

This is the second question this study attempts to answer. Unlike the previous section [Does Brazil trading in a given good with China have a different effect than when it trades in the same good with other countries?] which explores trade disaggregated at the product level, this question analyzes the effect of Sino-Brazilian trade *as a whole*. While the previous category attempted to assess whether or not there were some special properties of the goods that Chinese firms imported from or exported to Brazil which affected various economic sectors, this section will focus on factors like the product mix of imports/exports and their absolute volumes. In other words, if  Chinese firms hypothetically disproportionately imported good x from Brazil, Chinese trade *as a whole* may be associated with the growth of that one industry because of what the trade consists of.  

```{r BEC-fixef-tibble,echo=FALSE}
as.data.frame(partnerChinaTibbleBEC) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Economic Sector",
                                      "Model Type",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "Coefficients on China Fixed Effect, Economic Sector Models") %>%
  column_spec(1, width="2in") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 
```

Table \@ref(tab:BEC-fixef-tibble) shows that the "China shock" as a whole has been felt across almost every industry in Brazil. Of the 32 different models considered in this table, only 8 did not have a significant fixed effect for China. And of these 8, the majority were `lm` models, the majority of which had a corresponding `plm` model where the coefficient on the fixed effect for China is significant. The fact that there are differing results on the fixed effect coefficient for the `lm` and `plm` models is not surprising, since the model estimation methods are different and the `lm` model just had one dummy for China whereas the `plm` model had individual fixed effects for every trade partner in the data. Regardless, the preponderance of significant coefficients on the Chinese fixed effects indicates that trade with China has radically transformed the Brazilian economy. 

Furthermore, unlike the coefficients on the interaction terms in Table \@ref(tab:BEC-interactions-tibble), the coefficients on all of these fixed effects are overwhelmingly positive, implying that trade with China is associated with the growth of various sectors across Brazil. Nine of the 16 sectors analyzed have models where the fixed effect on China is positive in both the `lm` and `plm` models is positive and significant. Three of the remaining seven sectors have one model with a positive and significant China fixed effect and the other corresponding model's fixed effect is insignificant. Of the remaining four sectors analyzed, only one model - the `lm` regression for `BEC51 Passenger motor cats` - has a significant negative coefficient on the China fixed effect. And of this model, the `plm` model has a significant positive fixed effect for China. 

The discrepancy in the coefficient for trade with China on the growth of the Brazilian passenger vehicle industry shows that the effect is very nuanced. Even when creating new models which only take imports or exports (rather than both simultaneously), the same trend persists: a negative coefficient on the fixed effect for China in the `lm` model and a positive coefficient on the fixed effect for China in the `plm` model.

On closer examination of the different models, it is seen that the fixed effect with the largest absolute magnitude is that on `BEC31 Primary fuels and lubricants`. This model was noted in [Does Brazil trading in a given good with China have a different effect than when it trades in the same good with other countries?] because of the negative and significant coefficient on the interaction between imports and exports of BEC31 and the China dummy. The results from Table \@ref(tab:BEC-fixef-tibble) do not contradict these findings, but rather say that trade with China *as a whole* is associated with a dramatic expansion in the sector that produces primary fuels (like petroleum and natural gas). Synthesizing the findings from both of these coefficients (and Figure \@ref(fig:fuels-sector-output)) one sees that not only has the hydrocarbons industry in Brazil grown enormously from 2002 to 2021, but that this growth is largely caused by China. Furthermore, although the growth in this industry is largely caused by China, there is not something special about petroleum exports to China that have led to this growth. It is, rather, the sheer enormity of Chinese demand for petroleum that seems to have stimulated the explosion in production of hydrocarbon fuels in Brazil.

Table \@ref(tab:BEC-fixef-tibble) also shows that the only models where none of the fixed effects on China are significant are those for `BEC21 Primary industrial supplies nes` and `BEC22 Processed industrial supplies nes`. One potential interpretation of this finding is that "industrial supplies" in China and Brazil are very distinct, and as a result, the industrial supplies that Brazil might import find from China therefore do not influence very much domestic production of said supplies. If this hypothesis were true, it would mean that the Brazilian and Chinese economies have specialized to a certain extent, which, interestingly enough, could potentially have occurred as a result of Sino-Brazilian trade. This, however, requires further research. 

Returning to the hypothesis of the "deindustrialization" or "reprimarization" of the Brazilian economy due to trade with China, Table \@ref(tab:BEC-interactions-tibble) shows that Chinese imports of durable and semi-durable consumer goods (relative to imports of the same from other partners) tend to have a negative effect on output in these sectors. Table \@ref(tab:BEC-fixef-tibble), though, shows that the conclusion is not as straightforward and not without its own fair share of nuance. The fixed effects on China show that trade with China is, in fact, associate with growth in the output of these two goods in the Brazilian economy. Potentially this is because trade with China allows for increased exports for this goods, or because trade with China allows for the cheaper supply of components necessary for the production of these goods. Further research needs to be conducted to identify the mechanism of this correlation. Whatever the reason, the results from Table \@ref(tab:BEC-fixef-tibble) show that one cannot so immediately argue that trade with China is "deindustrializing" Brazil.

In addition, the fact that trade with China is positively correlated with output from many other value-added manufacturing segments shows that accusations that Chinese trade is "deindustrializing" Brazil must consider the nuance of the Sino-Brazilian trade's overall effect. The coefficient on the China fixed effect in the `plm` model for output of `BEC41 Capital goods (except transport equipment)` is significant and has one of the highest magnitudes in the set. The coefficient in the China fixed effect in the corresponding `lm` is also significant and positive. Although this study found that the correlation between Sino-Brazilian trade and output of `BEC51 Passenger motor cats` is very nuanced, the fact that Chinese trade and output of `BEC522 Other non-industrial transport equipment` shows that, in many ways, Chinese trade does support the Brazilian auto industry.

As identified in [Introduction], one of the industries that most benefitted from trade with China was the soy industry, which has grown enormously over the 2002-2021 period. (Figure on soy exports from Brazil .... Figure on output of this sector in China). Accordingly, it is not surprising that one of the sectors which exhibits a positive correlation between trade with China and sector output is `BEC111 Primary food and beverages, mainly for industry`. As soy is a primary agricultural product, it would fall in this category. The increase in the production of soy should therefore stimulate the output of this BEC category in Brazil. The only thing that is surprising, though, is that the positive correlation between output in this category and trade with China is not *uniquely* positive (or uniquely large in magnitude).


```{r agropecuario-fixef-tibble,echo=FALSE,fig.cap="Coefficients on China Fixed Effect, Agricultural Commodity Production"}
partnerChinaAgropecuarioTibble %>%
  transmute(Product = Product, Metric=Metric, Model=Model, Estimate=Estimate, stderr = `Std. Error`, confint = `95% Conf. Int.`, signif = `Signif.`) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Commodity",
                                      "Output Measurement",
                                      "Model Type",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "Coefficients on China Fixed Effect, Agricultural Commodity Production") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 
```

```{r metals-fuels-fixef-tibble,echo=FALSE,cache=FALSE,warning=FALSE,fig.cap="Coefficients on China Fixed Effect, Commodity Production (cont.)"}
partnerChinaMetalFuelsTibble %>%
  transmute(Product = partnerChinaNamesMetalFuels, Metric=partnerChinaMetricMetalFuels, Model=partnerChinaModelsMetalFuels, Estimate=Estimate, stderr = `Std. Error`, confint = `V6`, signif = `V7`) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Commodity",
                                      "Output Measurement",
                                      "Model Type",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "Coefficients on China Fixed Effect, Commodity Production (cont.)") %>%
  column_spec(2, width="0.67in") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 
```
Table \@ref(tab:agropecuario-fixef-tibble) presents a very different result from from the one seen in Table \@ref(tab:BEC-fixef-tibble). Unlike in Table \@ref(tab:BEC-fixef-tibble), only a small handful of the coefficients tested in Table \@ref(tab:agropecuario-fixef-tibble) are significant. The findings suggest that overall trade with China as a whole does not significantly impact the production of most agricultural and livestock commodities. At least, not as much as trade impacts the output of different sectors, broadly speaking. 

The only commodity in Table \@ref(tab:agropecuario-fixef-tibble) in which the fixed effect for China is significant is cotton. The coefficient is negative, indicating that overall trade with China reduces the level of cotton production in Brazil. This finding is consistent across all metrics of cotton production analyzed; whether cotton production is measured by weight or area harvested, as in Table \@ref(tab:agropecuario-fixef-tibble), or by dollar value of the harvest, as in Table \@ref(tab:metals-fuels-fixef-tibble), the findings are all in agreement about the effect that trade with China, taken in aggregate, has on cotton production in Brazil. 

Figure \@ref(fig:textiles-trade-Brazil) shows that not only have Brazilian imports of textiles increased over the 21st century, but that China is head and shoulders the principal import partner for textiles. However, the vast majority of Brazilian imports of the textiles (as defined by HS Section XI) from China, do not consist of cotton. Instead, Brazilian textile imports from China are overwhelmingly finished manufactured clothing items. For this reason, one cannot say that the data suggests a direct replacement of production of cotton in the Brazilian economy by Chinese imports of the same. Indeed, Brazilian production of cotton has increased substantially over the analyzed period, as it was meeting booming demand for the commodity from many Asian countries, perhaps most ironically China. Figure \@ref(fig:share-harvest-exported) shows that cotton production has increasingly catered to international export markets, with only around 20% of cultivated cotton in 2002 exported while approximately two-thirds of cultivated cotton in 2019 was exported. The fact that the coefficient on the fixed effect for China is negative may suggest that imports of Chinese textiles has thus reduced domestic clothing manufacturing and thus reduced domestic demand for cotton and thus reduced Brazilian cotton cultivation, but more research has to be conducted before anything decisive about this hypothesis can be said. 

```{r share-harvest-exported, echo=FALSE,warning=FALSE,cache=TRUE,include=TRUE,out.width = "100%", fig.align='center', fig.cap = "Share of Select Crop Harvests Exported to International Markets"}
plot_grid(share_harvest_exported, share_harvest_to_china)
```

Figure \@ref(fig:share-harvest-exported) also highlights the potential discrepancy between the domestic production data and the trade data. Obviously, the share of the domestic harvest exported to international markets should not exceed 1. The fact that for some crops this share occasionally does exceed 1 implies that perhaps the trade data considered is overly inclusive, or that prices in Brazil are different from those in international markets. 

```{r faceted-brazilian-commodity-exports,echo=FALSE,cache=FALSE,warning=FALSE,fig.cap="Select Brazilian Exports to China over Time"}
eda_trade_data %>% filter(HS4Digit %in% c(7201, 202, 207, 203, 2709, 1201,1701,2601)) %>%
  filter(flow=="Export") %>%
  mutate(`Export Good` = Description,
         `Export Partner` = case_when(partner=="China" ~ "China", TRUE ~ "Other")) %>% 
  group_by(`Export Good`, `Export Partner`, year) %>% summarise(value=sum(normalizedValue)) %>%
  ggplot(aes(x=year,y=value, group=`Export Partner`, fill=`Export Partner`)) +
  geom_area() +  
  facet_wrap(~`Export Good`,scales="free_y") + 
  labs(x="Year",y="Annual Export Value (Constant 1982 USD)", title="Select Brazilian Exports to China over Time") + 
  theme(plot.title = element_text(hjust = 0.5))
```

Beyond the coefficient on cotton production, though, it is extremely unexpected that the fixed effect on China is not significant for the overwhelming majority of these models. Figure \@ref(fig:share-harvest-exported) shows that exports to China of various commodities have boomed over the first two decades of the 21st century. Moreover, Figure \@ref(fig:faceted-brazilian-commodity-exports) shows that China is head and shoulders the principal export partner for several commodities, including crude petroleum, frozen bovine meat, pig meat, and iron ore. And while China is the principal export partner for all of these goods, the enormity of Chinese demand for soy is even more staggering for its absolute dollar value (in 2018, Brazilian soy exports to China were worth nearly 28 billion in current US dollars), its share (with Table \@ref(tab:brazil-china-exports-table) showing that Chinese demand sucks up nearly three-quarters of Brazilian exports of soybeans) and its duration (with China being the chief export partner for soy for nearly the entirety of the analyzed duration). 

Though Figure \@ref(fig:faceted-brazilian-commodity-exports) may at first glance suggest that trade with China, taken in aggregate, should be stimulating the production of the analyzed commodities, it also suggests some potential reasons why the fixed effect on China might not be significant. 

First, for crude petroleum and even more so for frozen bovine meat and pig meat, the surge in Chinese demand for these Brazilian commodities is actually a very recent phenomenon. Before 2014, Chinese demand for Brazilian frozen bovine meat was virtually nonexistent. For pig meat, it was not until 2017 that Chinese demand really began in earnest. For petroleum, Chinese demand has existed for a substantial amount of time, though it didn’t claim the lion’s share of Brazilian exports until about 2008. Moreover, Chinese demand for Brazilian petroleum has *generally* tracked the demand of other trade partners for the period analyzed, and even when it has bucked the overall international trend, Chinese demand for Brazilian crude petroleum is extraordinarily volatile (like Brazil’s petroleum exports to most other partners). This is not even to mention that the metric measuring petroleum output (average barrels per day) may only be loosely correlated with cumulative monthly production. In addition, even if a surge in foreign demand results in greater investment in Brazilian petroleum production capacity, this investment may take a while to result in increased production. This fact highlights the need for models incorporating lagged trade data, which is further explored in [Analysis with Lagged Trade Data]. For these reasons, it may be less expected that the fixed effect for China is not significant for these goods.

Second, while Figure \@ref(fig:faceted-brazilian-commodity-exports) shows that not only does Brazil export iron ore en masse to China, but that the share of iron ore exports destined for China increases steadily over time (reaching nearly three-quarters of iron ore exports by 2020). 
However, it is important to stress that the vast majority of iron exported to China is exported as ore (HS code 2601), and is not transformed/smelted in Brazil to become pig iron or any other form of iron/iron alloy.  For this reason, while the China trade shock in aggregate may have stimulated the production of iron ore, this surge in iron mining may not be reflected in the output of transformed iron. Indeed, Brazil’s exports of iron ore are orders of magnitude larger than its exports of pig iron. And, as can be seen in Figure  \@ref(fig:faceted-brazilian-commodity-exports), China accounts for a minuscule share of Brazilian pig iron exports, anyway. For this reason, it may be unsurprising that the China fixed effect for the metal transformation models is not significant. 

```{r brazil-harvestvalue-soyexports,echo=FALSE,cache=FALSE,warning=FALSE,fig.cap="Brazilian Exports of Soy and Brazilian Soy Annual Harvest Value"}
eda_trade_data %>% filter(HS4Digit  == 1201) %>%
  filter(flow=="Export") %>%
  mutate(`Export Good` = Description,
         `Export Partner` = case_when(partner=="China" ~ "China", TRUE ~ "Other")) %>% 
  group_by(`Export Good`, `Export Partner`, year) %>% summarise(value=sum(normalizedValue)) %>%
  left_join(valordaproducao, by=c("year"="year")) %>% 
  mutate(soy_production = `soja (Constant 1982 USD$)`*1000,
         `Harvest Value` = "Harvest Value") %>% 
  ggplot(aes(x=year)) +
  geom_area(aes(y=value, group=`Export Partner`, fill=`Export Partner`)) +  
  geom_line(aes(y=soy_production,shape=`Harvest Value`),show.legend=TRUE) +
  labs(x="Year",y="Annual Export Value (Constant 1982 USD)", title="Brazilian Exports of Soy and Brazilian Soy Annual Harvest Value" ) + theme(plot.title = element_text(hjust = 0.5))
  
```

The greatest unexplainable mystery from these results is the lag of significance of the Chinese fixed effect on the soybean production models. Figure \@ref(fig:brazil-harvestvalue-soyexports) again shows that the overwhelming majority of the value of soybeans are harvested for export, and again shows that China has received the largest share of Brazil’s soy exports since 2008. In other words, one could easily say that the Brazilian soy industry, in large part, depends on exports to China. For this reason, it is quite surprising that there is not a significant and positive coefficient on the fixed effect representing China, as Chinese trade as a whole (considering that Brazil imports virtually no soy from China) should be stimulating the growth of the soy sector.

This highlights several of the potential flaws with the methodology/data for these commodity models. Chief among these flaws is the difficulty of creating the one-to-one correspondence between output of Brazilian commodities and traded goods defined by an HS code. The World Customs Organization’s Harmonized System (HS) has a very different methodology than the Brazilian Institute of Geography and Statistics (IBGE) and other statistics agencies in Brazil. For this reason, determining which HS coded good or goods corresponded to a commodity defined by the IBGE was not straightforward. This study wanted to avoid omitting any trade goods which could potentially influence the output of the analyzed commodity, so multiple 4-digit coded goods or one 2-digit coded good were generally included in each model. The results of this matching are detailed in \@ref(tab:commodity-HS-matching). For the "soy" models, this meant that output of soy (as defined in the IBGE’s Annual Agricultural Survey) was regressed on HS codes 1201 Soybeans, 2304 Soybean Meal, 1507 Soybean Oil. 

One risk with this level of inclusivity is that the inclusion of several trade goods which are not related to the commodity being analyzed. These goods without the direct relationship to output of the commodity analyzed may have added a substantial amount of noise to the regression which could have obscured the relationship between the dependent variable and the regressors. Alternatively, it’s very possible that several relevant trade goods were omitted from the model, meaning that the model itself could not effectively explain the variance in the dependent variable. However, if relevant regressors were omitted, that might potentially increase the percentage of the variance which could be explained by China dummy. For this reason, as well as the fact that trade goods were not analyzed at the six-digit HS code level, the most likely complication with regressor selection was the inclusion of irrelevant variables. 

An additional hurdle for this study's methodology was the availability of only annual data for production of the commodities analyzed. As explained in [Risks & Mitigations], this limitation resulted in the inability to fit the time trend with yearly dummies, as had been done for the variables with monthly observations, because these dummies could perfectly fit the dependent variable. Accordingly, the study relied on a polynomial trend to control for the time trend, but this polynomial trend didn't fit the highly volatile production values as well as the time dummies. One unfortunate effect of this was an increased variance of the model, which potentially pushed a number of variables to become insignificant. 

In short, there are a number of threats to the methodology/data which may explain why none of the fixed effects in Table \@ref(tab:agropecuario-fixef-tibble) or Table \@ref(tab:metals-fuels-fixef-tibble) are significant. Moreover, as seen in Figure \@ref(fig:faceted-brazilian-commodity-exports), there are several temporal reasons (among others) which may create a genuine lack of correlation between Chinese trade in aggregate and the output of the commodities. 

These complications may potentially explain why there are such notable discrepancies between Table \@ref(tab:BEC-fixef-tibble) and the commodities tables. Table \@ref(tab:BEC-fixef-tibble) suggests trade with China, taken in aggregate, not only stimulates output from the economic category `BEC31 Primary fuels and lubricants`, but that the absolute magnitude of the effect is huge. Again, this is a surprising, considering that China is Brazil's largest export partner for petroleum, as seen in Figure \@ref(fig:faceted-brazilian-commodity-exports). However, though petroleum is an example of a "primary fuel", the coefficient on the Chinese fixed effect for the models of petroleum production in Table \@ref(tab:metals-fuels-fixef-tibble) is insignificant. Likewise, while the fixed effect representing China is significant in both the `lm` and `plm` models for `BEC111 Primary food and beverages, mainly for industry`, and the agricultural commodities analyzed are almost certainly "primary food", the fixed effect representing China in the agricultural models are overwhelmingly insignificant. More research has to be conducted to understand the origin of this discrepancy. 

In summary, overall trade with China appears to be correlated with the expansion of sectors across the Brazilian economy. It appears that most industries, defined by the UN's Broad Economic Categories system, have benefitted enormously from engaging in trade with China. However, when looking at trade flows of commodities, the relationship between trade with China and the growth or shrinkage of production of these various areas. The findings in these models contradict intuition, as it is expected that Chinese demand has been responsible for a large expansion in the production of several commodities. The fact that the relationship between Chinese trade and the growth of several commodities sectors is relatively weak indicates that the findings from Table \@ref(tab:BEC-fixef-tibble) have an element of nuance, either through complications in the models, the data or the actual relationship between the trade data and commodities output itself. 

## Analysis with Lagged Trade Data

```{r BEC-lag-significance,include=TRUE, out.width = "100%", echo=FALSE, fig.align='center', fig.cap = "Significance of Lag Terms in BEC Models"}
as.data.frame(BEC_lags_significance_rows_tibble) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Economic Sector",
                                      "Model",
                                      "Imports Lag 0",
                                      "Imports Lag 6mo.",
                                      "Imports Lag 1yr.",
                                      "Imports Lag 1.5yr.",
                                      "Imports Lag 2yr.",
                                      "Exports Lag 0",
                                      "Exports Lag 6mo.",
                                      "Exports Lag 1yr.",
                                      "Exports Lag 1.5yr.",
                                      "Exports Lag 2yr."),
        caption = "Significance of Lag Terms in BEC Models") %>%
  column_spec(1, width="1.5in") %>%
  column_spec(2:12, width="0.33in") %>%
  kable_styling(font_size = 7, position = "center",latex_options = "HOLD_position") 
```

```{r agropecuario-lags-significance,out.width = "100%", include=TRUE,echo=FALSE, fig.align='center', fig.cap = "Significance of Lag Terms of Agricultural Commodities Output Models"}
lagsSignificanceAgropecuarioTibble %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Commodity",
                                      "Model",
                                      "Metric",
                                      "Imports Lag 0",
                                      "Imports Lag 6mo.",
                                      "Imports Lag 1yr.",
                                      "Imports Lag 1.5yr.",
                                      "Imports Lag 2yr.",
                                      "Exports Lag 0",
                                      "Exports Lag 6mo.",
                                      "Exports Lag 1yr.",
                                      "Exports Lag 1.5yr.",
                                      "Exports Lag 2yr."),
        caption = "Significance of Lag Terms of Agricultural Commodities Output Models") %>%
  #column_spec(1, width="0.67in") %>%
  column_spec(3, width="0.66in") %>%
  column_spec(4:13, width="0.33in") %>%
  kable_styling(font_size = 7, position = "center",latex_options = "HOLD_position") 
```

Table \@ref(tab:BEC-lag-significance), Table \@ref(tab:agropecuario-lags-significance) and Table \@ref(tab:metalsfuels-lags-significance) show the significance and sign of the lagged values for trade in the regression. If a certain lag of the value of a trade flow is not significant, the table has a blank cell. If the coefficient on the lag term is significant, this table shows the sign of the coefficient.

All three tables show the surprising conclusion that lagged trade values do not very effectively explain the variance in output of the corresponding sector in any given period. While the vast majority of zeroth lags (i.e. the trade value in the same period as the measurement of output) are significant, higher order lags seldom are. In addition, the significant higher order lags tend to concentrate in a few select economic sectors/commodities. 

As would be expected in Table \@ref(tab:BEC-lag-significance), the coefficients on higher order lags of exports of primary fuels are significant and positive. This follows that both Brazilian production of petroleum over time (as seen in Figure \@ref(fig:fuels-sector-output)) and Brazilian exports of petroleum increase over time. In addition, we might observe that since investments in petroleum exploration are investments that take a significant amount of time to finally start production in earnest, it follows that increased foreign demand for Brazilian petroleum will translate into increased domestic production several years in the future. These findings, however, contradict the conclusions from Table \@ref(tab:metalsfuels-lags-significance), in which none of the higher order lags beyond the zeroth lag of exports of petroleum are significant. This discrepancy between the commodities data and the economic sector data needs to be investigated further to be reconciled. Considering that China has historically been one of the top destinations for Brazilian petroleum exports, with 58% of Brazilian exports of crude petroleum in 2020 destined for China, one could conclude that trade with China is responsible for a large portion of this relationship. 

Other goods in Table \@ref(tab:BEC-lag-significance), such as passenger vehicles & transport equipment, processed fuels and "goods not specified elsewhere" have significant and positive coefficients on higher order lags of imports. This potentially indicates that increased imports of these goods suggest increased Brazilian demand of these goods in the future. Furthermore, the fact that many different 1.5 year lags on the export terms in Table \@ref(tab:BEC-lag-significance) are significant and positive while many 1 year lags on the export terms are significant and negative potentially reveals a pattern about the business cycles in Brazil. 

Table \@ref(tab:agropecuario-lags-significance) again highlights the salience of zeroth lags. Among all the models of agricultural products, the zeroth lags on export values for beef, pork, coffee and soy are all significant. These findings suggest that a substantial portion of the crop produced is thus exported, so that when exports of a crop in a certain period are large, Brazilian production of the crop in the same period will also be large. 

Lastly, the fact that there are a number of significant and positive lags for the laminates models in Table \@ref(tab:metalsfuels-lags-significance) suggests that when there is an increase in Brazilian demand for laminates, the market will satisfy the demand through both domestic production and imports from abroad. 




```{r metalsfuels-lags-significance,echo=FALSE,out.width = "100%", fig.align='center', fig.cap = "Significance of Lag Terms of Industrial Commodities Output Models",include=TRUE}
LagsSignificanceMetalFuelsTibble %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Commodity",
                                      "Model",
                                      "Metric",
                                      "Imports Lag 0",
                                      "Imports Lag 6mo.",
                                      "Imports Lag 1yr.",
                                      "Imports Lag 1.5yr.",
                                      "Imports Lag 2yr.",
                                      "Exports Lag 0",
                                      "Exports Lag 6mo.",
                                      "Exports Lag 1yr.",
                                      "Exports Lag 1.5yr.",
                                      "Exports Lag 2yr."),
        caption = "Significance of Lag Terms of Industrial Commodities Output Models") %>%
  #column_spec(1, width="0.67in") %>%
  column_spec(3, width="0.66in") %>%
  column_spec(4:13, width="0.33in") %>%
  kable_styling(font_size = 7, position = "center",latex_options = "HOLD_position") 
```

```{r BEC-lags-ChinaFE,out.width = "100%", fig.align='center',echo=FALSE, fig.cap = "China Fixed Effect in Lagged Models, Broad Economic Categories",include=TRUE}
as.data.frame(BEC_lags_China_FE_tibble) %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Economic Sector",
                                      "Model Type",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "China Fixed Effect in Lagged Models, Broad Economic Categories") %>%
  column_spec(1, width="2in") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 

```

```{r agropecuario-lags-ChinaFE,out.width = "100%", echo=FALSE,fig.align='center', fig.cap = "China Fixed Effect in Lagged Models, Agricultural Commodities, Agricultural Commodity Output",include=TRUE}
ChinaFE_LAGSAgropecuarioTibble %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Commodity",
                                      "Model Type",
                                      "Metric",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "China Fixed Effect in Lagged Models, Agricultural Commodities") %>%
  #column_spec(1, width="1.5in") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 
```

```{r metalsfuels-lags-ChinaFE, echo=FALSE,cache=TRUE,out.width = "100%", fig.align='center', fig.cap = "China Fixed Effect in Lagged Models, Industrial Commodities",include=TRUE}
partnerChinaMetalFuelsLAGSTibble %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Commodity",
                                      "Model Type",
                                      "Metric",
                                      "Coef. Est.",
                                      "Std. Error",
                                      "95% Conf. Int.",
                                      "Significance"),
        caption = "China Fixed Effect in Lagged Models, Industrial Commodities") %>%
  #column_spec(1, width="1.5in") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 
```

The inclusion of lagged trade data to the broad economic categories models didn’t influence much the fixed effect representing China. The China fixed effects across most economic categories in Table \@ref(tab:BEC-lags-ChinaFE) are both significant and positive, as they were in the models without lags in Table \@ref(tab:BEC-fixef-tibble). Table \@ref(tab:BEC-lags-ChinaFE)  provides even further evidence that the China trade shock, taken as a whole, has stimulated the growth of sectors across the Brazilian economy. 

The only notable differences between Table \@ref(tab:BEC-lags-ChinaFE) and Table \@ref(tab:BEC-fixef-tibble) are that the China fixed effects for the `plm` model for `BEC111 Primary food and beverages, mainly for industry` and the `lm` model for `BEC41 Capital goods (except transport equipment)`  have become marginally significant (from being significant previously). The only negative fixed effect, that on the `lm` model for `BEC51 Passenger motor cars`, is negative in both the models with and without lagged trade data.

```{r brazilian-production-tradevalue-crops, echo=FALSE,warning=FALSE,message=FALSE,cache=TRUE,out.width = "100%", fig.align='center', fig.cap = "Select Brazilian Exports to China over Time",include=TRUE}
eda_trade_data %>% 
  filter(flow=="Export") %>%
  mutate(`Crop` = case_when(HS4Digit == 1201 ~ "Soy",
                                   HS2Digit == 52 ~ "Cotton",
                                   HS2Digit == 18 ~ "Cocoa",
                                   HS2Digit == 17 ~ "Sugarcane",
                                   HS4Digit == 1005 ~ "Corn",
                                   HS2Digit == 24 ~ "Tobacco",
                                   HS4Digit == 0901 ~ "Coffee"
                                   ),
         `Export Partner` = case_when(partner=="China" ~ "China", TRUE ~ "Other")) %>% 
  drop_na() %>% 
  group_by(`Crop`, `Export Partner`, year) %>% summarise(`Trade Value`=sum(normalizedValue)) %>%
  left_join(valordaproducao %>% mutate(`Soy` = `soja (Constant 1982 USD$)`*1000,
         `Cotton` = `algodão (Constant 1982 USD$)`*1000,
         `Cocoa` = `cacau (Constant 1982 USD$)`*1000,
         `Coffee` = `café (Constant 1982 USD$)`*1000,
         `Sugarcane` = `cana-de-açúcar (Constant 1982 USD$)`*1000,
         `Corn` = `milho (Constant 1982 USD$)`*1000,
         `Tobacco` = `fumo (Constant 1982 USD$)`*1000,
         year=year, .keep="unused") %>% pivot_longer(cols=c("Soy", "Cotton", "Coffee", "Tobacco", "Sugarcane", "Corn", "Cocoa"),names_to="Crop", values_to="Production Value"), by=c("year"="year","Crop"="Crop")) %>%
  mutate(`Domestic Production`= "Harvest Value") %>%
  ggplot(aes(x=year)) +
  geom_area(aes(y=`Trade Value`, group=`Export Partner`, fill=`Export Partner`)) +  
  geom_line(aes(y=`Production Value`,shape=`Domestic Production`),show.legend = TRUE) +
  facet_wrap(~Crop,scales="free_y") +
  labs(x="Year",y="Annual Export Value (Constant 1982 USD)", title="Share of Brazilian Exports to China of Select Crops" ) + theme(plot.title = element_text(hjust = 0.5))
```
 
However, even with the inclusion of the lags, Table \@ref(tab:metalsfuels-lags-ChinaFE) and Table \@ref(tab:agropecuario-lags-ChinaFE) show that the fixed effect representing China is not significant in any of the commodity models. The lack of significance persists whether output/production is measured by weight, area harvested, harvest value, or any other metrics. Figure \@ref(fig:brazilian-production-tradevalue-crops) shows that domestic production of the indicated commodities (depicted by the black line) and exports of them (depicted by the shaded area) appear to be highly correlated. This finding is reflected in Table \@ref(tab:agropecuario-lags-significance) and Table \@ref(tab:metalsfuels-lags-significance). However, Figure \@ref(fig:brazilian-production-tradevalue-crops) also offers some further insight into why the coefficient on the China fixed effect may not be significant. The plots reveal that while China may be one of the main export partners for many of Brazil’s top agricultural goods, China actually does *not* dominate the trade in most of these goods in the same way that it dominates the soy trade. Only 31.6% of 2020 exports of cotton were destined for China. China received only 13.3% of the `$`1.15 billion current US dollars worth of Brazilian tobacco exports in 2020 (though it was still the main export partner for the crop, with a high level of fragmentation among other partners). And for other crops, such as corn and coffee, Chinese demand for the products is truly negligible (though it is important to note that China does receive millions of dollars worth of these crops from Brazil every year). 
 
```{r commodities-trade-diff-scales, echo=FALSE,warning=FALSE,message=FALSE,cache=TRUE,out.width = "100%", fig.align='center', fig.cap = "Select Brazilian Exports to China over Time",include=TRUE}
# multiply the production value by avg_trade_value/avg_commodity_production

meatMonthly %>% inner_join(metalsMonthly, by=c("fYear"="fYear","fMonth"="fMonth")) %>% inner_join(hydrocarbonsMonthly, by=c("fYear"="fYear","fMonth"="fMonth")) %>%
  transmute(beef = (`bovinos (tons)`),
            pork = (`suínos (tons)`),
            chicken = (`frangos (tons)`),
            `pig iron` = (`ferro-gusa (tons)`),
            `crude petroleum` = (`petróleo (k brl/day)`),
            years = as.double(as.character(fYear)) + as.double(as.character(fMonth))/12) %>% 
  pivot_longer(cols = c("beef","pork","chicken","pig iron", "crude petroleum"), names_to = "Commodity", values_to="Commodity Production") %>% 
  inner_join(tradeDataLong %>% 
               filter(flow=="Exports") %>% 
               filter(fourDigitHS2017 %in% c(202, 207, 203,7201,2709)) %>% 
               mutate(`Export Partner` = case_when(partner=="China" ~ "China", TRUE ~ "Other"),
                      `Trade Good = Matching Brazil Commodity` = 
                        case_when(fourDigitHS2017 == 202 ~ "Frozen Bovine Meat",
                                               fourDigitHS2017 == 207 ~ "Poultry Meat",
                                               fourDigitHS2017 == 203 ~ "Pig Meat",
                                               fourDigitHS2017 == 7201 ~ "Pig Iron",
                                               fourDigitHS2017 == 2709 ~ "Crude Petroleum"),
                      `Matching Commodity` = case_when(fourDigitHS2017 == 202 ~ "beef",
                                               fourDigitHS2017 == 207 ~ "chicken",
                                               fourDigitHS2017 == 203 ~ "pork",
                                               fourDigitHS2017 == 7201 ~ "pig iron",
                                               fourDigitHS2017 == 2709 ~ "crude petroleum"),
                      years = as.double(as.character(fYear)) + as.double(as.character(fMonth))/12) %>%
               group_by(years,`Export Partner`,`Trade Good = Matching Brazil Commodity`,`Matching Commodity`) %>% 
               summarise(`Trade Value` = sum(valueNormalized)), by=c("years"="years","Commodity"="Matching Commodity")) %>%
  mutate(`Brazilian Commodity Production` = "Various Metrics Measuring Output") %>% 
  left_join(commodity_diff_scale_avg, by=c("Commodity"="Commodity")) %>%
  mutate(`Commodity Production` = `Commodity Production`*avg_trade_value/avg_commodity_production) %>%
  ggplot(aes(x=years)) + 
  geom_area(aes(y=`Trade Value`, group=`Export Partner`, fill=`Export Partner`)) + 
  geom_line(aes(y=`Commodity Production`,shape=`Brazilian Commodity Production`),show.legend=TRUE) + 
  facet_wrap(~`Trade Good = Matching Brazil Commodity`, scales = "free_y") + 
  theme(axis.text.y = element_blank(), plot.title=element_text(hjust=0.5)) + 
  labs(x="Year", y= "Trade Value/Domestic Output Level", title = "Brazilian Exports and Output of Select Commodities")
``` 
 
Figure \@ref(fig:commodities-trade-diff-scales) shows Brazilian production of select commodities superimposed on their trade values. Figure \@ref(fig:commodities-trade-diff-scales) not only differs from Figure \@ref(fig:brazilian-production-tradevalue-crops) in that the commodities analyzed are largely industrial rather than agricultural, but that the metrics used to measure them are not value. While the regression results from Table \@ref(tab:agropecuario-lags-significance) and Table \@ref(tab:metalsfuels-lags-significance) show that there is a general agreement among the coefficients of the models analyzed regardless of the metric of "output" (be it weight, value, area harvested or something else), Figure \@ref(fig:commodities-trade-diff-scales) indicates that radically different metrics of output correlate less with trade output than value does. This is potentially due to the fact that commodity prices are highly variable, for which reason a certain amount of output of any of these commodities may have very different trade values in different months. This trend is partly observed by the fact that domestic production of the commodities in Figure \@ref(fig:commodities-trade-diff-scales) remains relatively constant, while the exports of them present much more fluctuations. One example of this difference is for petroleum production, as Brazilian petroleum exports crashed in 2015 (potentially because of a price shock) while the average number of barrels produced per day increased steadily between 2000 and 2020. Moreover, while Chinese consumption of Brazilian pork and beef appeared somewhat precipitously around 2015, the corresponding Brazilian production of these meats did not appear to change too much after this demand shock.
 
The one major difference between the findings from Table \@ref(tab:agropecuario-lags-significance) and the findings in [How has Sino-Brazilian bilateral trade as a whole affected the growth of various Brazilian sectors?] is that the China fixed effect for the cotton models is no longer significant after adding the lagged trade values to the regression. This suggests that the lagged data is actually better at explaining the variance in Brazilian cotton production than whether or not the trade partner is China. Considering Chinese consumption of Brazilian cotton, like for many other commodities analyzed, is a relatively recent phenomenon, maybe these lagged terms are capturing some of the "China trade shock". Regardless, the sudden insignificance in the fixed effect for China suggests that perhaps, after all, the "China effect" isn’t so unique. 

```{r BEC-exports-vsoutputCHINA, echo=FALSE, fig.align='center',cache=TRUE,fig.cap="Output of Brazilian Broad Economic Categories and Trade Data by Trade Partner"}
# divide into exports and imports
PIM_PF_BEC %>% inner_join(tradeDataLong %>% 
                            mutate(`Trade Partner` = case_when(partner=="China" ~ "China", TRUE ~ "Other")) %>%
                            select(threeDigitBEC,fYear,fMonth,valueNormalized,`Trade Partner`), by=c("fYear"="fYear","fMonth"="fMonth","BEC"="threeDigitBEC")) %>% group_by(fYear,fMonth,BEC,`Trade Partner`) %>% summarise(`Output Index` = mean(PIM_PF_BECindexValue), `Trade Value` = sum(valueNormalized)) %>% filter(!(BEC %in% c(7,121))) %>%
  mutate(years = as.double(as.character(fYear)) + as.double(as.character(fMonth))/12,
         .keep="unused") %>%
  inner_join(bec_avg_intensity,by=c("BEC"="BEC")) %>%
  mutate(`Output Index` = `Output Index`*avg_trade_value/avg_intensity,
         `Domestic Output` = "Index Relative to 2012") %>%
  #pivot_longer(cols=c("Output Index", "Trade Value"), names_to = "Output", values_to="Intensity") %>%
  ggplot(aes(x=years)) + 
  geom_area(aes(y=`Trade Value`, group=`Trade Partner`, fill=`Trade Partner`)) +  
  geom_line(aes(y=`Output Index`,shape=`Domestic Output`),show.legend = TRUE) +
  facet_wrap(~BEC,scale="free_y") + 
  theme(axis.text.y = element_blank(), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Year", title="Output of Brazilian Broad Economic Categories and Trade Data")

```

One potential explanation for the major divergence is seen in Figure \@ref(fig:BEC-exports-vsoutputCHINA). Unlike the commodities production data for Brazil, it is seen that domestic output in a variety of Broad Economic Categories appears to be very correlated with trade. This correlation is perhaps most clearly seen in `BEC41 Capital goods (except transportequipment)`, `BEC42 Capital goods parts andaccessories`, `BEC53 Transport equipment parts andaccessories`, `BEC61 Durable consumer goods`, `BEC62 Semi-durable consumer goods` and `BEC522 Other non-industrial transport equipment`. Primary foods, as seen in `BEC111 Primary food and beverages,mainly for industry`, show an incredible amount of cyclicity in the the trade data, presumably because of a seasonality in the production of key crops. Moreover, one of the areas where trade with China (defined as the sum of imports and exports) clearly dominates - `BEC61 Durable consumer goods` and `BEC62 Semi-durable consumer goods` experienced a marked decrease in output over the analyzed period (a trend which is shown in more detail in Figure \@ref(fig:BEC6-sector-output)). Figure \@ref(fig:BEC-exports-vsoutput) shows that this trade with China overwhelmingly consists of imports. When UNIDO observes the marked decline in Brazilian industrialization in Figure \@ref(fig:deindustrialization-graphs), perhaps this is what the agency refers to. Moreover, Figure \@ref(fig:BEC_exports_vsoutputCHINA) shows that although trade with China grew to represent a large share of the overall trade in `BEC21 Primary industrial supplies nes`, there is no obvious trend in domestic production over time. Perhaps for this reason, the China fixed effect in the `BEC21 Primary industrial supplies nes` models is insignificant.

In summary, the inclusion of lags to the models from [How has Sino-Brazilian bilateral trade as a whole affected the growth of various Brazilian sectors?] did not create much of a difference in the model results. The China fixed effects for the commodity models are overwhelmingly not significant and mostly for the same reasons they were not significant in [How has Sino-Brazilian bilateral trade as a whole affected the growth of various Brazilian sectors?]. The findings from the Broad Economics Categories models presented in Table \@ref(tab:BEC-lags-ChinaFE) are very similar to the findings from the commodities models in that the incorporation of the lagged data did not have much of an effect on the fixed effect representing China in these models. The fixed effects representing China in these models are overwhelmingly significant and positive, as they were previously. This apparent continuation of the findings suggests that they are rather robust, even though many of the higher order lags are significant. 


## Comparison Against Distributional Effects of Other Trade Partners

In light of the results from Table \@ref(tab:BEC-fixef-tibble), which showed that the overwhelming majority of fixed effects for China were significant and positive, this study decided to assess the fixed effects for the other 9 of Brazil's top 10 trade partners as a robustness test of these findings. If the metrics looked similar for many of the rest of Brazil's other top trade partners, potentially this coefficient was picking up the positive correlation between trade in itself and Brazilian economic output, rather than the positive correlation between trade *with China* and Brazilian economic output. If, rather, the regressions with dummies for China were unique in the number of significant coefficients or unique for the nature of those significant coefficients *relative to the other trade partners in the model*, this test would provide evidence that this "China shock" really is unique. 

This robustness test involved recalculating all 32 models detailed in Table \@ref(tab:BEC-fixef-tibble) and then assessing the fixed effects on the trade partner, as well as the coefficients on the interaction terms between exports and imports and the trade partner, as had been done in [Does Brazil trading in a given good with China have a different effect than when it trades in the same good with other countries?]. The coefficients for each partner were then 16 China fixed effects from the `lm` models, 16 fixed effects from the `plm` models, 32 interaction terms on exports and imports with the trade partner for the `lm` models and 32 interaction terms on exports and imports with the trade partner for the `plm` models. All told, for each trade partner, one can say that 32 models were calculated, for each 3 coefficients were extracted and analyzed, which means that in total each partner had 96 coefficients assessed. These coefficients were then all tested for significance and, if significance, the sign was added to a tally of coefficients of the same category with the same sign. The results of this robustness test are presented in Table \@ref(tab:comparison-China-rest-num-significant).


```{r comparison-China-rest-num-significant,echo=FALSE,message=FALSE,cache=TRUE}
countryCountingTibble %>%
  kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
                        col.names = c("Trade Partner",
                                      "Num. Positive Partner FE",
                                      "Num. Positive Import Interaction",
                                      "Num. Positive Export Interaction",
                                      "Num. Negative Partner EF",
                                      "Num. Negative Import Interaction",
                                      "Num. Negative Export Interaction"),
        caption = "Benchmarking of Number of Significant Coefficients against Other Top Trade Partners") %>%
  column_spec(1:7, width="0.63in") %>%
  kable_styling(font_size = 8, position = "center",latex_options = "HOLD_position") 
```

Table \@ref(tab:comparison-China-rest-num-significant) shows that China is unique for a number of reasons. 

First, China head-and-shoulders stands out for the absolute number of coefficients which are significant; the "China shock" truly was a trade shock for Brazil and uniquely so. Summing across the rows, one can see that China has the greatest number of coefficients which are significant, adding to 49 of the 92 different variables tested or 53%. This is notably above the country with the second highest row sum, Korea, for which 45 of the 92 variables tested were significant, or 49%. Argentina, Germany, Japan, The Netherlands and France all had 30 or fewer variables  which turned out to be significant. 

Second, one can see that China stands out for a large number of interaction terms with negative coefficients. The sum of export interaction terms with a negative coefficient is 12, well above the country in second place, the United States. Moreover, on the import side, China's sum of negative interaction terms is 8, only 1 less than the sum for the country with the largest number of negative import interaction terms: again the United States. These figures contrast with other lesser trade partners like Korea, Mexico, The Netherlands and France, which have a preponderance of trade interaction terms with significant and positive coefficients. This discrepancy, though, makes a lot of intuitive sense, as these interaction terms are calculating the effect *relative to* the effect from the other trade partners. To be succinct, one can conclude that when Brazil engages in trade of a certain product, the model results suggest that engaging in trade of that same product with China will allow for less growth of the various industries studied than if it were to engage with a different country in trade of the same good. This discrepancy, interestingly enough, holds true for exports *and* imports. However, one sees that the other partner which has a preponderance of negative coefficients on these interaction terms is the United States. The United States, like China, has trade volumes with Brazil which dwarf the trade volumes of the other lesser trade partners considered. Perhaps the volume of trade is an omitted variable which is biasing the results of the coefficient on these interaction terms, but this effect has to be studied further before anything definitive can be said.

Third, one sees that the number of industries which Sino-Brazilian trade *as a whole* seems to expand is not only large in absolute terms (which was seen in [How has Sino-Brazilian bilateral trade as a whole affected the growth of various Brazilian sectors?]) but it is *incredibly large* relative to the value for other trade partners. China's 23 is 44% more than the next highest value, the United States's and Argentina's 16. Moreover, this 23 is not only high in absolute terms, it is high relative to the number of industries that are benefitting from the collective trade of any other trade partner. Again, because this refers to the fixed effect coefficient on China for models that take into account both imports and exports, this section can be expected to represent the effect that the product mix, trade directions of those products, and volumes of those trades has on various industries across Brazil. While the trade flows between China and Brazil appear to be very distinct from the trade flows Brazil has with other partners, potentially precisely because of this, output across sectors in Brazil is positively correlated with trade flows with China.

Lastly, Table \@ref(tab:comparison-China-rest-num-significant) suggests that the paucity of industries which seem to have suffered from Sino-Brazilian trade is not because of the model design made the calculation of a negative coefficient difficult, but rather because the data appear to suggest that this is the case. While only one industry in Brazil appears to have shrunk as a result of trade with China *as a whole* (which [How has Sino-Brazilian bilateral trade as a whole affected the growth of various Brazilian sectors?]) 10 industries appear to have suffered as a result of the trade with Korea. This figure is 6 for trade with Mexico and 5 for trade with Japan and The Netherlands. That only 1 industry appears to have shrunk from Sino-Brazilian trade is not only low in absolute terms, it is low relative to the figures for Brazil's other trade partners. 

In summary, by running the models on Brazil's other top trade partners, this study was able to provide a robustness check on the findings about Sino-Brazilian trade. Using other countries as a benchmark, this section was able to confirm that Sino-Brazilian trade, taken collectively (imports and exports together), appears to have many more beneficial effects to the Brazilian economy across industries than trade with other partners. This section provides further evidence for the finding that the number of industries that grow as a result of Sino-Brazilian trade vastly outnumber those that suffer from Sino-Brazilian trade. This section shows that the trade of any given good between China and Brazil doesn't stimulate the growth of the corresponding industry in Brazil by as much as trade in that good between Brazil and a different partner, but the overall trade flows and their compositions indicate that Brazil benefits substantially from this trade as a whole. The inclusion of lagged trade data to the models reveals that higher order lags of trade data frequently do affect economic output in Brazil. However, the correlation is not as frequently seen as the correlation between output and the zeroth lag.

# Conclusion

This study's primary conclusion is that the "China shock" had a very varied impact for Brazil. This study not only found that myriad Brazilian industries, as defined by the UN's Broad Economic Categories, have been affected by trade with China taken in aggregate, but that this "shock" is overwhelmingly positive across the majority of them. Moreover, because of this study’s robustness check in [Comparison Against Distributional Effects of Other Trade Partners], in which the coefficients are estimated for models calculated with dummies for each of the other nine of Brazil’s top 10 trade partners, the results show that this "shock" is unlike the effect of other countries that engage in a substantial amount of trade with Brazil. The "China shock" appears to be unique its breadth across the whole Brazilian economy.

However, this study's analysis of production of various commodities in Brazil suggests that Chinese trade, taken in aggregate, largely did not result in a significant impact after controlling for other factors such as aggregate import and export flows and domestic demand. This lack of apparent influence is observed whether the output of these commodities is measured in weight, area harvested, value harvested or other such output metrics. This study hypothesizes that this lack of apparent influence on commodities production is a result of temporal concerns, a lack of a one-to-one correspondence between HS coded trade goods and domestic Brazilian Institute of Geography and Statistics data and several other reasons. Chief among these temporal concerns is that the China trade shock is as sudden as it is recent, for which reason there is not yet enough data to reject with high confidence the hypothesis that Chinese trade in aggregate does not affect the output of these commodities.

Beyond the sheer diversity of industries which have been affected by the Sino-Brazilian trade relationship, this study found that the magnitude of the effect of the China shock is also staggering. In the extreme case, such as the China fixed effect for the models for `BEC 31 Primary fuels and lubricants`, was estimated to 100.6 for the `lm` model and 117 for the `plm`. Considering the index of output is centered around 100, the fact that one singular coefficient has a median value of over 100 and a 95% confidence lower bound of 87 is impressive, to say the least. 

Furthermore, the signs of the China fixed effects across models suggest that, at least for Broad Economic Categories taken collectively, the China trade shock as a whole is overwhelmingly positive. Of the 32 regressions on the PIM-PF data, 23 of the China dummies had a significant and positive coefficient while only 1 of them had a negative coefficient. These findings indicate that trade with China, taken as a whole, has played a role bolstering the growth of sectors across the Brazilian economy. These findings contradict the findings of several researchers, such as those from Trinkunas. However, this study suggests there are mechanisms that more pessimistic researchers have neglected, such as the role of imports of capital goods in the production of more capital in Brazil. Indeed, capital goods do account for a large portion of China’s imports to Brazil. And again, because of the robustness test conducted in [Comparison Against Distributional Effects of Other Trade Partners], comparing the findings for China against the findings of other top trade partners, it would appear that this relationship between Brazilian economic output and Sino-Brazilian trade is not due (at least solely) to the enormous volumes of said trade. Rather, this study suggests that trade with China has played a *unique* role in supporting Brazilian industry in whatever sector it may be.

This study’s analysis of the interaction terms between the China dummies and the continuous variables representing trade flows again highlights the ubiquity of the China trade shock effect in Brazil and its size. Again, even relative to the results from the robustness check on Brazil’s nine other top trade partners, the number of Chinese interaction terms which are significant is still unusually large. However, unlike the coefficients on the China fixed effects, which are positive, the coefficients on the significant interaction terms are largely negative. This suggests that output in various Brazilian sectors/of select commodities is less positively affected by trade in the equivalent goods with China than it would be through trade in the same goods with a different trade partner. The mechanism of this relationship is a topic for further research, but one hypothesis is that Brazil disproportionately sources imports from other countries when the corresponding industries are in a period of expansion and thus outstrip Chinese supply. A second one is that as China is by far the largest export and import partner for a lot of the commodities/sectors tested, although trade with China is positively correlated with the assessed sectors, the correlation does not appear to be as strong as it should be given the vastness of the trade volumes relative to Brazil’s other top trade partners. Whatever the reason, though, these findings have to be considered with those of the China fixed effects. 

For its incredible breadth, magnitude, and differentiated effect, this study further highlighted the increased need to study the Sino-Brazilian trade relationship and its distributional effects on both partners. The opportunities of such a large and transformational force are clearly large, but so are the risks. Understanding the distributional effects in all of their nuances and constructing effective models of them is imperative to creating a trade relationship which is ideal for the mutual prosperity of both parties. 

As many economists have concluded, the new trade paradigm presents enormous opportunities for Brazil through specialization if it is able to take advantage of them. Guillaume and Zignago, again, not only argue that the trade with China allowed Brazil to specialize in the production of commodities, but that it also allowed Brazil to become competitive in a few select high-tech manufacturing industries. Moreover, as Blazquéz-Lidoy, Rodríguez and Santiso found that Brazil was in the process of specializing in products that were "highly complementary" to the Chinese economy, there is increasing evidence that this degree of specialization is beneficial to Brazil as a whole. However complex the interconnected thousands of HS codes traded between Brazil and China each month and the distributional effects this trade has on the Brazilian economy, the models from this study conclude that, for whatever mechanism, the China shock taken collectively increases output from a number of heterogeneous economic sectors. This finding may not necessarily contradict the conclusion that Brazil is in a period of economic specialization, as the BEC classifications are extraordinarily broad, and Brazil can absolutely specialize enough in several products within each category that the output of the category as a whole can increase. If anything, these two conclusions taken together only reinforce Guillaume and Zignago’s findings about the heterogeneity of the goods which Sino-Brazilian trade is inducing the country to specialize in. 

This study indicates numerous different avenues which could potentially be sources of future research. One of the largest lacunas of this study’s methodology is perhaps its lack of lagged data. A study which continues this research and investigates the relationship between output across sectors and historical trade may be very fruitful and help generate highly predictive models of commodities output. If crops have to be planted three seasons before harvesting and a petroleum field has to begin exploration many months before any oil is actually extracted, these lagged models may help generate models which fit the data much better and lead to more interpretable results. 

In addition, given the simplification of many of the models considered in this study, future research could perhaps deepen this paper’s insight and findings by estimating the models using a much larger number of trade goods as regressors. This modification may hope to capture a lot of the complex relationships and dependencies among various goods/sectors, and may generate estimates with much better predictive power than the models considered in this study. 

Whatever the methodology or objective is, this study only further highlights the importance of research on the rapidly evolving Sino-Brazilian trade relationship (indeed, amid the COVID-19 pandemic, exports to China jumped from 28.3% of total Brazilian exports to 32.1%). As much as Brazilian politicians may denounce increased commercial relationships with the economic powerhouse on the other side of the Earth ("China is not buying from Brazil, China is buying Brazil!" Bolsonaro famously declared during his ultimately successful presidential campaign in 2018), increasingly inextricable trade linkages show that the "China shock" is here to stay. Regardless of which economic sector one belongs to, the expansiveness of the "China shock" show that modeling the resulting distributional effects has become indispensable to understanding where the Brazilian economy is, where it’s going, and how to best exploit the new opportunities down the road.


# Annex

```{r brazil-crop-production-time, include=TRUE,fig.height = 4,message=FALSE,echo=FALSE,warning=FALSE,cache=TRUE,out.width = "100%", fig.align='center', fig.cap = "Harvest Values of Select Crops in Brazil over Time"}
agricultureAnnual %>% filter(Data > 2000) %>%
  mutate(soy = (`soja valor (R$)`),
         corn = (`milho valor (R$)`),
         sugarcane = `cana-de-açúcar valor (R$)`,
         #wheat = `trigo valor (R$)`,
         coffee = `café valor (R$)`) %>%
  select(Data,soy,corn,sugarcane,coffee) %>%
  pivot_longer(cols=c("sugarcane","soy","corn","coffee"), names_to="crop", values_to="Production Value (R$)") %>%
  mutate(Crop = as.factor(crop)) %>%
  ggplot(aes(x=Data,y=`Production Value (R$)`,colour=Crop)) + 
  geom_smooth(se=FALSE) + geom_point() +
  labs(x = "Year", title = "Harvest Values of Select Crops in Brazil over Time") +
  theme(plot.title = element_text(hjust=0.5))
```

```{r brazil-meat-production-time, echo=FALSE,include=TRUE,fig.height = 4,message=FALSE,warning=FALSE,cache=TRUE,out.width = "100%", fig.align='center', fig.cap = "Meat Production in Brazil"}
meatMonthly %>% mutate(year = as.double(as.character(fYear))+(as.double(as.character(fMonth))/12)) %>%
  filter(year > 2000) %>% mutate(beef = (`bovinos (tons)`),
                                 pork = (`suínos (tons)`),
                                 chickens = (`frangos (tons)`)) %>%
  select(year, beef, pork, chickens) %>%
  pivot_longer(cols=c("beef","pork","chickens"), names_to="Animal", values_to="Absolute Production (tons)") %>%
  mutate(Animal = as.factor(Animal)) %>%
  ggplot(aes(x=year,y=`Absolute Production (tons)`,colour=Animal)) + 
  geom_smooth(se=FALSE) +
  geom_point() +
  theme(plot.title = element_text(hjust=0.5)) + 
  labs(x = "Year", title = "Meat Production in Brazil")
```

```{r fuels-sector-output, echo=FALSE,include=TRUE,fig.height = 4,message=FALSE,warning=FALSE,cache=TRUE,out.width = "100%", fig.align='center', fig.cap = "Output of BEC31 Fuels and Lubricants in Brazil"}
PIM_PF_BEC %>% filter(BEC == 31) %>% mutate(time=as.double(as.character(fYear))+(as.double(as.character(fMonth))/12)) %>% 
  ggplot(aes(x=time, y= PIM_PF_BECindexValue)) +
  geom_point() + geom_smooth(se=FALSE) +
  labs(x = "Year", y = "Production Index (mid-2012 = 100)", title = "Monthly Output of BEC31 Fuels and Lubricants in Brazil") + theme(plot.title = element_text(hjust = 0.5))
```

```{r BEC6-sector-output, echo=FALSE,warning=FALSE,fig.height = 4,message=FALSE,cache=TRUE,out.width = "100%", include=TRUE,fig.align='center', fig.cap = "Output of Consumer Goods in Brazil"}
PIM_PF_BEC %>% filter(BEC %in% c(61,62,63)) %>% mutate(time=as.double(as.character(fYear))+(as.double(as.character(fMonth))/12)) %>% 
  mutate(Sector = as.factor(case_when(
    BEC == 61 ~ "Durable Consumer Goods",
    BEC == 62 ~ "Semi-Durable Consumer Goods",
    BEC == 63 ~ "Non-Durable Consumer Goods"
  ))) %>%
  ggplot(aes(x=time, y= PIM_PF_BECindexValue,colour=Sector,shape=Sector)) +
  geom_point() + geom_smooth(se=FALSE) +
  theme_bw() + 
  labs(x = "Year", y = "Production Index (mid-2012 = 100)", title = "Output of Consumer Goods in Brazil")
```

```{r brazil-china-trade-ex-soy, echo=FALSE,message=FALSE,fig.height = 4,warning=FALSE,cache=TRUE,out.width = "100%", fig.align='center',include=TRUE, fig.cap = "Brazilian imports from China have actually decreased steadily since the recession in 2014. In contrast, exports to China have surged over this period. Once soy is removed from the data, Brazilian exports to China are substantially less volatile"}

plot_grid(brazil_china_monthlytradevalue_with_soy, brazil_china_monthlytradevalue_no_soy, nrow=2, ncol=1)

```




```{r textiles-trade-Brazil, echo=FALSE,message=FALSE,fig.height = 4,warning=FALSE,cache=TRUE,out.width = "100%", fig.align='center',include=TRUE, fig.cap = "Brazilian Trade in Textiles over Time"}
eda_trade_data %>% filter(HSSection == "Textiles") %>% 
  filter(flow=="Import") %>%
  mutate(`Import Partner` = case_when(partner=="China" ~ "China",
                                      partner=="Viet Nam" ~ "Vietnam",
                                      partner=="Indonesia" ~ "Indonesia",
                                      partner=="Pakistan" ~ "Pakistan",
                                      partner == "India" ~ "India",
                                      TRUE ~ "Other")) %>%
  group_by(year,`Import Partner`) %>% summarise(value = sum(normalizedValue)) %>% 
  ggplot(aes(x=year,y=value,group=`Import Partner`,fill=`Import Partner`)) + 
  geom_area() +
  labs(x="Year",y="Annual Trade Value (Constant 1982 USD)",
       title="Brazilian Trade in Textiles over Time") + 
  theme(plot.title = element_text(hjust=0.5))
```

```{r select-brazil-exports-china, echo=FALSE,fig.height = 4,warning=FALSE,message=FALSE,cache=TRUE,out.width = "100%", fig.align='center',include=TRUE, fig.cap = "Select Brazilian Exports to China over Time"}
eda_trade_data %>% filter(HS4Digit %in% c(7201, 202, 105, 203, 2709, 1201)) %>%
  filter(flow=="Export") %>% filter(partner == "China") %>% 
  mutate(`Export Good` = Description,
         normalizedExportValue = scale(normalizedValue)) %>% 
  ggplot(aes(x=year,y=normalizedValue,colour=`Export Good`)) +
  geom_point() + geom_smooth(se=FALSE) + 
  labs(x="Year",y="Annual Export Value (Constant 1982 USD)", title="Select Brazilian Exports to China over Time") + theme(plot.title = element_text(hjust=0.5))
  
  
```


```{r BEC-exports-vsoutput, echo=FALSE,warning=FALSE, fig.align='center',fig.height = 4,message=FALSE,cache=TRUE,fig.cap = "Output of Brazilian Broad Economic Categories and Trade Data by Trade Flow",cache=TRUE}
# divide into exports and imports
PIM_PF_BEC %>% inner_join(tradeDataLong %>% select(threeDigitBEC,fYear,fMonth,valueNormalized,flow), by=c("fYear"="fYear","fMonth"="fMonth","BEC"="threeDigitBEC")) %>% group_by(fYear,fMonth,BEC,flow) %>% summarise(`Output Index` = mean(PIM_PF_BECindexValue), `Trade Value` = sum(valueNormalized)) %>% filter(!(BEC %in% c(7,121))) %>%
  mutate(years = as.double(as.character(fYear)) + as.double(as.character(fMonth))/12,
         .keep="unused") %>%
  inner_join(bec_avg_intensity,by=c("BEC"="BEC")) %>%
  mutate(`Output Index` = `Output Index`*avg_trade_value/avg_intensity,
         `Domestic Output` = "Index Relative to 2012") %>%
  #pivot_longer(cols=c("Output Index", "Trade Value"), names_to = "Output", values_to="Intensity") %>%
  ggplot(aes(x=years)) + 
  geom_area(aes(y=`Trade Value`, group=`flow`, fill=`flow`)) +  
  geom_line(aes(y=`Output Index`,shape=`Domestic Output`),show.legend = TRUE) +
  facet_wrap(~BEC,scale="free_y") + 
  theme(axis.text.y = element_blank(), plot.title = element_text(hjust = 0.5, size=11)) + 
  labs(x="Year", title="Output of Brazilian Broad Economic Categories and Trade Data")
```



```{r commodity-HS-matching, echo=FALSE,warning=FALSE,message=FALSE,cache=TRUE,out.width = "100%", fig.align='center', include=TRUE,fig.cap = "Matchings Between IBGE Commodities and HS Codes"}
tribble(~commodity, ~matched_HS_codes,
        "Beef", "0102 Bovine, 0202 Frozen Bovine Meat, 0201 Bovine Meat",
        "Chicken", "0105 Poultry, 0207 Poultry Meat",
        "Pork", "0103 Pigs, 0203 Pig Meat",
        "Cotton", "52 Cotton",
        "Coffee", "0901 Coffee, 2101 Coffee and Tea Extracts",
        "Corn", "1005 Corn, 1702 Other Sugars, 1103 Cereal Meal & Pellets",
        "Soy", "1201 Soybeans, 2304 Soybean Meal, 1507 Soybean Oil",
        "Sugarcane", "17 Sugars and Sugar Confectionery",
        "Cocoa", "18 Cocoa and Cocoa Preparations",
        "Tobacco", "24 Tobacco and Manufactured Tobacco Substitutes",
        "Petroleum", "2709 Crude Petroleum, 2710 Refined Petroleum, 2713 Petroleum Coke",
        "Natural Gas", "2711 Petroleum Gas",
        "Pig Iron", "7201 Pig Iron",
        "Crude Steel", "7227 Steel Bars, 7218 Stainless Steel Ingots",
        "Laminates", "7210 Coated Flat Rolled Iron, 7208 Hot Rolled Iron, 7213 Hot-Rolled Iron Bars, 7225 Flat Flat-Rolled Steel, 7226 Flat-Rolled Iron, 7220 Flat-Rolled Stainless Steel, 7221 Hot-Rolled Stainless Steel Bars, 7219 large Flat-Rolled Stainless Steel, 7227 Steel Bars, 7212 Large Coated Flat-Rolled Iron, 7211 Large Flat-Rolled Iron"
        ) %>%
    kable(format = "latex", row.names = NA,
                        booktabs = TRUE,
                        digits = 3,
        col.names = c("IBGE Commodity", "Matched HS Codes"),
        caption = "Matchings Between IBGE Commodities and HS Codes") %>%
  column_spec(2, width="4in") %>%
  kable_styling(position = "center",latex_options = "HOLD_position") 
```

# Bibliography


